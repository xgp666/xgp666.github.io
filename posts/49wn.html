<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MySQL配置参数优化 | Xgp &amp; Blog</title><meta name="description" content="为什么要分表和分区？ 我们的数据库数据越来越大，随之而来的是单个表中数据太多。以至于查询速度变慢，而且由于表的锁机制导致应用操作也搜到严重影响，出现了数据库性能瓶颈。 mysql中有一种机制是表锁定和行锁定，是为了保证数据的完整性。表锁定表示你们都不能对这张表进行操作，必须等我对表操作完才行。行锁定也一样，别的sql必须等我对这条数据操作完了，才能对这条数据进行操作。当出现这种情况时，我们可以考虑"><meta name="keywords" content="MySQL优化"><meta name="author" content="Wu Shao Dong"><meta name="copyright" content="Wu Shao Dong"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://gitee.com/xgpqq/tuchuang/raw/master/img/Yun.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://hm.baidu.com"/><link rel="dns-prefetch" href="https://hm.baidu.com"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="rPK0WSwqdm"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="MySQL配置参数优化"><meta name="twitter:description" content="为什么要分表和分区？ 我们的数据库数据越来越大，随之而来的是单个表中数据太多。以至于查询速度变慢，而且由于表的锁机制导致应用操作也搜到严重影响，出现了数据库性能瓶颈。 mysql中有一种机制是表锁定和行锁定，是为了保证数据的完整性。表锁定表示你们都不能对这张表进行操作，必须等我对表操作完才行。行锁定也一样，别的sql必须等我对这条数据操作完了，才能对这条数据进行操作。当出现这种情况时，我们可以考虑"><meta name="twitter:image" content="https://gitee.com/xgpqq/tuchuang/raw/master/img/qwe%20(4).jpg"><meta property="og:type" content="article"><meta property="og:title" content="MySQL配置参数优化"><meta property="og:url" content="https://wsdlxgp.top/posts/49wn.html"><meta property="og:site_name" content="Xgp &amp; Blog"><meta property="og:description" content="为什么要分表和分区？ 我们的数据库数据越来越大，随之而来的是单个表中数据太多。以至于查询速度变慢，而且由于表的锁机制导致应用操作也搜到严重影响，出现了数据库性能瓶颈。 mysql中有一种机制是表锁定和行锁定，是为了保证数据的完整性。表锁定表示你们都不能对这张表进行操作，必须等我对表操作完才行。行锁定也一样，别的sql必须等我对这条数据操作完了，才能对这条数据进行操作。当出现这种情况时，我们可以考虑"><meta property="og:image" content="https://gitee.com/xgpqq/tuchuang/raw/master/img/qwe%20(4).jpg"><meta property="article:published_time" content="2020-06-22T16:02:00.000Z"><meta property="article:modified_time" content="2020-06-30T03:58:22.307Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://wsdlxgp.top/posts/49wn.html"><link rel="prev" title="mysqldump备份还原" href="https://wsdlxgp.top/posts/49et.html"><link rel="next" title="MySQL配置参数优化" href="https://wsdlxgp.top/posts/49an.html"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?cad0cd04042fcca2c687648c42a45fc9";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: true,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Xgp & Blog" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><canvas class="fireworks"></canvas><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://gitee.com/xgpqq/tuchuang/raw/master/img/666.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">125</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">88</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">4</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 我</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 其他</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 视频</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#为什么要分表和分区？"><span class="toc-number">1.</span> <span class="toc-text">为什么要分表和分区？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number"></span> <span class="toc-text">一、分表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#什么是分表？"><span class="toc-number">0.1.</span> <span class="toc-text">什么是分表？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mysql分表分为垂直切分和水平切分"><span class="toc-number">0.2.</span> <span class="toc-text">Mysql分表分为垂直切分和水平切分</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1、分表的几种方式："><span class="toc-number">1.</span> <span class="toc-text">1、分表的几种方式：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1）mysql集群"><span class="toc-number">1.1.</span> <span class="toc-text">1）mysql集群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2）预先估计会出现大数据量并且访问频繁的表，将其分为若干个表"><span class="toc-number">1.2.</span> <span class="toc-text">2）预先估计会出现大数据量并且访问频繁的表，将其分为若干个表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3）利用merge存储引擎来实现分表"><span class="toc-number">1.3.</span> <span class="toc-text">3）利用merge存储引擎来实现分表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#加入点数据："><span class="toc-number">1.3.1.</span> <span class="toc-text">加入点数据：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#下面我们进行分表，这里我们把member分两个表tb-member1-tb-member2"><span class="toc-number">1.3.2.</span> <span class="toc-text">下面我们进行分表，这里我们把member分两个表tb_member1,tb_member2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建主表tb-member"><span class="toc-number">1.3.3.</span> <span class="toc-text">创建主表tb_member</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看一下tb-member表的结构"><span class="toc-number">1.3.4.</span> <span class="toc-text">查看一下tb_member表的结构:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#接下来，我们把数据分到两个分表中去："><span class="toc-number">1.3.5.</span> <span class="toc-text">接下来，我们把数据分到两个分表中去：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看两个子表的数据："><span class="toc-number">1.3.6.</span> <span class="toc-text">查看两个子表的数据：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看一下主表的数据："><span class="toc-number">1.3.7.</span> <span class="toc-text">查看一下主表的数据：</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number"></span> <span class="toc-text">二、分区 什么是分区？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#分区主要有两种形式："><span class="toc-number">0.1.</span> <span class="toc-text">分区主要有两种形式：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1、mysql怎么查看是否支持分区"><span class="toc-number">1.</span> <span class="toc-text">1、mysql怎么查看是否支持分区</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#编写代码"><span class="toc-number">1.0.1.</span> <span class="toc-text">编写代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#测试在创建表之后分区是否可以"><span class="toc-number">1.0.2.</span> <span class="toc-text">测试在创建表之后分区是否可以</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2、新增分区"><span class="toc-number">2.</span> <span class="toc-text">2、新增分区</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）删除分区-当删除了一个分区，也同时删除了该分区中所有的数据。"><span class="toc-number">2.1.</span> <span class="toc-text">（1）删除分区 当删除了一个分区，也同时删除了该分区中所有的数据。</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#查看分区"><span class="toc-number">2.1.1.</span> <span class="toc-text">查看分区</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3、分区的合并"><span class="toc-number">3.</span> <span class="toc-text">3、分区的合并</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4、未分区表和分区表性能测试-创建一个未分区的表"><span class="toc-number">4.</span> <span class="toc-text">4、未分区表和分区表性能测试 创建一个未分区的表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5、分区时，将不同分区放到不同存储位置"><span class="toc-number">5.</span> <span class="toc-text">5、分区时，将不同分区放到不同存储位置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）建表时，提前创建好存储目录，并授权给mysql"><span class="toc-number">5.1.</span> <span class="toc-text">（1）建表时，提前创建好存储目录，并授权给mysql:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（2）创建表格。"><span class="toc-number">5.2.</span> <span class="toc-text">（2）创建表格。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（3）查看分区情况"><span class="toc-number">5.3.</span> <span class="toc-text">（3）查看分区情况</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6、mysql分区的类型"><span class="toc-number">6.</span> <span class="toc-text">6、mysql分区的类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）RANGE分区"><span class="toc-number">6.1.</span> <span class="toc-text">（1）RANGE分区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（2）LIST分区"><span class="toc-number">6.2.</span> <span class="toc-text">（2）LIST分区</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#hash的分区函数页需要返回一个整数值。partitions子句中的值是一个非负整数，不加的partitions子句的话，默认为分区数为1。"><span class="toc-number">6.2.1.</span> <span class="toc-text">hash的分区函数页需要返回一个整数值。partitions子句中的值是一个非负整数，不加的partitions子句的话，默认为分区数为1。</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7、key分区"><span class="toc-number">7.</span> <span class="toc-text">7、key分区</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8、columns分区"><span class="toc-number">8.</span> <span class="toc-text">8、columns分区</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#COLUMNS分区支持以下数据类型："><span class="toc-number">8.1.</span> <span class="toc-text">COLUMNS分区支持以下数据类型：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql分表和分区有什么区别呢"><span class="toc-number">8.2.</span> <span class="toc-text">mysql分表和分区有什么区别呢</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#实现方式上"><span class="toc-number">8.2.1.</span> <span class="toc-text">实现方式上</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#数据处理上"><span class="toc-number">8.2.2.</span> <span class="toc-text">数据处理上</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#提高性能上"><span class="toc-number">8.2.3.</span> <span class="toc-text">提高性能上</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#实现的难易度上"><span class="toc-number">8.2.4.</span> <span class="toc-text">实现的难易度上</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql分表和分区有什么联系？"><span class="toc-number">8.3.</span> <span class="toc-text">mysql分表和分区有什么联系？</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://gitee.com/xgpqq/tuchuang/raw/master/img/qwe%20(4).jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Xgp &amp; Blog</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 我</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 其他</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 视频</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">MySQL配置参数优化</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-06-23 00:02:00"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-06-23</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-06-30 11:58:22"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-06-30</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/mysql/">mysql</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon far fa-file-word" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">6.7k</span><span class="post-meta__separator">|</span><i class="post-meta__icon far fa-clock" aria-hidden="true"></i><span>阅读时长: 26 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h2 id="为什么要分表和分区？">为什么要分表和分区？</h2>
<p><strong>我们的数据库数据越来越大，随之而来的是单个表中数据太多。以至于查询速度变慢，而且由于表的锁机制导致应用操作也搜到严重影响，出现了数据库性能瓶颈。</strong><br>
<strong>mysql中有一种机制是表锁定和行锁定，是为了保证数据的完整性。表锁定表示你们都不能对这张表进行操作，必须等我对表操作完才行。行锁定也一样，别的sql必须等我对这条数据操作完了，才能对这条数据进行操作。当出现这种情况时，我们可以考虑分表或分区。</strong></p>
<h1>一、分表</h1>
<h3 id="什么是分表？">什么是分表？</h3>
<p><strong>分表是将一个大表按照一定的规则分解成多张具有独立存储空间的实体表，每个表都对应三个文件，MYD数据文件，.MYI索引文件，.frm表结构文件。这些表可以分布在同一块磁盘上，也可以在不同的机器上。app读写的时候根据事先定义好的规则得到对应的表名，然后去操作它。</strong><br>
<strong>将单个数据库表进行拆分，拆分成多个数据表，然后用户访问的时候，根据一定的算法（如用hash的方式，也可以用求余（取模）的方式），让用户访问不同的表，这样数据分散到多个数据表中，减少了单个数据表的访问压力。提升了数据库访问性能。分表的目的就在于此，减小数据库的负担，缩短查询时间。</strong></p>
<h3 id="Mysql分表分为垂直切分和水平切分">Mysql分表分为垂直切分和水平切分</h3>
<p><strong>垂直切分是指数据表列的拆分，把一张列比较多的表拆分为多张表 通常我们按以下原则进行垂直拆分: 把不常用的字段单独放在一张表; 把text，blob（binary large object，二进制大对象）等大字段拆分出来放在附表中;</strong></p>
<p><strong>经常组合查询的列放在一张表中; 垂直拆分更多时候就应该在数据表设计之初就执行的步骤，然后查询的时候用join关键起来即可。</strong></p>
<p><strong>水平拆分是指数据表行的拆分，把一张的表的数据拆成多张表来存放。 水平拆分原则 通常情况下，我们使用hash、取模等方式来进行表的拆分 比如一张有400W的用户表users，为提高其查询效率我们把其分成4张表users1，users2，users3，users4 通过用ID取模的方法把数据分散到四张表内Id%4= [0,1,2,3] 然后查询,更新,删除也是通过取模的方法来查询 部分业务逻辑也可以通过地区，年份等字段来进行归档拆分; 进行拆分后的表，这时我们就要约束用户查询行为。比如我们是按年来进行拆分的,这个时候在页面设计上就约束用户必须要先选择年,然后才能进行查询。</strong></p>
<h2 id="1、分表的几种方式：">1、分表的几种方式：</h2>
<h3 id="1）mysql集群">1）mysql集群</h3>
<p><strong>它并不是分表，但起到了和分表相同的作用。集群可分担数据库的操作次数，将任务分担到多台数据库上。集群可以读写分离，减少读写压力。从而提升数据库性能。</strong></p>
<h3 id="2）预先估计会出现大数据量并且访问频繁的表，将其分为若干个表">2）预先估计会出现大数据量并且访问频繁的表，将其分为若干个表</h3>
<p><strong>根据一定的算法（如用hash的方式，也可以用求余（取模）的方式）让用户访问不同的表。 例如论坛里面发表帖子的表，时间长了这张表肯定很大，几十万，几百万都有可能。聊天室里面信息表，几十个人在一起一聊一个晚上，时间长了，这张表的数据肯定很大。像这样的情况很多。所以这种能预估出来的大数据量表，我们就事先分出个N个表，这个N是多少，根据实际情况而定。以聊天信息表为例：我们事先建100个这样的表，message_00,message_01,message_02…message_98,message_99.然后根据用户的ID来判断这个用户的聊天信息放到哪张表里面，可以用hash的方式来获得，也可以用求余的方式来获得，方法很多。 或者可以设计每张表容纳的数据量是N条，那么如何判断某张表的数据是否容量已满呢？可以在程序段对于要新增数据的表，在插入前先做统计表记录数量的操作，当&lt;N条数据，就直接插入，当已经到达阀值，可以在程序段新创建数据库表（或者已经事先创建好），再执行插入操作）。</strong></p>
<h3 id="3）利用merge存储引擎来实现分表">3）利用merge存储引擎来实现分表</h3>
<p><strong>如果要把已有的大数据量表分开比较痛苦，最痛苦的事就是改代码，因为程序里面的sql语句已经写好了，用merge存储引擎来实现分表, 这种方法比较适合。 merge分表，分为主表和子表，主表类似于一个壳子，逻辑上封装了子表，实际上数据都是存储在子表中的。 我们可以通过主表插入和查询数据，如果清楚分表规律，也可以直接操作子表。 下面我们来实现一个简单的利用merge存储引擎来实现分表的演示： 创建一个完整表存储着所有的成员信息（表名为member)</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 创建库<br>drop database IF EXISTS testdb;<br>create database testdb;<br>use testdb;<br><br>create table member(<br>id bigint auto_increment primary key,<br>name varchar(20),<br>sex tinyint not null default &#39;0&#39;<br>)engine&#x3D;myisam default charset&#x3D;utf8 auto_increment&#x3D;1;<br></code></pre></td></tr></table></figure>
<h4 id="加入点数据："><strong>加入点数据：</strong></h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into member(name,sex) values(&#39;tom1&#39;,1);<br>insert into member(name,sex) select name,sex from member;<br></code></pre></td></tr></table></figure>
<p><strong>第二条语句多执行几次就有了很多数据</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from member;<br>+----+------+-----+<br>| id | name | sex |<br>+----+------+-----+<br>| 1 | tom1 | 1 |<br>| 2 | tom1 | 1 |<br>| 3 | tom1 | 1 |<br>| 4 | tom1 | 1 |<br>| 5 | tom1 | 1 |<br>| 6 | tom1 | 1 |<br>| 7 | tom1 | 1 |<br>| 8 | tom1 | 1 |<br>| 9 | tom1 | 1 |<br>| 10 | tom1 | 1 |<br>| 11 | tom1 | 1 |<br>| 12 | tom1 | 1 |<br>| 13 | tom1 | 1 |<br>| 14 | tom1 | 1 |<br>| 15 | tom1 | 1 |<br>| 16 | tom1 | 1 |<br>+----+------+-----+<br></code></pre></td></tr></table></figure>
<h4 id="下面我们进行分表，这里我们把member分两个表tb-member1-tb-member2"><strong>下面我们进行分表，这里我们把member分两个表tb_member1,tb_member2</strong></h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 创建两个分表<br>use testdb;<br>DROP table IF EXISTS tb_member1;<br>create table tb_member1(<br>id bigint primary key ,<br>name varchar(20),<br>sex tinyint not null default &#39;0&#39;<br>)ENGINE&#x3D;MyISAM DEFAULT CHARSET&#x3D;utf8 ;<br><br>DROP table IF EXISTS tb_member2;<br>create table tb_member2(<br>id bigint primary key,<br>name varchar(20),<br>sex tinyint not null default &#39;0&#39;<br>)ENGINE&#x3D;MyISAM DEFAULT CHARSET&#x3D;utf8;<br></code></pre></td></tr></table></figure>
<h4 id="创建主表tb-member">创建主表tb_member</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 创建主表tb_member<br>DROP table IF EXISTS tb_member;<br>create table tb_member(<br>id bigint primary key ,<br>name varchar(20),<br>sex tinyint not null default &#39;0&#39;<br>) ENGINE&#x3D;MERGE UNION&#x3D;(tb_member1,tb_member2) INSERT_METHOD&#x3D;LAST CHARSET&#x3D;utf8 ;<br></code></pre></td></tr></table></figure>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into member(name,sex) values(&#39;tom2&#39;,2);<br>insert into member(name,sex) select name,sex from member;<br><br>insert into member(name,sex) values(&#39;tom3&#39;,3);<br>insert into member(name,sex) select name,sex from member;<br><br>insert into member(name,sex) values(&#39;tom4&#39;,4);<br>insert into member(name,sex) select name,sex from member;<br></code></pre></td></tr></table></figure>
<p>**注：INSERT_METHOD,此参数INSERT_METHOD = NO 表示该表不能做任何写入操作只作为查询使用,INSERT_METHOD = LAST表示插入到最后的一张表里面。INSERT_METHOD = first表示插入到第一张表里面。 **</p>
</blockquote>
<h4 id="查看一下tb-member表的结构">查看一下tb_member表的结构:</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; desc tb_member;<br>mysql&gt; desc tb_member;<br>+-------+-------------+------+-----+---------+------------------------------------<br>-----+<br>| Field | Type | Null | Key | Default | Extra |<br>+-------+-------------+------+-----+---------+------------------------------------<br>-----+<br>| id | bigint(20) | NO | PRI | NULL | auto_increment |<br>| name | varchar(20) | YES | | NULL | |<br>| sex | tinyint(4) | NO | | 0 | |<br>+-------+-------------+------+-----+---------+------------------------------------<br>------+<br>3 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>
<h4 id="接下来，我们把数据分到两个分表中去：">接下来，我们把数据分到两个分表中去：</h4>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 按照已经有行插入<br>insert into tb_member1(id,name,sex) select id,name,sex from member where<br>id%2&#x3D;0;<br>insert into tb_member2(id,name,sex) select id,name,sex from member where<br>id%2&#x3D;1;<br></code></pre></td></tr></table></figure>
<h4 id="查看两个子表的数据：">查看两个子表的数据：</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from tb_member1;<br>+----+------+-----+<br>| id | name | sex |<br>+----+------+-----+<br>| 16 | tom1 | 1 |<br>| 14 | tom1 | 1 |<br>| 12 | tom1 | 1 |<br>| 10 | tom1 | 1 |<br>| 8 | tom1 | 1 |<br>| 6 | tom1 | 1 |<br>| 4 | tom1 | 1 |<br>| 2 | tom1 | 1 |<br>+----+------+-----+<br>8 rows in set (0.00 sec)<br>mysql&gt; select * from tb_member2;<br>+----+------+-----+<br>| id | name | sex |<br>+----+------+-----+<br>| 3 | tom1 | 1 |<br>| 1 | tom1 | 1 |<br>| 5 | tom1 | 1 |<br>| 7 | tom1 | 1 |<br>| 9 | tom1 | 1 |<br>| 11 | tom1 | 1 |<br>| 13 | tom1 | 1 |<br>| 15 | tom1 | 1 |<br>+----+------+-----+<br>8 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>
<h4 id="查看一下主表的数据：">查看一下主表的数据：</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from tb_member;<br>+----+------+-----+<br>| id | name | sex |<br>+----+------+-----+<br>| 16 | tom1 | 1 |<br>| 14 | tom1 | 1 |<br>| 12 | tom1 | 1 |<br>| 10 | tom1 | 1 |<br>| 8 | tom1 | 1 |<br>| 6 | tom1 | 1 |<br>| 4 | tom1 | 1 |<br>| 2 | tom1 | 1 |<br>| 15 | tom1 | 1 |<br>| 13 | tom1 | 1 |<br>| 11 | tom1 | 1 |<br>| 9 | tom1 | 1 |<br>| 7 | tom1 | 1 |<br>| 5 | tom1 | 1 |<br>| 3 | tom1 | 1 |<br>| 1 | tom1 | 1 |<br>+----+------+-----+<br>16 rows in set (0.00 sec)<br>mysql&gt; select * from tb_member where id&#x3D;3;<br>+----+------+-----+<br>| id | name | sex |<br>+----+------+-----+<br>| 3 | tom1 | 1 |<br>+----+------+-----+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>
<p><em><strong>注意：总表只是一个外壳，存取数据发生在一个一个的子表里面。</strong></em></p>
<p><em><strong>注意：每个子表都有自已独立的相关表文件，而主表只是一个壳，并没有完整的相关表文件</strong></em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">[root@localhost ~]# ls -l &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;test&#x2F;tb_member*<br>-rw-r-----. 1 mysql mysql 8614 Sep 15 21:49<br>&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;test&#x2F;tb_member1.frm<br>-rw-r-----. 1 mysql mysql 320 Sep 16 00:02<br>&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;test&#x2F;tb_member1.MYD<br>-rw-r-----. 1 mysql mysql 2048 Sep 16 00:43<br>&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;test&#x2F;tb_member1.MYI<br>-rw-r-----. 1 mysql mysql 8614 Sep 15 21:50<br>&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;test&#x2F;tb_member.MRG<br></code></pre></td></tr></table></figure>
<h1>二、分区 什么是分区？</h1>
<p><strong>分区和分表相似，都是按照规则分解表。不同在于分表将大表分解为若干个独立的实体表，而分区是将数据分段划分在多个位置存放，分区后，表还是一张表，但数据散列到多个位置了。app读写的时候操作的还是表名字，db自动去组织分区的数据。</strong></p>
<h3 id="分区主要有两种形式：">分区主要有两种形式：</h3>
<p><strong>水平分区（Horizontal Partitioning）这种形式分区是对表的行进行分区，所有在表中定义的列在每个数据集中</strong><br>
<strong>都能找到，所以表的特性依然得以保持。</strong></p>
<p><strong>举个简单例子：一个包含十年发票记录的表可以被分区为十个不同的分区，每个分区包含的是其中一年的记录。</strong><br>
<strong>垂直分区（Vertical Partitioning）这种分区方式一般来说是通过对表的垂直划分来减少目标表的宽度，使某些特定的列被划分到特定的分区，每个分区都包含了其中的列所对应的行。</strong></p>
<p><strong>举个简单例子：一个包含了大text和BLOB列的表，这些text和BLOB列又不经常被访问，这时候就要把这些不经常使用的text和BLOB了划分到另一个分区，在保证它们数据相关性的同时还能提高访问速度。</strong></p>
<h2 id="1、mysql怎么查看是否支持分区">1、mysql怎么查看是否支持分区</h2>
<p><strong>mysql从5.1开始支持分区功能</strong></p>
<p><strong>查询命令如下：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show variables like &#39;%partition%&#39;;<br>Empty set (0.00 sec)<br></code></pre></td></tr></table></figure>
<p><strong>如果查询结果显示Empty，表示不支持分区。</strong></p>
<p><strong>但是上面的查询方法只是针对mysql5.6以下版本。</strong></p>
<p><strong>如果mysql5.6以及以上版本，需要使用下面的查询命令：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show plugins;<br></code></pre></td></tr></table></figure>
<p><img src="https://gitee.com/xgpqq/tuchuang/raw/master/img/image-20200623163451033.png" alt="image-20200623163451033"></p>
<h4 id="编写代码">编写代码</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs mysql">drop database IF EXISTS testdb;<br>create database testdb;<br>use testdb;<br><br>create table if not exists user (<br>  id int not null auto_increment,<br>  name varchar(30) not null default &#39;&#39;,<br>  sex int(1) not null default &#39;0&#39;,<br>  primary key(id)<br>)default charset&#x3D;utf8 auto_increment&#x3D;1<br>partition by range(id) (<br>  partition p0 values less than (3),<br>  partition p1 values less than (6),<br>  partition p2 values less than (9),<br>  partition p3 values less than (12),<br>  partition p4 values less than maxvalue<br>);<br></code></pre></td></tr></table></figure>
<p><strong>插入些数据</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into testdb.user(name,sex)values (&#39;tom1&#39;,&#39;0&#39;);<br>insert into testdb.user(name,sex)values (&#39;tom2&#39;,&#39;1&#39;);<br>insert into testdb.user(name,sex)values (&#39;tom3&#39;,&#39;1&#39;);<br>insert into testdb.user(name,sex)values (&#39;tom4&#39;,&#39;0&#39;);<br>insert into testdb.user(name,sex)values (&#39;tom5&#39;,&#39;0&#39;);<br>insert into testdb.user(name,sex)values (&#39;tom6&#39;,&#39;1&#39;);<br>insert into testdb.user(name,sex)values (&#39;tom7&#39;,&#39;1&#39;);<br>insert into testdb.user(name,sex)values (&#39;tom8&#39;,&#39;1&#39;);<br>insert into testdb.user(name,sex)values (&#39;tom9&#39;,&#39;1&#39;);<br>insert into testdb.user(name,sex)values (&#39;tom10&#39;,&#39;1&#39;);<br>insert into testdb.user(name,sex)values (&#39;tom11&#39;,&#39;1&#39;);<br>insert into testdb.user(name,sex)values (&#39;tom12&#39;,&#39;1&#39;);<br>insert into testdb.user(name,sex)values (&#39;tom13&#39;,&#39;1&#39;);<br>insert into testdb.user(name,sex)values (&#39;tom14&#39;,&#39;1&#39;);<br></code></pre></td></tr></table></figure>
<p><strong>到存放数据库表文件的地方看一下</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select * from testdb.user partition(p4);<br></code></pre></td></tr></table></figure>
<p><img src="https://gitee.com/xgpqq/tuchuang/raw/master/img/image-20200623164606421.png" alt="image-20200623164606421"></p>
<p><strong>从information_schema系统库中的partitions表中查看分区信息</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from information_schema.partitions where table_schema&#x3D;&#39;test2&#39; and table_name&#x3D;&#39;user&#39;\G;<br></code></pre></td></tr></table></figure>
<h4 id="测试在创建表之后分区是否可以">测试在创建表之后分区是否可以</h4>
<p><img src="https://gitee.com/xgpqq/tuchuang/raw/master/img/image-20200623165711016.png" alt="image-20200623165711016"></p>
<h2 id="2、新增分区">2、新增分区</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; alter table test2.user add partition (partition partionname values less<br>than (n));<br></code></pre></td></tr></table></figure>
<h3 id="（1）删除分区-当删除了一个分区，也同时删除了该分区中所有的数据。"><strong>（1）删除分区 当删除了一个分区，也同时删除了该分区中所有的数据。</strong></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">alter table testdb.user drop partition p4;<br><br>alter table testdb.user add partition(<br>  partition m5 values less than (13)<br>);<br><br>select * from testdb.user partition(m5);<br></code></pre></td></tr></table></figure>
<h4 id="查看分区">查看分区</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select * from information_schema.&#96;PARTITIONS&#96;;<br></code></pre></td></tr></table></figure>
<p><img src="https://gitee.com/xgpqq/tuchuang/raw/master/img/image-20200623171600295.png" alt="image-20200623171600295"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select PARTITION_NAME,PARTITION_METHOD,PARTITION_DESCRIPTION,TABLE_ROWS<br>from information_schema.&#96;PARTITIONS&#96;<br>where TABLE_SCHEMA&#x3D;&#39;testdb&#39;<br>and table_name&#x3D; &#39;user&#39;;<br></code></pre></td></tr></table></figure>
<p><img src="https://gitee.com/xgpqq/tuchuang/raw/master/img/image-20200623171843472.png" alt="image-20200623171843472"></p>
<h2 id="3、分区的合并">3、分区的合并</h2>
<p><strong>下面的SQL，将p1 – p3合并为2个分区p01– p02</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">alter table testdb.user<br>reorganize partition p1,p2,p3 into(<br>truepartition t1 values less than (8),<br>truepartition t2 values less than (12)<br>);<br></code></pre></td></tr></table></figure>
<p><img src="https://gitee.com/xgpqq/tuchuang/raw/master/img/image-20200623172300138.png" alt="image-20200623172300138"></p>
<h2 id="4、未分区表和分区表性能测试-创建一个未分区的表">4、未分区表和分区表性能测试 创建一个未分区的表</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table test2.tab1(c1 int,c2 varchar(30),c3 date);<br>创建分区表,按日期的年份拆分<br>mysql&gt; CREATE TABLE test2.tab2 ( c1 int, c2 varchar(30) , c3 date )<br>PARTITION BY RANGE (year(c3)) (PARTITION p0 VALUES LESS THAN (1995),<br>PARTITION p1 VALUES LESS THAN (1996) , PARTITION p2 VALUES LESS THAN (1997) ,<br>PARTITION p3 VALUES LESS THAN (1998) , PARTITION p4 VALUES LESS THAN (1999) ,<br>PARTITION p5 VALUES LESS THAN (2000) , PARTITION p6 VALUES LESS THAN (2001) ,<br>PARTITION p7 VALUES LESS THAN (2002) , PARTITION p8 VALUES LESS THAN (2003) ,<br>PARTITION p9 VALUES LESS THAN (2004) , PARTITION p10 VALUES LESS THAN (2010),<br>PARTITION p11 VALUES LESS THAN MAXVALUE );<br></code></pre></td></tr></table></figure>
<p><strong>注意:最后一行，考虑到可能的最大值 通过存储过程插入100万条测试数据 创建存储过程：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; delimiter $$&#x2F;&#x2F;指定存储过程结束符<br>mysql&gt;CREATE PROCEDURE load_part_tab()<br>truetruebegin<br>truedeclare v int default 0;<br>truewhile v &lt; 2000000<br>truedo<br>truetrueinsert into test2.tab1<br>truetruevalues (v,&#39;testing partitions&#39;,adddate(&#39;1995-01-01&#39;,<br>(rand(v)*36520) mod 3652));<br>trueset v &#x3D; v + 1;<br>trueend while;<br>trueend<br>true$$<br></code></pre></td></tr></table></figure>
<p><strong>注：RAND()函数在0和1之间产生一个随机数，如果一个整数参数N被指定，它被用作种子值。每个种子产生的随机数序列是不同的。</strong></p>
<p><strong>执行存储过程load_part_tab向test2.tab1表插入数据</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; delimiter ; &#x2F;&#x2F; 注意有空格<br>mysql&gt; call load_part_tab();<br>向test2.tab2表中插入数据<br>mysql&gt; insert into test2.tab2 select * from test2.tab1;<br>测试SQL性能<br>mysql&gt; select count(*) from test2.tab1 where c3 &gt; &#39;1995-01-01&#39; and c3 &lt; &#39;1995-12-31&#39;;<br>+----------+<br>| count(*) |<br>+----------+<br>| 219642 |<br>+----------+<br>1 row in set (0.84 sec)<br>mysql&gt; select count(*) from test2.tab2 where c3 &gt; &#39;1995-01-01&#39; and c3 &lt; &#39;1995-12-31&#39;;<br>+----------+<br>| count(*) |<br>+----------+<br>| 219642 |<br>+----------+<br>1 row in set (0.09 sec)<br></code></pre></td></tr></table></figure>
<p><strong>结果表明分区表比未分区表的执行时间少很多。 通过explain语句来分析执行情况</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; flush tables;<br>mysql&gt; explain select count(*) from test2.tab1 where c3 &gt; &#39;1995-01-01&#39; and c3 &lt;<br>&#39;1995-12-31&#39;\G;<br>*************************** 1. row ***************************<br>id: 1<br>select_type: SIMPLE<br>table: tab1<br>partitions: NULL<br>type: ALL<br>possible_keys: NULL<br>key: NULL<br>key_len: NULL<br>ref: NULL<br>rows: 2001552<br>filtered: 11.11<br>Extra: Using where<br>1 row in set, 1 warning (0.00 sec)<br>mysql&gt; explain select count(*) from test2.tab2 where c3 &gt; &#39;1995-01-01&#39; and c3 &lt;<br>&#39;1995-12-31&#39;\G;<br>*************************** 1. row ***************************<br>id: 1<br>select_type: SIMPLE<br>table: tab2<br>partitions: p1<br>type: ALL<br>possible_keys: NULL<br>key: NULL<br>key_len: NULL<br>ref: NULL<br>rows: 220206<br>filtered: 11.11<br>Extra: Using where<br>1 row in set, 1 warning (0.00 sec)<br></code></pre></td></tr></table></figure>
<p><strong>explain语句显示了SQL查询要处理的记录数目可以看出分区表比未分区表的明显扫描的记录要少很多。 创建索引后情况测试</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create index idx_of_c3 on test2.tab1(c3);<br>Query OK, 0 rows affected (5.07 sec)<br>Records: 0 Duplicates: 0 Warnings: 0<br>mysql&gt; create index idx_of_c3 on test2.tab2(c3);<br>Query OK, 0 rows affected (4.87 sec)<br>Records: 0 Duplicates: 0 Warnings: 0<br>mysql&gt; flush tables;<br>mysql&gt; select count(*) from test2.tab1 where c3 &gt; &#39;1996-01-01&#39; and c3 &lt; &#39;1996-12-31&#39;;<br>+----------+<br>| count(*) |<br>+----------+<br>| 220264 |<br>+----------+<br>1 row in set (0.12 sec)<br></code></pre></td></tr></table></figure>
<p><strong>重启mysqld服务</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select count(*) from test2.tab2 where c3 &gt; &#39;1996-01-01&#39; and c3 &lt; &#39;1996-12-<br>31&#39;;<br>+----------+<br>| count(*) |<br>+----------+<br>| 220264 |<br>+----------+<br>1 row in set (0.11 sec)<br></code></pre></td></tr></table></figure>
<p><strong>创建索引后分区表比未分区表相差不大（数据量越大差别会明显些）</strong></p>
<h2 id="5、分区时，将不同分区放到不同存储位置">5、分区时，将不同分区放到不同存储位置</h2>
<h3 id="（1）建表时，提前创建好存储目录，并授权给mysql">（1）建表时，提前创建好存储目录，并授权给mysql:</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@mysql ~]# cd /opt/<br>[root@mysql opt]# mkdir -p data/ares&#123;1..3&#125;<br>[root@mysql opt]# ll data/<br>总用量 0<br>drwxr-xr-x 2 root root 6 Jun 23 17:27 ares1<br>drwxr-xr-x 2 root root 6 Jun 23 17:27 ares2<br>drwxr-xr-x 2 root root 6 Jun 23 17:27 ares3<br></code></pre></td></tr></table></figure>
<h3 id="（2）创建表格。">（2）创建表格。</h3>
<blockquote>
<p><strong>注：使用mysql默认的存储引擎inodb时候，只需要指定data directory 就可以，因为inodb的数据和索引在一个文件中。但是创建表格时指定engine=myisam时，修改分区的存储位置，需要同时指定data directory和index directory。</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table user(<br>  id int not null auto_increment,<br>  name varchar(30) not null default &#39;&#39;,<br>  primary key(id)<br>) engine&#x3D;innodb default charset&#x3D;utf8 auto_increment&#x3D;1 <br>partition by range(id)(<br>  partition p1 values less than (3) data directory &#39;&#x2F;opt&#x2F;data&#x2F;area1&#39;,<br>  partition p2 values less than (6) data directory &#39;&#x2F;opt&#x2F;data&#x2F;area2&#39;,<br>  partition p3 values less than (9) data directory &#39;&#x2F;opt&#x2F;data&#x2F;area3&#39;);<br></code></pre></td></tr></table></figure>
<h3 id="（3）查看分区情况">（3）查看分区情况</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">[root@mysql ~]# ls -R &#x2F;data&#x2F;<br>&#x2F;data&#x2F;:<br>area1 area2 area3<br>&#x2F;data&#x2F;area1:<br>test<br>&#x2F;data&#x2F;area1&#x2F;test:<br>user#P#p1.ibd<br>&#x2F;data&#x2F;area2:<br>test<br>&#x2F;data&#x2F;area2&#x2F;test:<br>user#P#p2.ibd<br>&#x2F;data&#x2F;area3:<br>test<br>&#x2F;data&#x2F;area3&#x2F;test:<br>user#P#p3.ibd<br></code></pre></td></tr></table></figure>
<p><strong>查看默认数据存储位置的文件：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">[root@mysql ~]# cd &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;test<br>[root@mysql test]# ls –l<br>-rw-r----- 1 mysql mysql 30 9月 22 17:55 user#P#p1.isl<br>-rw-r----- 1 mysql mysql 30 9月 22 17:55 user#P#p2.isl<br>-rw-r----- 1 mysql mysql 30 9月 22 17:55 user#P#p3.isl<br></code></pre></td></tr></table></figure>
<h2 id="6、mysql分区的类型">6、mysql分区的类型</h2>
<h3 id="（1）RANGE分区">（1）RANGE分区</h3>
<p><strong>基于属于一个给定连续区间的列值，把多行分配给分区。这些区间要连续且不能相互重叠，使用VALUES LESS THAN操作符来进行定义。以下是实例。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE employees (<br>id INT NOT NULL,<br>fname VARCHAR(30),<br>lname VARCHAR(30),<br>hired DATE NOT NULL DEFAULT &#39;1970-01-01&#39;,<br>separated DATE NOT NULL DEFAULT &#39;9999-12-31&#39;,<br>job_code INT NOT NULL,<br>store_id INT NOT NULL<br>)<br>partition BY RANGE (store_id) (<br>partition p0 VALUES LESS THAN (6),<br>partition p1 VALUES LESS THAN (11),<br>partition p2 VALUES LESS THAN (16),<br>partition p3 VALUES LESS THAN (21)<br>);<br></code></pre></td></tr></table></figure>
<p><strong>按照这种分区方案，在商店1到5工作的雇员相对应的所有行被保存在分区P0中，商店6到10的雇员保存在P1中，依次类推。注意，每个分区都是按顺序进行定义，从最低到最高。 对于包含数据(72, ‘Michael’, ‘Widenius’,‘1998-06-25’, NULL, 13)的一个新行，可以很容易地确定它将插入到p2分区中，但是如果增加了一个编号为第21的商店，将会发生什么呢？在这种方案下，由于没有规则把store_id大于20的商店包含在内，服务器将不知道把该行保存在何处，将会导致错误。要避免这种错误，可以创建maxvalue分区，所有不在指定范围内的记录都会被存储到maxvalue所在的分区中。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; alter table test2.user add partition (partition p4 values less than maxvalue);<br></code></pre></td></tr></table></figure>
<h3 id="（2）LIST分区">（2）LIST分区</h3>
<p><strong>类似于按RANGE分区，区别在于LIST分区是基于列值匹配一个离散值集合中的某个值来进行选择。LIST分区通过使用“PARTITION BY LIST(expr)”来实现，其中“expr” 是某列值或一个基于某个列值、并返回一个整数值的表达式，然后通过“VALUES IN (value_list)”的方式来定义每个分区，其中“value_list”是一个通过逗号分隔的整数列表。 要按照属于同一个地区商店的行保存在同一个分区中的方式来分割表，可以使用下面的“CREATE TABLE”语句：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE employees (<br>id INT NOT NULL,<br>fname VARCHAR(30),<br>lname VARCHAR(30),<br>hired DATE NOT NULL DEFAULT &#39;1970-01-01&#39;,<br>separated DATE NOT NULL DEFAULT &#39;9999-12-31&#39;,<br>job_code INT,<br>store_id INT<br>)<br>PARTITION BY LIST(store_id)(<br>PARTITION pNorth VALUES IN (3,5,6,9,17),<br>PARTITION pEast VALUES IN (1,2,10,11,19,20),<br>PARTITION pWest VALUES IN (4,12,13,14,18),<br>PARTITION pCentral VALUES IN (7,8,15,16)<br>);<br></code></pre></td></tr></table></figure>
<p><strong>这使得在表中增加或删除指定地区的雇员记录变得容易起来。例如，假定西区的所有音像店都卖给了其他公司。那么与在西区音像店工作雇员相关的所有记录（行）可以使用查询“<code>ALTER TABLE employees DROP PARTITION pWest;</code> ”来进行删除，它与具有同样作用的DELETE （删除）查询“<code>DELETE query DELETE FROM employees WHERE store_id IN (4,12,13,14,18);</code> ”比起来，要有效得多。 要点：如果试图插入列值不在分区值列表中的一行时，那么“INSERT”查询将失败并报错。例如，假定LIST分区的采用上面的方案，下面的插入将失败：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO employees VALUES(224, &#39;Linus&#39;, &#39;Torvalds&#39;, &#39;2002-05-01&#39;, &#39;2004-10-12&#39;, 42, 21);<br></code></pre></td></tr></table></figure>
<p><strong>这是因为“store_id”列值21不能在用于定义分区pNorth, pEast, pWest,或pCentral的值列表中找到。要重点注意的是，LIST分区没有类似如“VALUES LESS THAN MAXVALUE”这样的包含其他值在内的定义。将要匹配的任何值都必须在值列表中找到。 3.HASH分区 这种模式允许DBA通过对表的一个或多个列的Hash Key进行计算，最后通过这个Hash码不同数值对应的数据区域进行分区。 hash分区的目的是将数据均匀的分布到预先定义的各个分区中，保证各分区的数据量大致一致。在RANGE和LIST分区中，必须明确指定一个给定的列值或列值集合应该保存在哪个分区中；而在HASH分区中，MYSQL自动完成这些工作，用户所要定一个列值或者表达式，以及指定被分区的表将要被分割成的分区数量。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table t_hash( a int(11), b datetime) partition by hash(year(b)) partitions 4;<br></code></pre></td></tr></table></figure>
<h4 id="hash的分区函数页需要返回一个整数值。partitions子句中的值是一个非负整数，不加的partitions子句的话，默认为分区数为1。"><strong>hash的分区函数页需要返回一个整数值。partitions子句中的值是一个非负整数，不加的partitions子句的话，默认为分区数为1。</strong></h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table t_hash( a int(11), b datetime) partition by hash(year(b)) partitions 4;<br>insert into t_hash values(1,&#39;2010-04-01&#39;);<br><br>select PARTITION_NAME,PARTITION_METHOD,PARTITION_DESCRIPTION,TABLE_ROWS<br>from information_schema.&#96;PARTITIONS&#96;<br>where TABLE_SCHEMA&#x3D;&#39;testdb&#39;<br>and table_name&#x3D; &#39;t_hash&#39;;<br></code></pre></td></tr></table></figure>
<p><img src="https://gitee.com/xgpqq/tuchuang/raw/master/img/image-20200623180147872.png" alt="image-20200623180147872"></p>
<p><strong>该记录会被放入分区p2中。因为插入2010-04-01进入表t_hash,那么</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">MOD(YEAR('2010-04-01'),4)=2</span><br><span class="hljs-string">mysql&gt;</span> <span class="hljs-string">select</span> <span class="hljs-string">*</span> <span class="hljs-string">from</span> <span class="hljs-string">information_schema.partitions</span> <span class="hljs-string">where</span> <span class="hljs-string">table_schema='test2'</span> <span class="hljs-string">and</span><br><span class="hljs-string">table_name='t_hash'\G;</span><br><span class="hljs-string">***************************</span> <span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">row</span> <span class="hljs-string">***************************</span><br>                  <span class="hljs-attr">TABLE_CATALOG:</span> <span class="hljs-string">def</span><br>                  <span class="hljs-attr">TABLE_SCHEMA:</span> <span class="hljs-string">testdb</span><br>                  <span class="hljs-attr">TABLE_NAME:</span> <span class="hljs-string">t_hash</span><br>                  <span class="hljs-attr">PARTITION_NAME:</span> <span class="hljs-string">p0</span><br>                  <span class="hljs-attr">SUBPARTITION_NAME:</span> <span class="hljs-literal">NULL</span><br>                  <span class="hljs-attr">PARTITION_ORDINAL_POSITION:</span> <span class="hljs-number">1</span><br>                  <span class="hljs-attr">SUBPARTITION_ORDINAL_POSITION:</span> <span class="hljs-literal">NULL</span><br>                  <span class="hljs-attr">PARTITION_METHOD:</span> <span class="hljs-string">HASH</span><br>                  <span class="hljs-attr">SUBPARTITION_METHOD:</span> <span class="hljs-literal">NULL</span><br>                  <span class="hljs-attr">PARTITION_EXPRESSION:</span> <span class="hljs-string">year(b)</span><br>                  <span class="hljs-attr">SUBPARTITION_EXPRESSION:</span> <span class="hljs-literal">NULL</span><br>                  <span class="hljs-attr">PARTITION_DESCRIPTION:</span> <span class="hljs-literal">NULL</span><br>                  <span class="hljs-attr">TABLE_ROWS:</span> <span class="hljs-number">0</span><br>                  <span class="hljs-attr">AVG_ROW_LENGTH:</span> <span class="hljs-number">0</span><br>                  <span class="hljs-attr">DATA_LENGTH:</span> <span class="hljs-number">16384</span><br>                  <span class="hljs-attr">MAX_DATA_LENGTH:</span> <span class="hljs-literal">NULL</span><br>                  <span class="hljs-attr">INDEX_LENGTH:</span> <span class="hljs-number">0</span><br>                  <span class="hljs-attr">DATA_FREE:</span> <span class="hljs-number">0</span><br>                  <span class="hljs-attr">CREATE_TIME:</span> <span class="hljs-number">2016</span><span class="hljs-number">-09</span><span class="hljs-number">-16</span> <span class="hljs-number">22</span><span class="hljs-string">:48:59</span><br>                  <span class="hljs-attr">UPDATE_TIME:</span> <span class="hljs-number">2016</span><span class="hljs-number">-09</span><span class="hljs-number">-17</span> <span class="hljs-number">23</span><span class="hljs-string">:36:22</span><br>                  <span class="hljs-attr">CHECK_TIME:</span> <span class="hljs-literal">NULL</span><br>                  <span class="hljs-attr">CHECKSUM:</span> <span class="hljs-literal">NULL</span><br>                  <span class="hljs-attr">PARTITION_COMMENT:</span><br>                  <span class="hljs-attr">NODEGROUP:</span> <span class="hljs-string">default</span>                  <br>                  <span class="hljs-attr">TABLESPACE_NAME:</span> <span class="hljs-literal">NULL</span><br></code></pre></td></tr></table></figure>
<p><strong>可以看到P2分区有一条记录。当前这个例子并不能把数据均匀的分布到各个分区，因为按照YEAR函数进行的，该值本身是离散的。如果对连续的值进行HASH分区，如自增长的主键，则可以较好地将数据平均分布。 请思考：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; insert into t_hash values(1,&#39;2012-04-01&#39;)<br></code></pre></td></tr></table></figure>
<p><strong>记录会插入哪个分区？</strong></p>
<h2 id="7、key分区">7、key分区</h2>
<p><strong>key分区和hash分区相似，不同在于hash分区是用户自定义函数进行分区，key分区使用mysql数据库提供的函数进行分区，NDB cluster使用MD5函数来分区，对于其他存储引擎mysql使用内部的hash函数。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table t_key( a int(11), b datetime) partition by key(b) partitions<br>4;<br></code></pre></td></tr></table></figure>
<p>上面的RANGE、LIST、HASH、KEY四种分区中，分区的条件必须是整形，如果不是整形需要通过函数将其转换为整形。</p>
<h2 id="8、columns分区">8、columns分区</h2>
<p><strong>mysql-5.5开始支持COLUMNS分区，可视为RANGE和LIST分区的进化，COLUMNS分区可以直接使用非整形数据进行分区。</strong></p>
<h3 id="COLUMNS分区支持以下数据类型：">COLUMNS分区支持以下数据类型：</h3>
<ul>
<li><strong>所有整形，如INT SMALLINT TINYINT BIGINT。FLOAT和DECIMAL则不支持。</strong></li>
<li><strong>日期类型，如DATE和DATETIME。其余日期类型不支持。</strong></li>
<li><strong>字符串类型，如CHAR、VARCHAR、BINARY和VARBINARY。</strong></li>
<li><strong>BLOB和TEXT类型不支持。</strong></li>
<li><strong>COLUMNS可以使用多个列进行分区。</strong></li>
</ul>
<h3 id="mysql分表和分区有什么区别呢">mysql分表和分区有什么区别呢</h3>
<h4 id="实现方式上">实现方式上</h4>
<p><strong>a）mysql的分表是真正的分表，一张表分成很多表后，每一个小表都是完整的一张表，都对</strong><br>
<strong>应三个文件，一个.MYD数据文件，.MYI索引文件，.frm表结构文件。</strong></p>
<p><strong>b）分区不一样，一张大表进行分区后，他还是一张表，不会变成二张表，但是他存放数据的区块变多了</strong></p>
<h4 id="数据处理上">数据处理上</h4>
<p><strong>a）分表后，数据都是存放在分表里，总表只是一个外壳，存取数据发生在一个一个的分表里面。</strong></p>
<p><strong>b）分区呢，不存在分表的概念，分区只不过把存放数据的文件分成了许多小块，分区后的表呢，还是一张表，数据处理还是由自己来完成。</strong></p>
<h4 id="提高性能上">提高性能上</h4>
<p><strong>a）分表后，单表的并发能力提高了，磁盘I/O性能也提高了。并发能力为什么提高了呢，因为查寻一次所花的时间变短了，如果出现高并发的话，总表可以根据不同的查询，将并发压力分到不同的小表里面。</strong></p>
<p><strong>b）mysql提出了分区的概念，主要是想突破磁盘I/O瓶颈，想提高磁盘的读写能力，来增加mysql性能。在这一点上，分区和分表的测重点不同，分表重点是存取数据时，如何提高mysql并发能力上；而分区呢，如何突破磁盘的读写能力，从而达到提高mysql性能的目的。</strong></p>
<h4 id="实现的难易度上">实现的难易度上</h4>
<p><strong>a）分表的方法有很多，用merge来分表，是最简单的一种方式。这种方式跟分区难易度差不多，并且对</strong></p>
<p><strong>程序代码来说可以做到透明的。如果是用其他分表方式就比分区麻烦了。</strong><br>
<strong>b）分区实现是比较简单的，建立分区表，根建平常的表没什么区别，并且对开代码端来说是透明的。</strong></p>
<h3 id="mysql分表和分区有什么联系？">mysql分表和分区有什么联系？</h3>
<ul>
<li><strong>都能提高mysql的性高，在高并发状态下都有一个良好的表现。</strong></li>
<li><strong>分表和分区不矛盾，可以相互配合的，对于那些大访问量，并且表数据比较多的表，我们可以采取分表和分区结合的方式，访问量不大，但是表数据很多的表，我们可以采取分区的方式等。</strong></li>
<li><strong>分表技术是比较麻烦的，需要手动去创建子表，app服务端读写时候需要计算子表名。采用merge好一些，但也要创建子表和配置子表间的union关系。</strong></li>
<li><strong>表分区相对于分表，操作方便，不需要创建子表。</strong></li>
</ul>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Wu Shao Dong</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://wsdlxgp.top/posts/49wn.html">https://wsdlxgp.top/posts/49wn.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://wsdlxgp.top" target="_blank">Xgp & Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL%E4%BC%98%E5%8C%96/">MySQL优化</a></div><div class="post_share"><div class="social-share" data-image="https://gitee.com/xgpqq/tuchuang/raw/master/img/aaaaaaaa.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="http://xgp-cunchu.test.upcdn.net/k8s/3.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="http://xgp-cunchu.test.upcdn.net/k8s/1.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li><li class="reward-item"><img class="post-qr-code__img" src="http://xgp-cunchu.test.upcdn.net/k8s/2.jpg" alt="QQ支付"/><div class="post-qr-code__desc">QQ支付</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/posts/49et.html"><img class="prev_cover" src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qwe%20(3).jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">mysqldump备份还原</div></div></a></div><div class="next-post pull_right"><a href="/posts/49an.html"><img class="next_cover" src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qwe%20(5).jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">MySQL配置参数优化</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/posts/49ca.html" title="MySQL之my.cnf配置文件优化"><img class="relatedPosts_cover" src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qwe%20(7).jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-06-30</div><div class="relatedPosts_title">MySQL之my.cnf配置文件优化</div></div></a></div><div class="relatedPosts_item"><a href="/posts/49c4.html" title="MySQL配置参数优化"><img class="relatedPosts_cover" src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qwe%20(8).jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-06-30</div><div class="relatedPosts_title">MySQL配置参数优化</div></div></a></div><div class="relatedPosts_item"><a href="/posts/49c6.html" title="MySQL软件优化"><img class="relatedPosts_cover" src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qwe%20(6).jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-06-30</div><div class="relatedPosts_title">MySQL软件优化</div></div></a></div><div class="relatedPosts_item"><a href="/posts/49an.html" title="MySQL配置参数优化"><img class="relatedPosts_cover" src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qwe%20(5).jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-06-30</div><div class="relatedPosts_title">MySQL配置参数优化</div></div></a></div><div class="relatedPosts_item"><a href="/posts/49lt.html" title="Xtrabackup备份还原"><img class="relatedPosts_cover" src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qwe%20(2).jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-06-30</div><div class="relatedPosts_title">Xtrabackup备份还原</div></div></a></div><div class="relatedPosts_item"><a href="/posts/49et.html" title="mysqldump备份还原"><img class="relatedPosts_cover" src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qwe%20(3).jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-06-30</div><div class="relatedPosts_title">mysqldump备份还原</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="lv-container" data-id="city" data-uid="MTAyMC80OTM0NS8yNTgzNw=="><script>(function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
})(document, 'script');</script></div></div></article></main><footer id="footer" style="background-image: url(https://gitee.com/xgpqq/tuchuang/raw/master/img/qwe%20(4).jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By Wu Shao Dong</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="ypy"><a href="https://console.upyun.com/services/file/" target="_blank" rel="noopener"><img class="icp-icon" src="/img/1591433700(1).png"/><span></span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode far fa-moon" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script><script src="/js/search/local-search.js"></script><script>var endLoading = function () {
  document.body.style.overflow = 'auto';
  document.getElementById('loading-box').classList.add("loaded")
}
window.addEventListener('load',endLoading)</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>