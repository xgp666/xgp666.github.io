<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="Wu Shao Dong"><meta name="copyright" content="Wu Shao Dong"><meta name="generator" content="Hexo 4.2.0"><meta name="theme" content="hexo-theme-yun"><meta name="description" content="一，k8s的资源对象 Deployment、Service、Pod是k8s最核心的3个资源对象  **Deployment：**最常见的无状态应用的控制器，支持应用的扩缩容、滚动升级等操作。 **Service：**为弹性变动且存在生命周期的Pod对象提供了一个固定的访问接口，用于服务发现和服务访问。 **Pod：**是运行容器以及调度的最小单位。同一个pod可以同时运行多个容器，这些容器共享ne">
<meta property="og:type" content="article">
<meta property="og:title" content="06 pod资源对象">
<meta property="og:url" content="https://wsdlxgp.top/posts/cf38.html">
<meta property="og:site_name" content="Xgp &amp; Blog">
<meta property="og:description" content="一，k8s的资源对象 Deployment、Service、Pod是k8s最核心的3个资源对象  **Deployment：**最常见的无状态应用的控制器，支持应用的扩缩容、滚动升级等操作。 **Service：**为弹性变动且存在生命周期的Pod对象提供了一个固定的访问接口，用于服务发现和服务访问。 **Pod：**是运行容器以及调度的最小单位。同一个pod可以同时运行多个容器，这些容器共享ne">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-05-01T13:20:00.881Z">
<meta property="article:modified_time" content="2020-05-01T13:22:44.604Z">
<meta property="article:author" content="Wu Shao Dong">
<meta name="twitter:card" content="summary"><title>06 pod资源对象 | Xgp &amp; Blog</title><link rel="shortcut icon" type="image/svg+xml" href="/666.jpg"><link rel="mask-icon" href="/666.jpg" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="stylesheet" href="/css/hexo-theme-yun.css"><link rel="alternate" href="/atom.xml" title="Xgp & Blog"><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"root":"/","title":"小钢炮的站点","version":"0.7.2","anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;family=Source+Code+Pro&amp;display=swap" media="none" onload="this.media='all'"><script src="//at.alicdn.com/t/font_1140697_4i778vmn3jg.js" async></script><div class="js-Pjax"></div><link rel="alternate" href="/atom.xml" title="Xgp & Blog" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><canvas id="trianglify"></canvas><script defer src="https://cdn.jsdelivr.net/npm/trianglify@latest/dist/trianglify.min.js"></script><script>document.addEventListener("DOMContentLoaded", () => {
  const pattern = Trianglify({
    width: 800,
    height: 600,
    cell_size: 75,
    palette: ["YlGnBu", "GnBu", "Purples", "Blues"],
  });
  document.body.appendChild(pattern.canvas(trianglify));
});</script><div class="container"><a class="sidebar-toggle sidebar-toggle-fixed hty-icon-button"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><aside class="sidebar"><script defer src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="Wu Shao Dong"><img width="96" loading="lazy" src="/%E5%A4%B4%E5%83%8F.jpg" alt="Wu Shao Dong"></a><div class="site-author-name"><a href="/about/">Wu Shao Dong</a></div><a class="site-name" href="/about/site.html">Xgp &amp; Blog</a><sub class="site-subtitle">Today is still beautiful</sub><div class="site-desciption">Small steel gun article</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item site-state-posts"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">15</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">2</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">3</span></a></div><a class="site-state-item hty-icon-button" href="https://blog.51cto.com/14320361?type=1" target="_blank" rel="noopener" title="文档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://wpa.qq.com/msgrd?v=3&amp;uin=2877364346&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/xgp666" title="GitHub" target="_blank" style="color:#181717"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:2877364346@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">1.</span> <span class="toc-text">一，k8s的资源对象</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Pod的生命周期被定义为以下几个阶段。"><span class="toc-number">1.1.</span> <span class="toc-text">Pod的生命周期被定义为以下几个阶段。</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">2.</span> <span class="toc-text">环境介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">3.</span> <span class="toc-text">二，Namespace：名称空间</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-查看名称空间"><span class="toc-number">3.1.</span> <span class="toc-text">1.查看名称空间</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-查看名称空间详细信息"><span class="toc-number">3.2.</span> <span class="toc-text">2.查看名称空间详细信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-创建名称空间"><span class="toc-number">3.3.</span> <span class="toc-text">3.创建名称空间</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#查看一下"><span class="toc-number">3.3.1.</span> <span class="toc-text">查看一下</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-创建namespace的yaml文件"><span class="toc-number">3.4.</span> <span class="toc-text">4.创建namespace的yaml文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）查看格式"><span class="toc-number">3.4.1.</span> <span class="toc-text">（1）查看格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（2）创建namespace的yaml文件"><span class="toc-number">3.4.2.</span> <span class="toc-text">（2）创建namespace的yaml文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（3）运行namespace的yaml文件"><span class="toc-number">3.4.3.</span> <span class="toc-text">（3）运行namespace的yaml文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（4）查看一下"><span class="toc-number">3.4.4.</span> <span class="toc-text">（4）查看一下</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-删除名称空间"><span class="toc-number">3.5.</span> <span class="toc-text">4.删除名称空间</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-查看指定名称空间"><span class="toc-number">3.6.</span> <span class="toc-text">5.查看指定名称空间</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">4.</span> <span class="toc-text">三，Pod</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-编写一个pod的yaml文件"><span class="toc-number">4.1.</span> <span class="toc-text">1.编写一个pod的yaml文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）运行一下"><span class="toc-number">4.1.1.</span> <span class="toc-text">（1）运行一下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（2）查看一下"><span class="toc-number">4.1.2.</span> <span class="toc-text">（2）查看一下</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-指定pod的namespace名称空间"><span class="toc-number">4.2.</span> <span class="toc-text">2.指定pod的namespace名称空间</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）修改pod的yaml文件"><span class="toc-number">4.2.1.</span> <span class="toc-text">（1）修改pod的yaml文件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#执行一下"><span class="toc-number">4.2.1.0.1.</span> <span class="toc-text">执行一下</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（2）查看一下-2"><span class="toc-number">4.2.2.</span> <span class="toc-text">（2）查看一下</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-pod中镜像获取策略"><span class="toc-number">4.3.</span> <span class="toc-text">3.pod中镜像获取策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-观察pod和service的不同并关联"><span class="toc-number">4.4.</span> <span class="toc-text">4.观察pod和service的不同并关联</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）pod的yaml文件（指定端口）"><span class="toc-number">4.4.1.</span> <span class="toc-text">（1）pod的yaml文件（指定端口）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-删除之前的pod"><span class="toc-number">4.4.1.1.</span> <span class="toc-text">&lt;1&gt;删除之前的pod</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-执行一下"><span class="toc-number">4.4.1.2.</span> <span class="toc-text">&lt;2&gt;执行一下</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-查看一下"><span class="toc-number">4.4.1.3.</span> <span class="toc-text">&lt;3&gt;查看一下</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（2）pod的yaml文件（修改端口）"><span class="toc-number">4.4.2.</span> <span class="toc-text">（2）pod的yaml文件（修改端口）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-删除之前的pod-2"><span class="toc-number">4.4.2.1.</span> <span class="toc-text">&lt;1&gt;删除之前的pod</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-执行一下-2"><span class="toc-number">4.4.2.2.</span> <span class="toc-text">&lt;2&gt;执行一下</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-查看一下-2"><span class="toc-number">4.4.2.3.</span> <span class="toc-text">&lt;3&gt;查看一下</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-访问一下"><span class="toc-number">4.4.2.4.</span> <span class="toc-text">&lt;4&gt;访问一下</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（3）pod的yaml文件（添加标签）"><span class="toc-number">4.4.3.</span> <span class="toc-text">（3）pod的yaml文件（添加标签）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pod"><span class="toc-number">4.4.3.1.</span> <span class="toc-text">--------------------------------------pod---------------------------------------------</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#（4）编写一个service的yaml文件"><span class="toc-number">4.5.</span> <span class="toc-text">（4）编写一个service的yaml文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-执行一下"><span class="toc-number">4.5.0.1.</span> <span class="toc-text">&lt;1&gt;执行一下</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-查看一下"><span class="toc-number">4.5.0.2.</span> <span class="toc-text">&lt;2&gt;查看一下</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-访问一下-2"><span class="toc-number">4.5.0.3.</span> <span class="toc-text">&lt;4&gt;访问一下</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#service"><span class="toc-number">4.5.0.4.</span> <span class="toc-text">--------------------------------------service---------------------------------------------</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">5.</span> <span class="toc-text">四，容器的重启策略</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">6.</span> <span class="toc-text">五，pod的默认健康检查</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#（1）编写健康检查的yaml文件"><span class="toc-number">6.1.</span> <span class="toc-text">（1）编写健康检查的yaml文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-执行一下-2"><span class="toc-number">6.1.1.</span> <span class="toc-text">&lt;1&gt;执行一下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-查看一下-2"><span class="toc-number">6.1.2.</span> <span class="toc-text">&lt;2&gt;查看一下</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">7.</span> <span class="toc-text">六，小实验</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1）以自己的名称创建一个k8s名称空间，以下所有操作都在此名称空间中。"><span class="toc-number">7.1.</span> <span class="toc-text">1）以自己的名称创建一个k8s名称空间，以下所有操作都在此名称空间中。</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）创建名称空间"><span class="toc-number">7.1.1.</span> <span class="toc-text">（1）创建名称空间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（2）查看一下-3"><span class="toc-number">7.1.2.</span> <span class="toc-text">（2）查看一下</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2）创建一个Pod资源对象，使用的是私有仓库中私有镜像，其镜像的下载策略为：NEVER。-Pod的重启策略为：-Never"><span class="toc-number">7.2.</span> <span class="toc-text">2）创建一个Pod资源对象，使用的是私有仓库中私有镜像，其镜像的下载策略为：NEVER。 Pod的重启策略为： Never.</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3）创建出容器之后，执行非正常退出，查看Pod的最终状态。"><span class="toc-number">7.3.</span> <span class="toc-text">3）创建出容器之后，执行非正常退出，查看Pod的最终状态。</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）执行一下上面pod的yaml文件"><span class="toc-number">7.3.1.</span> <span class="toc-text">（1）执行一下上面pod的yaml文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（2）动态查看ns中test-pod的信息"><span class="toc-number">7.3.2.</span> <span class="toc-text">（2）动态查看ns中test-pod的信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-创建一个Service资源对象，与上述Pod对象关联，验证他们的关联性。"><span class="toc-number">7.4.</span> <span class="toc-text">4) 创建一个Service资源对象，与上述Pod对象关联，验证他们的关联性。</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）修改pod的yaml文件-2"><span class="toc-number">7.4.1.</span> <span class="toc-text">（1）修改pod的yaml文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）编写service的yaml文件"><span class="toc-number">7.4.2.</span> <span class="toc-text">（1）编写service的yaml文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（2）执行一下"><span class="toc-number">7.4.3.</span> <span class="toc-text">（2）执行一下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（3）查看一下"><span class="toc-number">7.4.4.</span> <span class="toc-text">（3）查看一下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（4）访问一下"><span class="toc-number">7.4.5.</span> <span class="toc-text">（4）访问一下</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://wsdlxgp.top/posts/cf38.html"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Wu Shao Dong"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Xgp &amp; Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline" style="color: undefined">06 pod资源对象</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="创建时间：2020-05-01 21:20:00" itemprop="dateCreated datePublished" datetime="2020-05-01T21:20:00+08:00">2020-05-01</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="本文字数"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-file-word-line"></use></svg></span> <span title="本文字数">14k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读时长"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-timer-line"></use></svg></span> <span title="阅读时长">25 分钟</span></span></span><div class="post-classify"></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content post-markdown"><h1>一，k8s的资源对象</h1>
<p><em><strong>Deployment、Service、Pod是k8s最核心的3个资源对象</strong></em></p>
<blockquote>
<p>**Deployment：**最常见的无状态应用的控制器，支持应用的扩缩容、滚动升级等操作。</p>
<p>**Service：**为弹性变动且存在生命周期的Pod对象提供了一个固定的访问接口，用于服务发现和服务访问。</p>
<p>**Pod：**是运行容器以及调度的最小单位。同一个pod可以同时运行多个容器，这些容器共享net、UTS、IPC，除此之外还有USER、PID、MOUNT。</p>
<p>**ReplicationController：**用于确保每个Pod副本在任意时刻都能满足目标数量，简单来说，它用于每个容器或容器组总是运行并且可以访问的：老一代无状态的Pod应用控制器。</p>
<p>**RwplicatSet：**新一代的无状态的Pod应用控制器，它与RC的不同之处在于支持的标签选择器不同，RC只支持等值选择器（键值对），RS还额外支持基于集合的选择器。</p>
<p>**StatefulSet：**用于管理有状态的持久化应用，如database服务程序，它与Deployment不同之处在于，它会为每一个pod创建一个独有的持久性标识符，并确保每个pod之间的顺序性。</p>
<p>**DaemonSet：**用于确保每一个节点都运行了某个pod的一个副本，新增的节点一样会被添加到此类pod，在节点移除时，此pod会被回收。</p>
<p>**Job：**用于管理运行完成后即可终止的应用，例如批量处理做作业任务；</p>
<p>**volume：**pv pvc<br>
<strong>ConfigMap：</strong><br>
<strong>Secret：</strong><br>
<strong>Role：</strong><br>
<strong>ClusterRole：</strong><br>
<strong>RoleBinding：</strong><br>
<strong>cluster RoleBinding：</strong><br>
<strong>service account：</strong><br>
<strong>Helm：</strong></p>
</blockquote>
<h2 id="Pod的生命周期被定义为以下几个阶段。">Pod的生命周期被定义为以下几个阶段。</h2>
<blockquote>
<ul>
<li><strong>Pending：Pod已经被创建，但是一个或者多个容器还未创建，这包括Pod调度阶段，以及容器镜像的下载过程。</strong></li>
<li><strong>Running：Pod已经被调度到Node，所有容器已经创建，并且至少一个容器在运行或者正在重启。</strong></li>
<li><strong>Succeeded：Pod中所有容器正常退出。</strong></li>
<li><strong>Failed：Pod中所有容器退出，至少有一个容器是一次退出的。</strong></li>
</ul>
</blockquote>
<h1>环境介绍</h1>
<table>
<thead>
<tr>
<th>主机</th>
<th>IP地址</th>
<th>服务</th>
</tr>
</thead>
<tbody>
<tr>
<td>master</td>
<td>192.168.1.21</td>
<td>k8s</td>
</tr>
<tr>
<td>node01</td>
<td>192.168.1.22</td>
<td>k8s</td>
</tr>
<tr>
<td>node02</td>
<td>192.168.1.23</td>
<td>k8s</td>
</tr>
</tbody>
</table>
<h1>二，Namespace：名称空间</h1>
<p><strong>默认的名称空间：</strong></p>
<blockquote>
<p><strong>Namespace（命名空间）是kubernetes系统中的另一个重要的概念，通过将系统内部的对象“分配”到不同的Namespace中，形成逻辑上分组的不同项目、小组或用户组，便于不同的分组在共享使用整个集群的资源的同时还能被分别管理。</strong></p>
<p><strong>Kubernetes集群在启动后，会创建一个名为“default”的Namespace，如果不特别指明Namespace，则用户创建的Pod、RC、Service都被系统创建到“default”的Namespace中。</strong></p>
</blockquote>
<h2 id="1-查看名称空间">1.查看名称空间</h2>
<pre><code>[root@master ~]# kubectl get namespaces
</code></pre>
<p>![image-20200109094700728](G:\四期\虚拟化\kubernetes\k8s文档\06 pod资源对象.assets\image-20200109094700728.png)</p>
<h2 id="2-查看名称空间详细信息">2.查看名称空间详细信息</h2>
<pre><code>[root@master ~]# kubectl describe ns default
</code></pre>
<p>![image-20200109095006067](G:\四期\虚拟化\kubernetes\k8s文档\06 pod资源对象.assets\image-20200109095006067.png)</p>
<h2 id="3-创建名称空间">3.创建名称空间</h2>
<pre><code>[root@master ~]# kubectl create ns bdqn
</code></pre>
<h3 id="查看一下">查看一下</h3>
<pre><code>[root@master ~]# kubectl get namespaces
</code></pre>
<p>![image-20200109095153448](G:\四期\虚拟化\kubernetes\k8s文档\06 pod资源对象.assets\image-20200109095153448.png)</p>
<h2 id="4-创建namespace的yaml文件">4.创建namespace的yaml文件</h2>
<h3 id="（1）查看格式">（1）查看格式</h3>
<pre><code>[root@master ~]# kubectl explain ns
//查看nasespace的yaml文件的格式
</code></pre>
<h3 id="（2）创建namespace的yaml文件">（2）创建namespace的yaml文件</h3>
<pre><code>[root@master ~]# vim test-ns.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: test
</code></pre>
<h3 id="（3）运行namespace的yaml文件">（3）运行namespace的yaml文件</h3>
<pre><code>[root@master ~]# kubectl apply -f test-ns.yaml 
</code></pre>
<h3 id="（4）查看一下">（4）查看一下</h3>
<pre><code>[root@master ~]# kubectl get ns
</code></pre>
<p>![image-20200109095808777](G:\四期\虚拟化\kubernetes\k8s文档\06 pod资源对象.assets\image-20200109095808777.png)</p>
<h2 id="4-删除名称空间">4.删除名称空间</h2>
<pre><code>[root@master ~]# kubectl delete ns test 
[root@master ~]# kubectl delete -f test-ns.yaml 
</code></pre>
<p><strong>注意：namespace资源对象进用于资源对象的隔离，并不能隔绝不同名称空间的Pod之间的通信。那是网络策略资源的功能。</strong></p>
<h2 id="5-查看指定名称空间">5.查看指定名称空间</h2>
<p><strong>可使用–namespace或-n选项</strong></p>
<pre><code>[root@master ~]# kubectl get pod -n kube-system 
[root@master ~]# kubectl get pod --namespace kube-system 
</code></pre>
<h1>三，Pod</h1>
<h2 id="1-编写一个pod的yaml文件">1.编写一个pod的yaml文件</h2>
<pre><code>[root@master ~]# vim pod.yaml
kind: Pod
apiVersion: v1
metadata:
  name: test-pod
spec:
  containers:
  - name: test-app
    image: 192.168.1.21:5000/web:v1
</code></pre>
<p><em><strong>pod的yaml文件不支持replicas字段</strong></em></p>
<h3 id="（1）运行一下">（1）运行一下</h3>
<pre><code>[root@master ~]# kubectl apply -f pod.yaml 
</code></pre>
<h3 id="（2）查看一下">（2）查看一下</h3>
<pre><code>[root@master ~]# kubectl get pod
</code></pre>
<p>![image-20200109100836911](G:\四期\虚拟化\kubernetes\k8s文档\06 pod资源对象.assets\image-20200109100836911.png)</p>
<p><em><strong>ps：这个pod因为是自己创建的，所以删除之后k8s并不会自动生成，相当于docker中创建</strong></em></p>
<h2 id="2-指定pod的namespace名称空间">2.指定pod的namespace名称空间</h2>
<h3 id="（1）修改pod的yaml文件">（1）修改pod的yaml文件</h3>
<pre><code>[root@master ~]# vim pod.yaml
kind: Pod        #资源类型
apiVersion: v1   #api版本
metadata:
  name: test-pod    #指定控制器名称
  namespace: bdqn   #指定namespace（名称空间）
spec:
  containers:      #容器
  - name: test-app  #容器名称
    image: 192.168.1.21:5000/web:v1  #镜像
</code></pre>
<h5 id="执行一下">执行一下</h5>
<pre><code>[root@master ~]# kubectl apply -f pod.yaml 
</code></pre>
<h3 id="（2）查看一下-2">（2）查看一下</h3>
<pre><code>[root@master ~]#  kubectl get pod -n bdqn 
//根据namespace名称查看
</code></pre>
<p>![image-20200109101521992](G:\四期\虚拟化\kubernetes\k8s文档\06 pod资源对象.assets\image-20200109101521992.png)</p>
<h2 id="3-pod中镜像获取策略">3.pod中镜像获取策略</h2>
<blockquote>
<p>**Always：**镜像标签为“laster”或镜像不存在时，总是从指定的仓库中获取镜像。</p>
<p>**IfNotPresent：**仅当本地镜像不存在时才从目标仓库下载。</p>
<p>**Never：**禁止从仓库中下载镜像，即只使用本地镜像。</p>
</blockquote>
<p><em><strong>注意：对于标签为“laster”或者标签不存在，其默认的镜像下载策略为“Always”，而对于其他的标签镜像，默认策略为“IfNotPresent”。</strong></em></p>
<h2 id="4-观察pod和service的不同并关联">4.观察pod和service的不同并关联</h2>
<h3 id="（1）pod的yaml文件（指定端口）">（1）pod的yaml文件（指定端口）</h3>
<pre><code>[root@master ~]# vim pod.yaml 
kind: Pod          #资源类型
apiVersion: v1      #api版本
metadata:
  name: test-pod       #指定控制器名称
  namespace: bdqn   #指定namespace（名称空间）
spec:
  containers:                          #容器
  - name: test-app                    #容器名称
    image: 192.168.1.21:5000/web:v1   #镜像
    imagePullPolicy: IfNotPresent   #获取的策略
    ports:
    - protocol: TCP
      containerPort: 80  
</code></pre>
<h4 id="1-删除之前的pod">&lt;1&gt;删除之前的pod</h4>
<pre><code>[root@master ~]# kubectl delete pod -n bdqn test-pod 
</code></pre>
<h4 id="2-执行一下">&lt;2&gt;执行一下</h4>
<pre><code>[root@master ~]# kubectl apply -f pod.yaml 
</code></pre>
<h4 id="3-查看一下">&lt;3&gt;查看一下</h4>
<pre><code>[root@master ~]# kubectl get pod -n bdqn 
</code></pre>
<p>![image-20200109110215669](G:\四期\虚拟化\kubernetes\k8s文档\06 pod资源对象.assets\image-20200109110215669.png)</p>
<h3 id="（2）pod的yaml文件（修改端口）">（2）pod的yaml文件（修改端口）</h3>
<pre><code>[root@master ~]# vim pod.yaml 
kind: Pod
apiVersion: v1
metadata:
  name: test-pod
  namespace: bdqn
spec:
  containers:
  - name: test-app
    image: 192.168.1.21:5000/web:v1
    imagePullPolicy: IfNotPresent
    ports:
    - protocol: TCP
      containerPort: 90   #改一下端口
</code></pre>
<h4 id="1-删除之前的pod-2">&lt;1&gt;删除之前的pod</h4>
<pre><code>[root@master ~]# kubectl delete pod -n bdqn test-pod 
</code></pre>
<h4 id="2-执行一下-2">&lt;2&gt;执行一下</h4>
<pre><code>[root@master ~]# kubectl apply -f pod.yaml 
</code></pre>
<h4 id="3-查看一下-2">&lt;3&gt;查看一下</h4>
<pre><code>[root@master ~]# kubectl get pod -n bdqn -o wide
</code></pre>
<p>![image-20200109110409584](G:\四期\虚拟化\kubernetes\k8s文档\06 pod资源对象.assets\image-20200109110409584.png)</p>
<h4 id="4-访问一下">&lt;4&gt;访问一下</h4>
<p>![image-20200109110430334](G:\四期\虚拟化\kubernetes\k8s文档\06 pod资源对象.assets\image-20200109110430334.png)</p>
<p><strong>会发现修改的90端口并不生效，他只是一个提示字段并不生效。</strong></p>
<h3 id="（3）pod的yaml文件（添加标签）">（3）pod的yaml文件（添加标签）</h3>
<pre><code>[root@master ~]# vim pod.yaml 
kind: Pod
apiVersion: v1
metadata:
  name: test-pod
  namespace: bdqn
  labels:                 #标签
    app: test-web          #标签名称
spec:
  containers:
  - name: test-app
    image: 192.168.1.21:5000/web:v1
    imagePullPolicy: IfNotPresent
    ports:
    - protocol: TCP
      containerPort: 90   #改一下端口
</code></pre>
<h4 id="pod">--------------------------------------pod---------------------------------------------</h4>
<h2 id="（4）编写一个service的yaml文件">（4）编写一个service的yaml文件</h2>
<pre><code>[root@master ~]# vim test-svc.yaml 
apiVersion: v1      #api版本
kind: Service          #资源类型
metadata:
  name: test-svc       #指定控制器名称
  namespace: bdqn   #指定namespace（名称空间）
spec:
  selector:          #标签
    app: test-web    #标签名称（须和pod的标签名称一致）
  ports:              
  - port: 80          #宿主机端口
    targetPort: 80    #容器端口
</code></pre>
<p><em><strong>会发现添加的80端口生效了，所以不能乱改。</strong></em></p>
<h4 id="1-执行一下">&lt;1&gt;执行一下</h4>
<pre><code>[root@master ~]# kubectl apply -f test-svc.yaml
</code></pre>
<h4 id="2-查看一下">&lt;2&gt;查看一下</h4>
<pre><code>[root@master ~]# kubectl get svc -n bdqn 
</code></pre>
<p>![image-20200109121106859](G:\四期\虚拟化\kubernetes\k8s文档\06 pod资源对象.assets\image-20200109121106859.png)</p>
<pre><code>[root@master ~]# kubectl describe svc -n bdqn test-svc 
</code></pre>
<p>![image-20200109121139399](G:\四期\虚拟化\kubernetes\k8s文档\06 pod资源对象.assets\image-20200109121139399.png)</p>
<h4 id="4-访问一下-2">&lt;4&gt;访问一下</h4>
<pre><code>[root@master ~]# curl 10.98.57.97 
</code></pre>
<p>![image-20200109121205607](G:\四期\虚拟化\kubernetes\k8s文档\06 pod资源对象.assets\image-20200109121205607.png)</p>
<h4 id="service">--------------------------------------service---------------------------------------------</h4>
<h1>四，容器的重启策略</h1>
<p><strong>Pod的重启策略（RestartPolicy）应用与Pod内所有容器，并且仅在Pod所处的Node上由kubelet进行判断和重启操作。当某个容器异常退出或者健康检查失败时，kubelet将根据RestartPolicy的设置来进行相应的操作。</strong></p>
<blockquote>
<p><strong>Always：</strong>（默认情况下使用）但凡Pod对象终止就将其重启；<br>
**OnFailure：**仅在Pod对象出现错误时才将其重启；<br>
**Never：**从不重启；</p>
</blockquote>
<h1>五，pod的默认健康检查</h1>
<p><strong>每个容器启动时都会执行一个进程，此进程由 Dockerfile 的 CMD 或 ENTRYPOINT 指定。如果进程退出时返回码非零，则认为容器发生故障，Kubernetes 就会根据 <code>restartPolicy</code> 重启容器。</strong></p>
<h2 id="（1）编写健康检查的yaml文件">（1）编写健康检查的yaml文件</h2>
<p><strong>下面我们模拟一个容器发生故障的场景，Pod 配置文件如下：</strong></p>
<pre><code>[root@master ~]# vim healcheck.yaml 
apiVersion: v1
kind: Pod
metadata:
  labels:
    test: healcheck
  name:  healcheck
spec:
  restartPolicy: OnFailure  #指定重启策略
  containers:
  - name:  healcheck
    image: busybox:latest
    args:                   #生成pod时运行的命令
    - /bin/sh
    - -c
    - sleep 20; exit 1 
</code></pre>
<h3 id="1-执行一下-2">&lt;1&gt;执行一下</h3>
<pre><code>[root@master ~]# kubectl apply -f  healcheck.yaml
</code></pre>
<h3 id="2-查看一下-2">&lt;2&gt;查看一下</h3>
<pre><code>[root@master ~]# kubectl get pod -o wide
</code></pre>
<p>![image-20200109121809350](G:\四期\虚拟化\kubernetes\k8s文档\06 pod资源对象.assets\image-20200109121809350.png)</p>
<pre><code>[root@master ~]# kubectl get pod -w | grep healcheck
</code></pre>
<p>![image-20200109121817775](G:\四期\虚拟化\kubernetes\k8s文档\06 pod资源对象.assets\image-20200109121817775.png)</p>
<p><strong>在上面的例子中，容器进程返回值非零，Kubernetes 则认为容器发生故障，需要重启。但有不少情况是发生了故障，但进程并不会退出。</strong></p>
<h1>六，小实验</h1>
<h2 id="1）以自己的名称创建一个k8s名称空间，以下所有操作都在此名称空间中。">1）以自己的名称创建一个k8s名称空间，以下所有操作都在此名称空间中。</h2>
<h3 id="（1）创建名称空间">（1）创建名称空间</h3>
<pre><code>[root@master ~]# kubectl create ns xgp
</code></pre>
<h3 id="（2）查看一下-3">（2）查看一下</h3>
<pre><code>[root@master ~]# kubectl get ns xgp 
</code></pre>
<p>![image-20200109133106300](G:\四期\虚拟化\kubernetes\k8s文档\06 pod资源对象.assets\image-20200109133106300.png)</p>
<h2 id="2）创建一个Pod资源对象，使用的是私有仓库中私有镜像，其镜像的下载策略为：NEVER。-Pod的重启策略为：-Never">2）创建一个Pod资源对象，使用的是私有仓库中私有镜像，其镜像的下载策略为：NEVER。 Pod的重启策略为： Never.</h2>
<pre><code>[root@master ~]# vim pod.yaml
kind: Pod
apiVersion: v1
metadata:
  name: test-pod
  namespace: xgp
  labels:
    app: test-web
spec:
  restartPolicy: Never
  containers:
  - name: www
    image: 192.168.1.21:5000/web:v1
    imagePullPolicy: Never
    args:                   
    - /bin/sh
    - -c
    - sleep 90; exit 1
    ports:
    - protocol: TCP
      containerPort: 80
</code></pre>
<h2 id="3）创建出容器之后，执行非正常退出，查看Pod的最终状态。">3）创建出容器之后，执行非正常退出，查看Pod的最终状态。</h2>
<h3 id="（1）执行一下上面pod的yaml文件">（1）执行一下上面pod的yaml文件</h3>
<pre><code>[root@master ~]# kubectl apply -f pod.yaml 
</code></pre>
<h3 id="（2）动态查看ns中test-pod的信息">（2）动态查看ns中test-pod的信息</h3>
<pre><code>[root@master ~]# kubectl get pod -n xgp  -w | grep test-pod
</code></pre>
<p>![image-20200109135543482](G:\四期\虚拟化\kubernetes\k8s文档\06 pod资源对象.assets\image-20200109135543482.png)</p>
<blockquote>
<p><strong>删除test-pod</strong></p>
<pre><code>[root@master ~]# kubectl delete pod -n xgp test-pod 
</code></pre>
</blockquote>
<h2 id="4-创建一个Service资源对象，与上述Pod对象关联，验证他们的关联性。">4) 创建一个Service资源对象，与上述Pod对象关联，验证他们的关联性。</h2>
<h3 id="（1）修改pod的yaml文件-2">（1）修改pod的yaml文件</h3>
<pre><code>[root@master ~]# vim pod.yaml
kind: Pod
apiVersion: v1
metadata:
  name: test-pod
  namespace: xgp
  labels:
    app: test-web
spec:
  restartPolicy: Never
  containers:
  - name: www
    image: 192.168.1.21:5000/web:v1
    imagePullPolicy: Never
    ports:
    - protocol: TCP
      containerPort: 80
</code></pre>
<h3 id="（1）编写service的yaml文件">（1）编写service的yaml文件</h3>
<pre><code>[root@master ~]# vim svc.yaml 
apiVersion: v1
kind: Service
metadata:
  name: test-svc
  namespace: xgp
spec:
  selector:
    app: test-web
  ports:
  - port: 80
    targetPort: 80
</code></pre>
<h3 id="（2）执行一下">（2）执行一下</h3>
<pre><code>[root@master ~]# kubectl apply -f svc.yaml 
</code></pre>
<h3 id="（3）查看一下">（3）查看一下</h3>
<pre><code>[root@master ~]# kubectl get  pod -o wide -n xgp 
</code></pre>
<p>![image-20200109141712910](G:\四期\虚拟化\kubernetes\k8s文档\06 pod资源对象.assets\image-20200109141712910.png)</p>
<h3 id="（4）访问一下">（4）访问一下</h3>
<pre><code>[root@master ~]# curl 10.244.1.21
</code></pre>
<p>![image-20200109141749352](G:\四期\虚拟化\kubernetes\k8s文档\06 pod资源对象.assets\image-20200109141749352.png)</p>
</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">I'm so cute. Please give me money.</div><div id="qr" style="display:none;"><div style="display:inline-block"><a href="http://xgp-cunchu.test.upcdn.net/k8s/1.jpg" target="_blank" rel="noopener"><img loading="lazy" src="http://xgp-cunchu.test.upcdn.net/k8s/1.jpg" alt="支付宝" title="支付宝"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a href="http://xgp-cunchu.test.upcdn.net/k8s/2.jpg" target="_blank" rel="noopener"><img loading="lazy" src="http://xgp-cunchu.test.upcdn.net/k8s/2.jpg" alt="QQ 支付" title="QQ 支付"></a><div><span style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></span></div></div><div style="display:inline-block"><a href="http://xgp-cunchu.test.upcdn.net/k8s/3.jpg" target="_blank" rel="noopener"><img loading="lazy" src="http://xgp-cunchu.test.upcdn.net/k8s/3.jpg" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/posts/7772.html" rel="prev" title="08 ReplicaSet、DaemonSet"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">08 ReplicaSet、DaemonSet</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/posts/936d.html" rel="next" title="05 Delpoyment、service"><span class="post-nav-text">05 Delpoyment、service</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div id="comment"><div class="comment-tooltip text-center"><span>点击按钮跳转 GitHub Issues 评论。</span><br><span>若没有本文 Issue，您可以使用 Comment 模版新建。</span><br><a class="hty-button hty-button--raised" id="github-issues" href="https://github.com/xgp666/xgp666.github.io/issues?q=is:issue+06 pod资源对象" target="_blank" rel="noopener">GitHub Issues</a></div><div id="lv-container" data-id="city" data-uid="MTAyMC80OTM0NS8yNTgzNw=="><script>(function(d, s) {
  var j, e = d.getElementsByTagName(s)[0];
  if (typeof LivereTower === 'function') { return; }
  j = d.createElement(s);
  j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
  j.async = true;
  e.parentNode.insertBefore(j, e);
})(document, 'script');</script></div></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2020 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> Wu Shao Dong</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v4.2.0</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v0.7.2</span></div><div class="live_time"><span>本博客已萌萌哒地运行</span><span id="display_live_time"></span><span class="moe-text">(●'◡'●)</span><script>function blog_live_time() {
  window.setTimeout(blog_live_time, 1000);
  const start = new Date('2020-05-30T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = " " + passDay + " 天 " + passHour + " 小时 " + passMinute + " 分 " + passSecond + " 秒";
}
blog_live_time();
</script></div></footer><a class="hty-icon-button" id="goUp" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a></div><script defer src="/js/utils.js"></script><script defer src="/js/hexo-theme-yun.js"></script></body></html>