<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="06 pod资源对象"><meta name="keywords" content=""><meta name="author" content="Wu Shao Dong"><meta name="copyright" content="Wu Shao Dong"><title>06 pod资源对象 | Xgp &amp; Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Xgp & Blog" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#一，k8s的资源对象"><span class="toc-number">1.</span> <span class="toc-text">一，k8s的资源对象</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Pod的生命周期被定义为以下几个阶段。"><span class="toc-number">1.1.</span> <span class="toc-text">Pod的生命周期被定义为以下几个阶段。</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#环境介绍"><span class="toc-number">2.</span> <span class="toc-text">环境介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#二，Namespace：名称空间"><span class="toc-number">3.</span> <span class="toc-text">二，Namespace：名称空间</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-查看名称空间"><span class="toc-number">3.1.</span> <span class="toc-text">1.查看名称空间</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-查看名称空间详细信息"><span class="toc-number">3.2.</span> <span class="toc-text">2.查看名称空间详细信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-创建名称空间"><span class="toc-number">3.3.</span> <span class="toc-text">3.创建名称空间</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#查看一下"><span class="toc-number">3.3.1.</span> <span class="toc-text">查看一下</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-创建namespace的yaml文件"><span class="toc-number">3.4.</span> <span class="toc-text">4.创建namespace的yaml文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）查看格式"><span class="toc-number">3.4.1.</span> <span class="toc-text">（1）查看格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（2）创建namespace的yaml文件"><span class="toc-number">3.4.2.</span> <span class="toc-text">（2）创建namespace的yaml文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（3）运行namespace的yaml文件"><span class="toc-number">3.4.3.</span> <span class="toc-text">（3）运行namespace的yaml文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（4）查看一下"><span class="toc-number">3.4.4.</span> <span class="toc-text">（4）查看一下</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-删除名称空间"><span class="toc-number">3.5.</span> <span class="toc-text">4.删除名称空间</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-查看指定名称空间"><span class="toc-number">3.6.</span> <span class="toc-text">5.查看指定名称空间</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#三，Pod"><span class="toc-number">4.</span> <span class="toc-text">三，Pod</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-编写一个pod的yaml文件"><span class="toc-number">4.1.</span> <span class="toc-text">1.编写一个pod的yaml文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）运行一下"><span class="toc-number">4.1.1.</span> <span class="toc-text">（1）运行一下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（2）查看一下"><span class="toc-number">4.1.2.</span> <span class="toc-text">（2）查看一下</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-指定pod的namespace名称空间"><span class="toc-number">4.2.</span> <span class="toc-text">2.指定pod的namespace名称空间</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）修改pod的yaml文件"><span class="toc-number">4.2.1.</span> <span class="toc-text">（1）修改pod的yaml文件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#执行一下"><span class="toc-number">4.2.1.0.1.</span> <span class="toc-text">执行一下</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（2）查看一下-1"><span class="toc-number">4.2.2.</span> <span class="toc-text">（2）查看一下</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-pod中镜像获取策略"><span class="toc-number">4.3.</span> <span class="toc-text">3.pod中镜像获取策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-观察pod和service的不同并关联"><span class="toc-number">4.4.</span> <span class="toc-text">4.观察pod和service的不同并关联</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）pod的yaml文件（指定端口）"><span class="toc-number">4.4.1.</span> <span class="toc-text">（1）pod的yaml文件（指定端口）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#lt-1-gt-删除之前的pod"><span class="toc-number">4.4.1.1.</span> <span class="toc-text">&lt;1&gt;删除之前的pod</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lt-2-gt-执行一下"><span class="toc-number">4.4.1.2.</span> <span class="toc-text">&lt;2&gt;执行一下</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lt-3-gt-查看一下"><span class="toc-number">4.4.1.3.</span> <span class="toc-text">&lt;3&gt;查看一下</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（2）pod的yaml文件（修改端口）"><span class="toc-number">4.4.2.</span> <span class="toc-text">（2）pod的yaml文件（修改端口）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#lt-1-gt-删除之前的pod-1"><span class="toc-number">4.4.2.1.</span> <span class="toc-text">&lt;1&gt;删除之前的pod</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lt-2-gt-执行一下-1"><span class="toc-number">4.4.2.2.</span> <span class="toc-text">&lt;2&gt;执行一下</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lt-3-gt-查看一下-1"><span class="toc-number">4.4.2.3.</span> <span class="toc-text">&lt;3&gt;查看一下</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lt-4-gt-访问一下"><span class="toc-number">4.4.2.4.</span> <span class="toc-text">&lt;4&gt;访问一下</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（3）pod的yaml文件（添加标签）"><span class="toc-number">4.4.3.</span> <span class="toc-text">（3）pod的yaml文件（添加标签）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#————————————–pod———————————————"><span class="toc-number">4.4.3.1.</span> <span class="toc-text">————————————–pod———————————————</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#（4）编写一个service的yaml文件"><span class="toc-number">4.5.</span> <span class="toc-text">（4）编写一个service的yaml文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#lt-1-gt-执行一下"><span class="toc-number">4.5.0.1.</span> <span class="toc-text">&lt;1&gt;执行一下</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lt-2-gt-查看一下"><span class="toc-number">4.5.0.2.</span> <span class="toc-text">&lt;2&gt;查看一下</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lt-4-gt-访问一下-1"><span class="toc-number">4.5.0.3.</span> <span class="toc-text">&lt;4&gt;访问一下</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#————————————–service———————————————"><span class="toc-number">4.5.0.4.</span> <span class="toc-text">————————————–service———————————————</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#四，容器的重启策略"><span class="toc-number">5.</span> <span class="toc-text">四，容器的重启策略</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#五，pod的默认健康检查"><span class="toc-number">6.</span> <span class="toc-text">五，pod的默认健康检查</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#（1）编写健康检查的yaml文件"><span class="toc-number">6.1.</span> <span class="toc-text">（1）编写健康检查的yaml文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#lt-1-gt-执行一下-1"><span class="toc-number">6.1.1.</span> <span class="toc-text">&lt;1&gt;执行一下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lt-2-gt-查看一下-1"><span class="toc-number">6.1.2.</span> <span class="toc-text">&lt;2&gt;查看一下</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#六，小实验"><span class="toc-number">7.</span> <span class="toc-text">六，小实验</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1）以自己的名称创建一个k8s名称空间，以下所有操作都在此名称空间中。"><span class="toc-number">7.1.</span> <span class="toc-text">1）以自己的名称创建一个k8s名称空间，以下所有操作都在此名称空间中。</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）创建名称空间"><span class="toc-number">7.1.1.</span> <span class="toc-text">（1）创建名称空间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（2）查看一下-2"><span class="toc-number">7.1.2.</span> <span class="toc-text">（2）查看一下</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2）创建一个Pod资源对象，使用的是私有仓库中私有镜像，其镜像的下载策略为：NEVER。-Pod的重启策略为：-Never"><span class="toc-number">7.2.</span> <span class="toc-text">2）创建一个Pod资源对象，使用的是私有仓库中私有镜像，其镜像的下载策略为：NEVER。 Pod的重启策略为： Never.</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3）创建出容器之后，执行非正常退出，查看Pod的最终状态。"><span class="toc-number">7.3.</span> <span class="toc-text">3）创建出容器之后，执行非正常退出，查看Pod的最终状态。</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）执行一下上面pod的yaml文件"><span class="toc-number">7.3.1.</span> <span class="toc-text">（1）执行一下上面pod的yaml文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（2）动态查看ns中test-pod的信息"><span class="toc-number">7.3.2.</span> <span class="toc-text">（2）动态查看ns中test-pod的信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-创建一个Service资源对象，与上述Pod对象关联，验证他们的关联性。"><span class="toc-number">7.4.</span> <span class="toc-text">4) 创建一个Service资源对象，与上述Pod对象关联，验证他们的关联性。</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）修改pod的yaml文件-1"><span class="toc-number">7.4.1.</span> <span class="toc-text">（1）修改pod的yaml文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）编写service的yaml文件"><span class="toc-number">7.4.2.</span> <span class="toc-text">（1）编写service的yaml文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（2）执行一下"><span class="toc-number">7.4.3.</span> <span class="toc-text">（2）执行一下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（3）查看一下"><span class="toc-number">7.4.4.</span> <span class="toc-text">（3）查看一下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（4）访问一下"><span class="toc-number">7.4.5.</span> <span class="toc-text">（4）访问一下</span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Wu Shao Dong</div><div class="author-info__description text-center">Small steel gun article</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">16</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">3</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">2</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Xgp &amp; Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">06 pod资源对象</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-04-25</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="一，k8s的资源对象"><a href="#一，k8s的资源对象" class="headerlink" title="一，k8s的资源对象"></a>一，k8s的资源对象</h1><p><strong><em>Deployment、Service、Pod是k8s最核心的3个资源对象</em></strong></p>
<blockquote>
<p><strong>Deployment：</strong>最常见的无状态应用的控制器，支持应用的扩缩容、滚动升级等操作。</p>
<p><strong>Service：</strong>为弹性变动且存在生命周期的Pod对象提供了一个固定的访问接口，用于服务发现和服务访问。</p>
<p><strong>Pod：</strong>是运行容器以及调度的最小单位。同一个pod可以同时运行多个容器，这些容器共享net、UTS、IPC，除此之外还有USER、PID、MOUNT。</p>
<p><strong>ReplicationController：</strong>用于确保每个Pod副本在任意时刻都能满足目标数量，简单来说，它用于每个容器或容器组总是运行并且可以访问的：老一代无状态的Pod应用控制器。</p>
<p><strong>RwplicatSet：</strong>新一代的无状态的Pod应用控制器，它与RC的不同之处在于支持的标签选择器不同，RC只支持等值选择器（键值对），RS还额外支持基于集合的选择器。</p>
<p><strong>StatefulSet：</strong>用于管理有状态的持久化应用，如database服务程序，它与Deployment不同之处在于，它会为每一个pod创建一个独有的持久性标识符，并确保每个pod之间的顺序性。</p>
<p><strong>DaemonSet：</strong>用于确保每一个节点都运行了某个pod的一个副本，新增的节点一样会被添加到此类pod，在节点移除时，此pod会被回收。</p>
<p><strong>Job：</strong>用于管理运行完成后即可终止的应用，例如批量处理做作业任务；</p>
<p><strong>volume：</strong>pv pvc<br><strong>ConfigMap：</strong><br><strong>Secret：</strong><br><strong>Role：</strong><br><strong>ClusterRole：</strong><br><strong>RoleBinding：</strong><br><strong>cluster RoleBinding：</strong><br><strong>service account：</strong><br><strong>Helm：</strong></p>
</blockquote>
<h2 id="Pod的生命周期被定义为以下几个阶段。"><a href="#Pod的生命周期被定义为以下几个阶段。" class="headerlink" title="Pod的生命周期被定义为以下几个阶段。"></a>Pod的生命周期被定义为以下几个阶段。</h2><blockquote>
<ul>
<li><strong>Pending：Pod已经被创建，但是一个或者多个容器还未创建，这包括Pod调度阶段，以及容器镜像的下载过程。</strong></li>
<li><strong>Running：Pod已经被调度到Node，所有容器已经创建，并且至少一个容器在运行或者正在重启。</strong></li>
<li><strong>Succeeded：Pod中所有容器正常退出。</strong></li>
<li><strong>Failed：Pod中所有容器退出，至少有一个容器是一次退出的。</strong></li>
</ul>
</blockquote>
<h1 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h1><table>
<thead>
<tr>
<th>主机</th>
<th>IP地址</th>
<th>服务</th>
</tr>
</thead>
<tbody><tr>
<td>master</td>
<td>192.168.1.21</td>
<td>k8s</td>
</tr>
<tr>
<td>node01</td>
<td>192.168.1.22</td>
<td>k8s</td>
</tr>
<tr>
<td>node02</td>
<td>192.168.1.23</td>
<td>k8s</td>
</tr>
</tbody></table>
<h1 id="二，Namespace：名称空间"><a href="#二，Namespace：名称空间" class="headerlink" title="二，Namespace：名称空间"></a>二，Namespace：名称空间</h1><p><strong>默认的名称空间：</strong></p>
<blockquote>
<p><strong>Namespace（命名空间）是kubernetes系统中的另一个重要的概念，通过将系统内部的对象“分配”到不同的Namespace中，形成逻辑上分组的不同项目、小组或用户组，便于不同的分组在共享使用整个集群的资源的同时还能被分别管理。</strong></p>
<p>   <strong>Kubernetes集群在启动后，会创建一个名为“default”的Namespace，如果不特别指明Namespace，则用户创建的Pod、RC、Service都被系统创建到“default”的Namespace中。</strong></p>
</blockquote>
<h2 id="1-查看名称空间"><a href="#1-查看名称空间" class="headerlink" title="1.查看名称空间"></a>1.查看名称空间</h2><pre><code>[root@master ~]# kubectl get namespaces</code></pre><p>![image-20200109094700728](E:\软件\博客\Blog\blog\source_posts\06 pod资源对象.assets\image-20200109094700728.png)</p>
<h2 id="2-查看名称空间详细信息"><a href="#2-查看名称空间详细信息" class="headerlink" title="2.查看名称空间详细信息"></a>2.查看名称空间详细信息</h2><pre><code>[root@master ~]# kubectl describe ns default</code></pre><p>![image-20200109095006067](E:\软件\博客\Blog\blog\source_posts\06 pod资源对象.assets\image-20200109095006067.png)</p>
<h2 id="3-创建名称空间"><a href="#3-创建名称空间" class="headerlink" title="3.创建名称空间"></a>3.创建名称空间</h2><pre><code>[root@master ~]# kubectl create ns bdqn</code></pre><h3 id="查看一下"><a href="#查看一下" class="headerlink" title="查看一下"></a>查看一下</h3><pre><code>[root@master ~]# kubectl get namespaces</code></pre><p>![image-20200109095153448](E:\软件\博客\Blog\blog\source_posts\06 pod资源对象.assets\image-20200109095153448.png)</p>
<h2 id="4-创建namespace的yaml文件"><a href="#4-创建namespace的yaml文件" class="headerlink" title="4.创建namespace的yaml文件"></a>4.创建namespace的yaml文件</h2><h3 id="（1）查看格式"><a href="#（1）查看格式" class="headerlink" title="（1）查看格式"></a>（1）查看格式</h3><pre><code>[root@master ~]# kubectl explain ns
//查看nasespace的yaml文件的格式</code></pre><h3 id="（2）创建namespace的yaml文件"><a href="#（2）创建namespace的yaml文件" class="headerlink" title="（2）创建namespace的yaml文件"></a>（2）创建namespace的yaml文件</h3><pre><code>[root@master ~]# vim test-ns.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: test</code></pre><h3 id="（3）运行namespace的yaml文件"><a href="#（3）运行namespace的yaml文件" class="headerlink" title="（3）运行namespace的yaml文件"></a>（3）运行namespace的yaml文件</h3><pre><code>[root@master ~]# kubectl apply -f test-ns.yaml </code></pre><h3 id="（4）查看一下"><a href="#（4）查看一下" class="headerlink" title="（4）查看一下"></a>（4）查看一下</h3><pre><code>[root@master ~]# kubectl get ns</code></pre><p>![image-20200109095808777](E:\软件\博客\Blog\blog\source_posts\06 pod资源对象.assets\image-20200109095808777.png)</p>
<h2 id="4-删除名称空间"><a href="#4-删除名称空间" class="headerlink" title="4.删除名称空间"></a>4.删除名称空间</h2><pre><code>[root@master ~]# kubectl delete ns test 
[root@master ~]# kubectl delete -f test-ns.yaml </code></pre><p><strong>注意：namespace资源对象进用于资源对象的隔离，并不能隔绝不同名称空间的Pod之间的通信。那是网络策略资源的功能。</strong></p>
<h2 id="5-查看指定名称空间"><a href="#5-查看指定名称空间" class="headerlink" title="5.查看指定名称空间"></a>5.查看指定名称空间</h2><p><strong>可使用–namespace或-n选项</strong></p>
<pre><code>[root@master ~]# kubectl get pod -n kube-system 
[root@master ~]# kubectl get pod --namespace kube-system </code></pre><h1 id="三，Pod"><a href="#三，Pod" class="headerlink" title="三，Pod"></a>三，Pod</h1><h2 id="1-编写一个pod的yaml文件"><a href="#1-编写一个pod的yaml文件" class="headerlink" title="1.编写一个pod的yaml文件"></a>1.编写一个pod的yaml文件</h2><pre><code>[root@master ~]# vim pod.yaml
kind: Pod
apiVersion: v1
metadata:
  name: test-pod
spec:
  containers:
  - name: test-app
    image: 192.168.1.21:5000/web:v1</code></pre><p><strong><em>pod的yaml文件不支持replicas字段</em></strong></p>
<h3 id="（1）运行一下"><a href="#（1）运行一下" class="headerlink" title="（1）运行一下"></a>（1）运行一下</h3><pre><code>[root@master ~]# kubectl apply -f pod.yaml </code></pre><h3 id="（2）查看一下"><a href="#（2）查看一下" class="headerlink" title="（2）查看一下"></a>（2）查看一下</h3><pre><code>[root@master ~]# kubectl get pod</code></pre><p>![image-20200109100836911](E:\软件\博客\Blog\blog\source_posts\06 pod资源对象.assets\image-20200109100836911.png)</p>
<p><strong><em>ps：这个pod因为是自己创建的，所以删除之后k8s并不会自动生成，相当于docker中创建</em></strong></p>
<h2 id="2-指定pod的namespace名称空间"><a href="#2-指定pod的namespace名称空间" class="headerlink" title="2.指定pod的namespace名称空间"></a>2.指定pod的namespace名称空间</h2><h3 id="（1）修改pod的yaml文件"><a href="#（1）修改pod的yaml文件" class="headerlink" title="（1）修改pod的yaml文件"></a>（1）修改pod的yaml文件</h3><pre><code>[root@master ~]# vim pod.yaml
kind: Pod        #资源类型
apiVersion: v1   #api版本
metadata:
  name: test-pod    #指定控制器名称
  namespace: bdqn   #指定namespace（名称空间）
spec:
  containers:      #容器
  - name: test-app  #容器名称
    image: 192.168.1.21:5000/web:v1  #镜像</code></pre><h5 id="执行一下"><a href="#执行一下" class="headerlink" title="执行一下"></a>执行一下</h5><pre><code>[root@master ~]# kubectl apply -f pod.yaml </code></pre><h3 id="（2）查看一下-1"><a href="#（2）查看一下-1" class="headerlink" title="（2）查看一下"></a>（2）查看一下</h3><pre><code>[root@master ~]#  kubectl get pod -n bdqn 
//根据namespace名称查看</code></pre><p>![image-20200109101521992](E:\软件\博客\Blog\blog\source_posts\06 pod资源对象.assets\image-20200109101521992.png)</p>
<h2 id="3-pod中镜像获取策略"><a href="#3-pod中镜像获取策略" class="headerlink" title="3.pod中镜像获取策略"></a>3.pod中镜像获取策略</h2><blockquote>
<p><strong>Always：</strong>镜像标签为“laster”或镜像不存在时，总是从指定的仓库中获取镜像。</p>
<p><strong>IfNotPresent：</strong>仅当本地镜像不存在时才从目标仓库下载。</p>
<p><strong>Never：</strong>禁止从仓库中下载镜像，即只使用本地镜像。</p>
</blockquote>
<p><strong><em>注意：对于标签为“laster”或者标签不存在，其默认的镜像下载策略为“Always”，而对于其他的标签镜像，默认策略为“IfNotPresent”。</em></strong></p>
<h2 id="4-观察pod和service的不同并关联"><a href="#4-观察pod和service的不同并关联" class="headerlink" title="4.观察pod和service的不同并关联"></a>4.观察pod和service的不同并关联</h2><h3 id="（1）pod的yaml文件（指定端口）"><a href="#（1）pod的yaml文件（指定端口）" class="headerlink" title="（1）pod的yaml文件（指定端口）"></a>（1）pod的yaml文件（指定端口）</h3><pre><code>[root@master ~]# vim pod.yaml 
kind: Pod          #资源类型
apiVersion: v1      #api版本
metadata:
  name: test-pod       #指定控制器名称
  namespace: bdqn   #指定namespace（名称空间）
spec:
  containers:                          #容器
  - name: test-app                    #容器名称
    image: 192.168.1.21:5000/web:v1   #镜像
    imagePullPolicy: IfNotPresent   #获取的策略
    ports:
    - protocol: TCP
      containerPort: 80  </code></pre><h4 id="lt-1-gt-删除之前的pod"><a href="#lt-1-gt-删除之前的pod" class="headerlink" title="<1>删除之前的pod"></a>&lt;1&gt;删除之前的pod</h4><pre><code>[root@master ~]# kubectl delete pod -n bdqn test-pod </code></pre><h4 id="lt-2-gt-执行一下"><a href="#lt-2-gt-执行一下" class="headerlink" title="<2>执行一下"></a>&lt;2&gt;执行一下</h4><pre><code>[root@master ~]# kubectl apply -f pod.yaml </code></pre><h4 id="lt-3-gt-查看一下"><a href="#lt-3-gt-查看一下" class="headerlink" title="<3>查看一下"></a>&lt;3&gt;查看一下</h4><pre><code>[root@master ~]# kubectl get pod -n bdqn </code></pre><p>![image-20200109110215669](E:\软件\博客\Blog\blog\source_posts\06 pod资源对象.assets\image-20200109110215669.png)</p>
<h3 id="（2）pod的yaml文件（修改端口）"><a href="#（2）pod的yaml文件（修改端口）" class="headerlink" title="（2）pod的yaml文件（修改端口）"></a>（2）pod的yaml文件（修改端口）</h3><pre><code>[root@master ~]# vim pod.yaml 
kind: Pod
apiVersion: v1
metadata:
  name: test-pod
  namespace: bdqn
spec:
  containers:
  - name: test-app
    image: 192.168.1.21:5000/web:v1
    imagePullPolicy: IfNotPresent
    ports:
    - protocol: TCP
      containerPort: 90   #改一下端口</code></pre><h4 id="lt-1-gt-删除之前的pod-1"><a href="#lt-1-gt-删除之前的pod-1" class="headerlink" title="<1>删除之前的pod"></a>&lt;1&gt;删除之前的pod</h4><pre><code>[root@master ~]# kubectl delete pod -n bdqn test-pod </code></pre><h4 id="lt-2-gt-执行一下-1"><a href="#lt-2-gt-执行一下-1" class="headerlink" title="<2>执行一下"></a>&lt;2&gt;执行一下</h4><pre><code>[root@master ~]# kubectl apply -f pod.yaml </code></pre><h4 id="lt-3-gt-查看一下-1"><a href="#lt-3-gt-查看一下-1" class="headerlink" title="<3>查看一下"></a>&lt;3&gt;查看一下</h4><pre><code>[root@master ~]# kubectl get pod -n bdqn -o wide</code></pre><p>![image-20200109110409584](E:\软件\博客\Blog\blog\source_posts\06 pod资源对象.assets\image-20200109110409584.png)</p>
<h4 id="lt-4-gt-访问一下"><a href="#lt-4-gt-访问一下" class="headerlink" title="<4>访问一下"></a>&lt;4&gt;访问一下</h4><p>![image-20200109110430334](E:\软件\博客\Blog\blog\source_posts\06 pod资源对象.assets\image-20200109110430334.png)</p>
<p><strong>会发现修改的90端口并不生效，他只是一个提示字段并不生效。</strong></p>
<h3 id="（3）pod的yaml文件（添加标签）"><a href="#（3）pod的yaml文件（添加标签）" class="headerlink" title="（3）pod的yaml文件（添加标签）"></a>（3）pod的yaml文件（添加标签）</h3><pre><code>[root@master ~]# vim pod.yaml 
kind: Pod
apiVersion: v1
metadata:
  name: test-pod
  namespace: bdqn
  labels:                 #标签
    app: test-web          #标签名称
spec:
  containers:
  - name: test-app
    image: 192.168.1.21:5000/web:v1
    imagePullPolicy: IfNotPresent
    ports:
    - protocol: TCP
      containerPort: 90   #改一下端口</code></pre><h4 id="————————————–pod———————————————"><a href="#————————————–pod———————————————" class="headerlink" title="————————————–pod———————————————"></a>————————————–pod———————————————</h4><h2 id="（4）编写一个service的yaml文件"><a href="#（4）编写一个service的yaml文件" class="headerlink" title="（4）编写一个service的yaml文件"></a>（4）编写一个service的yaml文件</h2><pre><code>[root@master ~]# vim test-svc.yaml 
apiVersion: v1      #api版本
kind: Service          #资源类型
metadata:
  name: test-svc       #指定控制器名称
  namespace: bdqn   #指定namespace（名称空间）
spec:
  selector:          #标签
    app: test-web    #标签名称（须和pod的标签名称一致）
  ports:              
  - port: 80          #宿主机端口
    targetPort: 80    #容器端口</code></pre><p><strong><em>会发现添加的80端口生效了，所以不能乱改。</em></strong></p>
<h4 id="lt-1-gt-执行一下"><a href="#lt-1-gt-执行一下" class="headerlink" title="<1>执行一下"></a>&lt;1&gt;执行一下</h4><pre><code>[root@master ~]# kubectl apply -f test-svc.yaml</code></pre><h4 id="lt-2-gt-查看一下"><a href="#lt-2-gt-查看一下" class="headerlink" title="<2>查看一下"></a>&lt;2&gt;查看一下</h4><pre><code>[root@master ~]# kubectl get svc -n bdqn </code></pre><p>![image-20200109121106859](E:\软件\博客\Blog\blog\source_posts\06 pod资源对象.assets\image-20200109121106859.png)</p>
<pre><code>[root@master ~]# kubectl describe svc -n bdqn test-svc </code></pre><p>![image-20200109121139399](E:\软件\博客\Blog\blog\source_posts\06 pod资源对象.assets\image-20200109121139399.png)</p>
<h4 id="lt-4-gt-访问一下-1"><a href="#lt-4-gt-访问一下-1" class="headerlink" title="<4>访问一下"></a>&lt;4&gt;访问一下</h4><pre><code>[root@master ~]# curl 10.98.57.97 </code></pre><p>![image-20200109121205607](E:\软件\博客\Blog\blog\source_posts\06 pod资源对象.assets\image-20200109121205607.png)</p>
<h4 id="————————————–service———————————————"><a href="#————————————–service———————————————" class="headerlink" title="————————————–service———————————————"></a>————————————–service———————————————</h4><h1 id="四，容器的重启策略"><a href="#四，容器的重启策略" class="headerlink" title="四，容器的重启策略"></a>四，容器的重启策略</h1><p><strong>Pod的重启策略（RestartPolicy）应用与Pod内所有容器，并且仅在Pod所处的Node上由kubelet进行判断和重启操作。当某个容器异常退出或者健康检查失败时，kubelet将根据RestartPolicy的设置来进行相应的操作。</strong></p>
<blockquote>
<p><strong>Always：</strong>（默认情况下使用）但凡Pod对象终止就将其重启；<br><strong>OnFailure：</strong>仅在Pod对象出现错误时才将其重启；<br><strong>Never：</strong>从不重启；</p>
</blockquote>
<h1 id="五，pod的默认健康检查"><a href="#五，pod的默认健康检查" class="headerlink" title="五，pod的默认健康检查"></a>五，pod的默认健康检查</h1><p><strong>每个容器启动时都会执行一个进程，此进程由 Dockerfile 的 CMD 或 ENTRYPOINT 指定。如果进程退出时返回码非零，则认为容器发生故障，Kubernetes 就会根据 <code>restartPolicy</code> 重启容器。</strong></p>
<h2 id="（1）编写健康检查的yaml文件"><a href="#（1）编写健康检查的yaml文件" class="headerlink" title="（1）编写健康检查的yaml文件"></a>（1）编写健康检查的yaml文件</h2><p><strong>下面我们模拟一个容器发生故障的场景，Pod 配置文件如下：</strong></p>
<pre><code>[root@master ~]# vim healcheck.yaml 
apiVersion: v1
kind: Pod
metadata:
  labels:
    test: healcheck
  name:  healcheck
spec:
  restartPolicy: OnFailure  #指定重启策略
  containers:
  - name:  healcheck
    image: busybox:latest
    args:                   #生成pod时运行的命令
    - /bin/sh
    - -c
    - sleep 20; exit 1 </code></pre><h3 id="lt-1-gt-执行一下-1"><a href="#lt-1-gt-执行一下-1" class="headerlink" title="<1>执行一下"></a>&lt;1&gt;执行一下</h3><pre><code>[root@master ~]# kubectl apply -f  healcheck.yaml</code></pre><h3 id="lt-2-gt-查看一下-1"><a href="#lt-2-gt-查看一下-1" class="headerlink" title="<2>查看一下"></a>&lt;2&gt;查看一下</h3><pre><code>[root@master ~]# kubectl get pod -o wide</code></pre><p>![image-20200109121809350](E:\软件\博客\Blog\blog\source_posts\06 pod资源对象.assets\image-20200109121809350.png)</p>
<pre><code>[root@master ~]# kubectl get pod -w | grep healcheck</code></pre><p>![image-20200109121817775](E:\软件\博客\Blog\blog\source_posts\06 pod资源对象.assets\image-20200109121817775.png)</p>
<p><strong>在上面的例子中，容器进程返回值非零，Kubernetes 则认为容器发生故障，需要重启。但有不少情况是发生了故障，但进程并不会退出。</strong></p>
<h1 id="六，小实验"><a href="#六，小实验" class="headerlink" title="六，小实验"></a>六，小实验</h1><h2 id="1）以自己的名称创建一个k8s名称空间，以下所有操作都在此名称空间中。"><a href="#1）以自己的名称创建一个k8s名称空间，以下所有操作都在此名称空间中。" class="headerlink" title="1）以自己的名称创建一个k8s名称空间，以下所有操作都在此名称空间中。"></a>1）以自己的名称创建一个k8s名称空间，以下所有操作都在此名称空间中。</h2><h3 id="（1）创建名称空间"><a href="#（1）创建名称空间" class="headerlink" title="（1）创建名称空间"></a>（1）创建名称空间</h3><pre><code>[root@master ~]# kubectl create ns xgp</code></pre><h3 id="（2）查看一下-2"><a href="#（2）查看一下-2" class="headerlink" title="（2）查看一下"></a>（2）查看一下</h3><pre><code>[root@master ~]# kubectl get ns xgp </code></pre><p>![image-20200109133106300](E:\软件\博客\Blog\blog\source_posts\06 pod资源对象.assets\image-20200109133106300.png)</p>
<h2 id="2）创建一个Pod资源对象，使用的是私有仓库中私有镜像，其镜像的下载策略为：NEVER。-Pod的重启策略为：-Never"><a href="#2）创建一个Pod资源对象，使用的是私有仓库中私有镜像，其镜像的下载策略为：NEVER。-Pod的重启策略为：-Never" class="headerlink" title="2）创建一个Pod资源对象，使用的是私有仓库中私有镜像，其镜像的下载策略为：NEVER。 Pod的重启策略为： Never."></a>2）创建一个Pod资源对象，使用的是私有仓库中私有镜像，其镜像的下载策略为：NEVER。 Pod的重启策略为： Never.</h2><pre><code>[root@master ~]# vim pod.yaml
kind: Pod
apiVersion: v1
metadata:
  name: test-pod
  namespace: xgp
  labels:
    app: test-web
spec:
  restartPolicy: Never
  containers:
  - name: www
    image: 192.168.1.21:5000/web:v1
    imagePullPolicy: Never
    args:                   
    - /bin/sh
    - -c
    - sleep 90; exit 1
    ports:
    - protocol: TCP
      containerPort: 80</code></pre><h2 id="3）创建出容器之后，执行非正常退出，查看Pod的最终状态。"><a href="#3）创建出容器之后，执行非正常退出，查看Pod的最终状态。" class="headerlink" title="3）创建出容器之后，执行非正常退出，查看Pod的最终状态。"></a>3）创建出容器之后，执行非正常退出，查看Pod的最终状态。</h2><h3 id="（1）执行一下上面pod的yaml文件"><a href="#（1）执行一下上面pod的yaml文件" class="headerlink" title="（1）执行一下上面pod的yaml文件"></a>（1）执行一下上面pod的yaml文件</h3><pre><code>[root@master ~]# kubectl apply -f pod.yaml </code></pre><h3 id="（2）动态查看ns中test-pod的信息"><a href="#（2）动态查看ns中test-pod的信息" class="headerlink" title="（2）动态查看ns中test-pod的信息"></a>（2）动态查看ns中test-pod的信息</h3><pre><code>[root@master ~]# kubectl get pod -n xgp  -w | grep test-pod</code></pre><p>![image-20200109135543482](E:\软件\博客\Blog\blog\source_posts\06 pod资源对象.assets\image-20200109135543482.png)</p>
<blockquote>
<p><strong>删除test-pod</strong></p>
<pre><code>[root@master ~]# kubectl delete pod -n xgp test-pod </code></pre></blockquote>
<h2 id="4-创建一个Service资源对象，与上述Pod对象关联，验证他们的关联性。"><a href="#4-创建一个Service资源对象，与上述Pod对象关联，验证他们的关联性。" class="headerlink" title="4) 创建一个Service资源对象，与上述Pod对象关联，验证他们的关联性。"></a>4) 创建一个Service资源对象，与上述Pod对象关联，验证他们的关联性。</h2><h3 id="（1）修改pod的yaml文件-1"><a href="#（1）修改pod的yaml文件-1" class="headerlink" title="（1）修改pod的yaml文件"></a>（1）修改pod的yaml文件</h3><pre><code>[root@master ~]# vim pod.yaml
kind: Pod
apiVersion: v1
metadata:
  name: test-pod
  namespace: xgp
  labels:
    app: test-web
spec:
  restartPolicy: Never
  containers:
  - name: www
    image: 192.168.1.21:5000/web:v1
    imagePullPolicy: Never
    ports:
    - protocol: TCP
      containerPort: 80</code></pre><h3 id="（1）编写service的yaml文件"><a href="#（1）编写service的yaml文件" class="headerlink" title="（1）编写service的yaml文件"></a>（1）编写service的yaml文件</h3><pre><code>[root@master ~]# vim svc.yaml 
apiVersion: v1
kind: Service
metadata:
  name: test-svc
  namespace: xgp
spec:
  selector:
    app: test-web
  ports:
  - port: 80
    targetPort: 80</code></pre><h3 id="（2）执行一下"><a href="#（2）执行一下" class="headerlink" title="（2）执行一下"></a>（2）执行一下</h3><pre><code>[root@master ~]# kubectl apply -f svc.yaml </code></pre><h3 id="（3）查看一下"><a href="#（3）查看一下" class="headerlink" title="（3）查看一下"></a>（3）查看一下</h3><pre><code>[root@master ~]# kubectl get  pod -o wide -n xgp </code></pre><p>![image-20200109141712910](E:\软件\博客\Blog\blog\source_posts\06 pod资源对象.assets\image-20200109141712910.png)</p>
<h3 id="（4）访问一下"><a href="#（4）访问一下" class="headerlink" title="（4）访问一下"></a>（4）访问一下</h3><pre><code>[root@master ~]# curl 10.244.1.21</code></pre><p>![image-20200109141749352](E:\软件\博客\Blog\blog\source_posts\06 pod资源对象.assets\image-20200109141749352.png)</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Wu Shao Dong</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://wsdlxgp.top/posts/cf38.html">https://wsdlxgp.top/posts/cf38.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://wsdlxgp.top">Xgp & Blog</a>！</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/posts/7772.html"><i class="fa fa-chevron-left">  </i><span>08 ReplicaSet、DaemonSet</span></a></div><div class="next-post pull-right"><a href="/posts/936d.html"><span>05 Delpoyment、service</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By Wu Shao Dong</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>