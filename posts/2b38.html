<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Python并发线程 | Xgp &amp; Blog</title><meta name="description" content="开始学习Python线程 Python中使用线程有两种方式：函数或者用类来包装线程对象。 函数式：调用thread模块中的start_new_thread()函数来产生新线程。语法如下: 1thread.start_new_thread ( function, args[, kwargs] ) 参数说明:  function - 线程函数。 args - 传递给线程函数的参数,他必须是个tuple"><meta name="keywords" content="nfs,deployment,pv,pvc,dashboard,helm,StorageClass"><meta name="author" content="Wu Shao Dong"><meta name="copyright" content="Wu Shao Dong"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://wsdlxgp.top/posts/2b38.html"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="Python并发线程"><meta property="og:url" content="https://wsdlxgp.top/posts/2b38.html"><meta property="og:site_name" content="Xgp &amp; Blog"><meta property="og:description" content="开始学习Python线程 Python中使用线程有两种方式：函数或者用类来包装线程对象。 函数式：调用thread模块中的start_new_thread()函数来产生新线程。语法如下: 1thread.start_new_thread ( function, args[, kwargs] ) 参数说明:  function - 线程函数。 args - 传递给线程函数的参数,他必须是个tuple"><meta property="og:image" content="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq93p.jpg"><meta property="article:published_time" content="2019-11-01T16:00:00.000Z"><meta property="article:modified_time" content="2020-06-30T06:52:07.772Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="prev" title="小案例" href="https://wsdlxgp.top/posts/a1c5.html"><link rel="next" title="Python并发线程介绍" href="https://wsdlxgp.top/posts/f802.html"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: false,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true
  }</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Xgp & Blog" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">132</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">76</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">4</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">1.</span> <span class="toc-text">开始学习Python线程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#简单的执行线程次数"><span class="toc-number">1.1.</span> <span class="toc-text">简单的执行线程次数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#输出结果"><span class="toc-number">1.1.0.0.1.</span> <span class="toc-text">输出结果</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1、单线程"><span class="toc-number">1.2.</span> <span class="toc-text">1、单线程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#输出结果-2"><span class="toc-number">1.2.0.0.1.</span> <span class="toc-text">输出结果</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#输出结果-3"><span class="toc-number">1.2.0.0.2.</span> <span class="toc-text">输出结果</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2、多线程"><span class="toc-number">1.3.</span> <span class="toc-text">2、多线程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#（1）使用-thread模块"><span class="toc-number">1.3.0.1.</span> <span class="toc-text">（1）使用_thread模块</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#输出结果-4"><span class="toc-number">1.3.0.1.1.</span> <span class="toc-text">输出结果</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#注意到，在主线程写了"><span class="toc-number">1.3.0.2.</span> <span class="toc-text">注意到，在主线程写了:</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">2.</span> <span class="toc-text">线程模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1、直接创建线程"><span class="toc-number">2.1.</span> <span class="toc-text">1、直接创建线程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#输出结果-5"><span class="toc-number">2.1.0.0.1.</span> <span class="toc-text">输出结果</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2、使用Threading模块创建线程（构造线程类）"><span class="toc-number">2.2.</span> <span class="toc-text">2、使用Threading模块创建线程（构造线程类）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#输出结果-6"><span class="toc-number">2.2.0.0.1.</span> <span class="toc-text">输出结果</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#join-方法"><span class="toc-number">2.2.1.</span> <span class="toc-text">join()方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#setDaemon-方法"><span class="toc-number">2.2.2.</span> <span class="toc-text">setDaemon()方法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#输出结果-7"><span class="toc-number">2.2.2.0.1.</span> <span class="toc-text">输出结果</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3、两个疑问"><span class="toc-number">2.3.</span> <span class="toc-text">3、两个疑问</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4、按时间为批次执行线程"><span class="toc-number">2.4.</span> <span class="toc-text">4、按时间为批次执行线程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#输出结果-8"><span class="toc-number">2.4.0.0.1.</span> <span class="toc-text">输出结果</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5、继承的方法"><span class="toc-number">2.5.</span> <span class="toc-text">5、继承的方法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#输出结果-9"><span class="toc-number">2.5.0.0.1.</span> <span class="toc-text">输出结果</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">3.</span> <span class="toc-text">线程同步</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#输出结果-10"><span class="toc-number">3.0.0.0.1.</span> <span class="toc-text">输出结果</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">4.</span> <span class="toc-text">线程优先级队列（ Queue）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Queue模块中的常用方法"><span class="toc-number">4.0.0.1.</span> <span class="toc-text">Queue模块中的常用方法:</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">5.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">6.</span> <span class="toc-text">注：关于并发、并行区别与联系</span></a></li></ol></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq93p.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">Xgp &amp; Blog</a></span><span class="pull-right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Python并发线程</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2019-11-02 00:00:00"><i class="far fa-calendar-alt fa-fw"></i> 发表于 2019-11-02</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-06-30 14:52:07"><i class="fas fa-history fa-fw"></i> 更新于 2020-06-30</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/python/">python</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1>开始学习Python线程</h1>
<p><strong>Python中使用线程有两种方式：函数或者用类来包装线程对象。</strong></p>
<p><strong>函数式：调用thread模块中的start_new_thread()函数来产生新线程。语法如下:</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs python"><code class="language-hljs python">thread.start_new_thread ( function, args[, kwargs] )<br></code></pre></td></tr></table></figure>
<p><strong>参数说明:</strong></p>
<ul>
<li><strong>function - 线程函数。</strong></li>
<li><strong>args - 传递给线程函数的参数,他必须是个tuple类型。</strong></li>
<li><strong>kwargs - 可选参数。python</strong></li>
</ul>
<h2 id="简单的执行线程次数">简单的执行线程次数</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-comment"># coding:utf-8</span><br><br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">say_hi</span><span class="hljs-params">()</span>:</span><br>    <span class="hljs-comment"># time.sleep(1)					#延迟几秒</span><br>    print(<span class="hljs-string">'hello world!'</span>)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>):<br>        <span class="hljs-comment"># 创建线程</span><br>        thread = threading.Thread(target=say_hi)<br>        <span class="hljs-comment"># 启动线程</span><br>        thread.start()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string"><code class="language-hljs python"><span class="hljs-comment"># coding:utf-8</span><br><br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">say_hi</span><span class="hljs-params">()</span>:</span><br>    <span class="hljs-comment"># time.sleep(1)					#延迟几秒</span><br>    print(<span class="hljs-string">'hello world!'</span>)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>):<br>        <span class="hljs-comment"># 创建线程</span><br>        thread = threading.Thread(target=say_hi)<br>        <span class="hljs-comment"># 启动线程</span><br>        thread.start()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<br>    main()<br></code></pre></td></tr></table></figure>
<h5 id="输出结果">输出结果</h5>
<blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class=" language-hljs python"><code class="language-hljs python">hello world!<br>hello world!<br>hello world!<br>hello world!<br>hello world!<br></code></pre></td></tr></table></figure>
</blockquote>
<p><img src= "/img/loading.gif" data-src="https://gitee.com/xgpqq/tuchuang/raw/master/img/image-20200617232422565.png" alt="image-20200617232422565"></p>
<h2 id="1、单线程">1、单线程</h2>
<p><strong>在好些年前的MS-DOS时代，操作系统处理问题都是单任务的，我想做听音乐和看电影两件事儿，那么一定要先排一下顺序。</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> ctime,sleep<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">music</span><span class="hljs-params">()</span>:</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>):<br>        print(<span class="hljs-string">"I was listening to music. %s"</span> %ctime())<br>        sleep(<span class="hljs-number">1</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move</span><span class="hljs-params">()</span>:</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>):<br>        print(<span class="hljs-string">"I was at the movies! %s"</span> %ctime())<br>        sleep(<span class="hljs-number">5</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<br>    music()<br>    move()<br>    print(<span class="hljs-string"><code class="language-hljs python"><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> ctime,sleep<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">music</span><span class="hljs-params">()</span>:</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>):<br>        print(<span class="hljs-string">"I was listening to music. %s"</span> %ctime())<br>        sleep(<span class="hljs-number">1</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move</span><span class="hljs-params">()</span>:</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>):<br>        print(<span class="hljs-string">"I was at the movies! %s"</span> %ctime())<br>        sleep(<span class="hljs-number">5</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<br>    music()<br>    move()<br>    print(<span class="hljs-string">"all over %s"</span> %ctime())<br></code></pre></td></tr></table></figure>
<p><strong>我们先听了一首音乐，通过for循环来控制音乐的播放了两次，每首音乐播放需要1秒钟，sleep()来控制音乐播放的时长。接着我们又看了一场电影，每一场电影需要5秒钟，因为太好看了，所以我也通过for循环看两遍。在整个休闲娱乐活动结束后，我通过<code>print(&quot;all over %s&quot; %ctime())</code>看了一下当前时间，差不多该睡觉了</strong></p>
<h5 id="输出结果-2">输出结果</h5>
<blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class=" language-hljs python">I was listening to music. Wed Jun <span class="hljs-number">17</span> <span class="hljs-number">23</span>:<span class="hljs-number">19</span>:<span class="hljs-number">18</span> <span class="hljs-number">2020</span><br>I was listening to music. Wed Jun <span class="hljs-number">17</span> <span class="hljs-number">23</span>:<span class="hljs-number">19</span>:<span class="hljs-number">19</span> <span class="hljs-number">2020</span><br>I was at the movies! Wed Jun <span class="hljs-number">17</span> <span class="hljs-number">23</span>:<span class="hljs-number">19</span>:<span class="hljs-number">20</span> <span class="hljs-number">2020</span><br>I was at the movies! Wed Jun <span class="hljs-number">17</span> <span class="hljs-number">23</span>:<span class="hljs-number">19</span>:<span class="hljs-number">25</span> <span class="hljs-number">2020</span><br>all over Wed Jun <span class="hljs-number">17</span> <span class="hljs-number">23</span>:<span class="hljs-number">19</span>:<span class="hljs-number">30</span> <span class="hljs-number"><code class="language-hljs python">I was listening to music. Wed Jun <span class="hljs-number">17</span> <span class="hljs-number">23</span>:<span class="hljs-number">19</span>:<span class="hljs-number">18</span> <span class="hljs-number">2020</span><br>I was listening to music. Wed Jun <span class="hljs-number">17</span> <span class="hljs-number">23</span>:<span class="hljs-number">19</span>:<span class="hljs-number">19</span> <span class="hljs-number">2020</span><br>I was at the movies! Wed Jun <span class="hljs-number">17</span> <span class="hljs-number">23</span>:<span class="hljs-number">19</span>:<span class="hljs-number">20</span> <span class="hljs-number">2020</span><br>I was at the movies! Wed Jun <span class="hljs-number">17</span> <span class="hljs-number">23</span>:<span class="hljs-number">19</span>:<span class="hljs-number">25</span> <span class="hljs-number">2020</span><br>all over Wed Jun <span class="hljs-number">17</span> <span class="hljs-number">23</span>:<span class="hljs-number">19</span>:<span class="hljs-number">30</span> <span class="hljs-number">2020</span><br></code></pre></td></tr></table></figure>
</blockquote>
<p><strong>其实，music()和move()更应该被看作是音乐和视频播放器，至于要播放什么歌曲和视频应该由我们使用时决定。所以，我们对上面代码做了改造：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> ctime,sleep<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">music</span><span class="hljs-params">(func)</span>:</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>):<br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"I was listening to %s. %s"</span> %(func,ctime()))<br>        sleep(<span class="hljs-number">1</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move</span><span class="hljs-params">(func)</span>:</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>):<br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"I was at the %s! %s"</span> %(func,ctime()))<br>        sleep(<span class="hljs-number">5</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<br>    music(<span class="hljs-string">u'爱情买卖'</span>)<br>    move(<span class="hljs-string">u'阿凡达'</span>)<br><br>    <span class="hljs-keyword">print</span> (<span class="hljs-string"><code class="language-hljs python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> ctime,sleep<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">music</span><span class="hljs-params">(func)</span>:</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>):<br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"I was listening to %s. %s"</span> %(func,ctime()))<br>        sleep(<span class="hljs-number">1</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move</span><span class="hljs-params">(func)</span>:</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>):<br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"I was at the %s! %s"</span> %(func,ctime()))<br>        sleep(<span class="hljs-number">5</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<br>    music(<span class="hljs-string">u'爱情买卖'</span>)<br>    move(<span class="hljs-string">u'阿凡达'</span>)<br><br>    <span class="hljs-keyword">print</span> (<span class="hljs-string">"all over %s"</span> %ctime())<br></code></pre></td></tr></table></figure>
<h5 id="输出结果-3">输出结果</h5>
<blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class=" language-hljs python">I was listening to 爱情买卖. Thu Apr <span class="hljs-number">17</span> <span class="hljs-number">11</span>:<span class="hljs-number">48</span>:<span class="hljs-number">59</span> <span class="hljs-number">2014</span><br>I was listening to 爱情买卖. Thu Apr <span class="hljs-number">17</span> <span class="hljs-number">11</span>:<span class="hljs-number">49</span>:<span class="hljs-number">00</span> <span class="hljs-number">2014</span><br>I was at the 阿凡达! Thu Apr <span class="hljs-number">17</span> <span class="hljs-number">11</span>:<span class="hljs-number">49</span>:<span class="hljs-number">01</span> <span class="hljs-number">2014</span><br>I was at the 阿凡达! Thu Apr <span class="hljs-number">17</span> <span class="hljs-number">11</span>:<span class="hljs-number">49</span>:<span class="hljs-number">06</span> <span class="hljs-number">2014</span><br>all over Thu Apr <span class="hljs-number">17</span> <span class="hljs-number">11</span>:<span class="hljs-number">49</span>:<span class="hljs-number">11</span> <span class="hljs-number"><code class="language-hljs python">I was listening to 爱情买卖. Thu Apr <span class="hljs-number">17</span> <span class="hljs-number">11</span>:<span class="hljs-number">48</span>:<span class="hljs-number">59</span> <span class="hljs-number">2014</span><br>I was listening to 爱情买卖. Thu Apr <span class="hljs-number">17</span> <span class="hljs-number">11</span>:<span class="hljs-number">49</span>:<span class="hljs-number">00</span> <span class="hljs-number">2014</span><br>I was at the 阿凡达! Thu Apr <span class="hljs-number">17</span> <span class="hljs-number">11</span>:<span class="hljs-number">49</span>:<span class="hljs-number">01</span> <span class="hljs-number">2014</span><br>I was at the 阿凡达! Thu Apr <span class="hljs-number">17</span> <span class="hljs-number">11</span>:<span class="hljs-number">49</span>:<span class="hljs-number">06</span> <span class="hljs-number">2014</span><br>all over Thu Apr <span class="hljs-number">17</span> <span class="hljs-number">11</span>:<span class="hljs-number">49</span>:<span class="hljs-number">11</span> <span class="hljs-number">2014</span><br></code></pre></td></tr></table></figure>
</blockquote>
<h2 id="2、多线程">2、多线程</h2>
<p><strong>Python3 通过两个标准库 _thread (python2中是thread模块）和 threading 提供对线程的支持。</strong><br>
<strong>_thread 提供了低级别的、原始的线程以及一个简单的锁，它相比于 threading 模块的功能还是比较有限的。</strong></p>
<h4 id="（1）使用-thread模块">（1）使用_thread模块</h4>
<p><strong>调用_thread模块中的start_new_thread()函数来产生新线程。</strong><br>
<strong>先用一个实例感受一下：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-keyword">import</span> _thread<br><span class="hljs-keyword">import</span> time<br><br><br><span class="hljs-comment"># 为线程定义一个函数</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_time</span><span class="hljs-params">(threadName, delay)</span>:</span><br>    count = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> count &lt; <span class="hljs-number">5</span>:<br>        time.sleep(delay)<br>        count += <span class="hljs-number">1</span><br>        print(<span class="hljs-string">"%s: %s"</span> % (threadName, time.ctime(time.time())))<br><br><br><span class="hljs-comment"># 创建两个线程</span><br><span class="hljs-keyword">try</span>:<br>    _thread.start_new_thread(print_time, (<span class="hljs-string">"Thread-1"</span>, <span class="hljs-number">2</span>,))<br>    _thread.start_new_thread(print_time, (<span class="hljs-string">"Thread-2"</span>, <span class="hljs-number">4</span>,))<br><span class="hljs-keyword">except</span>:<br>    print(<span class="hljs-string">"Error: unable to start thread"</span>)<br><br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    <span class="hljs-keyword">pass</span><br><br>print(<span class="hljs-string"><code class="language-hljs python"><span class="hljs-keyword">import</span> _thread<br><span class="hljs-keyword">import</span> time<br><br><br><span class="hljs-comment"># 为线程定义一个函数</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_time</span><span class="hljs-params">(threadName, delay)</span>:</span><br>    count = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> count &lt; <span class="hljs-number">5</span>:<br>        time.sleep(delay)<br>        count += <span class="hljs-number">1</span><br>        print(<span class="hljs-string">"%s: %s"</span> % (threadName, time.ctime(time.time())))<br><br><br><span class="hljs-comment"># 创建两个线程</span><br><span class="hljs-keyword">try</span>:<br>    _thread.start_new_thread(print_time, (<span class="hljs-string">"Thread-1"</span>, <span class="hljs-number">2</span>,))<br>    _thread.start_new_thread(print_time, (<span class="hljs-string">"Thread-2"</span>, <span class="hljs-number">4</span>,))<br><span class="hljs-keyword">except</span>:<br>    print(<span class="hljs-string">"Error: unable to start thread"</span>)<br><br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    <span class="hljs-keyword">pass</span><br><br>print(<span class="hljs-string">"Main Finished"</span>)<br></code></pre></td></tr></table></figure>
<h5 id="输出结果-4">输出结果</h5>
<blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre class=" language-hljs python">Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">35</span>:<span class="hljs-number">47</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">35</span>:<span class="hljs-number">49</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">35</span>:<span class="hljs-number">49</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">35</span>:<span class="hljs-number">51</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">35</span>:<span class="hljs-number">53</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">35</span>:<span class="hljs-number">53</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">35</span>:<span class="hljs-number">55</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">35</span>:<span class="hljs-number">57</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">36</span>:<span class="hljs-number">01</span> <span class="hljs-number"><code class="language-hljs python">Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">35</span>:<span class="hljs-number">47</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">35</span>:<span class="hljs-number">49</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">35</span>:<span class="hljs-number">49</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">35</span>:<span class="hljs-number">51</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">35</span>:<span class="hljs-number">53</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">35</span>:<span class="hljs-number">53</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">35</span>:<span class="hljs-number">55</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">35</span>:<span class="hljs-number">57</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">36</span>:<span class="hljs-number">01</span> <span class="hljs-number">2017</span><br></code></pre></td></tr></table></figure>
</blockquote>
<h4 id="注意到，在主线程写了"><strong>注意到，在主线程写了:</strong></h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>   <span class="hljs-keyword"><code class="language-hljs python"><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>   <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure>
<p><strong>这是让主线程一直在等待.</strong><br>
<strong>如果去掉上面两行，那就直接输出并结束程序执行:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><span class="hljs-string"><code class="language-hljs bash"><span class="hljs-string">"Main Finished"</span><br></code></pre></td></tr></table></figure>
<h1>线程模块</h1>
<p><strong>Python通过两个标准库thread和threading提供对线程的支持。thread提供了低级别的、原始的线程以及一个简单的锁。</strong></p>
<p><strong>threading 模块提供的其他方法：</strong></p>
<ul>
<li><strong>threading.currentThread(): 返回当前的线程变量。</strong></li>
<li><strong>threading.enumerate(): 返回一个包含正在运行的线程的list。正在运行指线程启动后、结束前，不包括启动前和终止后的线程。</strong></li>
<li><strong>threading.activeCount(): 返回正在运行的线程数量，与len(threading.enumerate())有相同的结果。</strong></li>
</ul>
<p><strong>除了使用方法外，线程模块同样提供了Thread类来处理线程，Thread类提供了以下方法:</strong></p>
<ul>
<li>
<p><strong>run(): 用以表示线程活动的方法。</strong></p>
</li>
<li>
<p><strong>start():</strong></p>
<p><strong>启动线程活动。</strong></p>
</li>
<li>
<p><strong>join([time]): 等待至线程中止。这阻塞调用线程直至线程的join() 方法被调用中止-正常退出或者抛出未处理的异常-或者是可选的超时发生。</strong></p>
</li>
<li>
<p><strong>isAlive(): 返回线程是否活动的。</strong></p>
</li>
<li>
<p><strong>getName(): 返回线程名。</strong></p>
</li>
<li>
<p><strong>setName(): 设置线程名。</strong></p>
</li>
</ul>
<h2 id="1、直接创建线程">1、直接创建线程</h2>
<p><strong>接上面的听音乐和看电影的例子，我们可以直接使用threading.Thread 创建线程，并指定执行的方法以及传递的参数：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> ctime,sleep<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">music</span><span class="hljs-params">(func)</span>:</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>):<br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"I was listening to %s. %s"</span> %(func,ctime()))<br>        sleep(<span class="hljs-number">1</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move</span><span class="hljs-params">(func)</span>:</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>):<br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"I was at the %s! %s"</span> %(func,ctime()))<br>        sleep(<span class="hljs-number">5</span>)<br><br>threads = []<br>t1 = threading.Thread(target=music,args=(<span class="hljs-string">u'爱情买卖'</span>,))<br>threads.append(t1)<br>t2 = threading.Thread(target=move,args=(<span class="hljs-string">u'阿凡达'</span>,))<br>threads.append(t2)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:<br>        t.start()<br><br>    <span class="hljs-keyword">print</span> (<span class="hljs-string"><code class="language-hljs python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> ctime,sleep<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">music</span><span class="hljs-params">(func)</span>:</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>):<br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"I was listening to %s. %s"</span> %(func,ctime()))<br>        sleep(<span class="hljs-number">1</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move</span><span class="hljs-params">(func)</span>:</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>):<br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"I was at the %s! %s"</span> %(func,ctime()))<br>        sleep(<span class="hljs-number">5</span>)<br><br>threads = []<br>t1 = threading.Thread(target=music,args=(<span class="hljs-string">u'爱情买卖'</span>,))<br>threads.append(t1)<br>t2 = threading.Thread(target=move,args=(<span class="hljs-string">u'阿凡达'</span>,))<br>threads.append(t2)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:<br>        t.start()<br><br>    <span class="hljs-keyword">print</span> (<span class="hljs-string">"all over %s"</span> %ctime())<br></code></pre></td></tr></table></figure>
<h5 id="输出结果-5">输出结果</h5>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class=" language-hljs css"><span class="hljs-selector-tag">I</span> <span class="hljs-selector-tag">was</span> <span class="hljs-selector-tag">listening</span> <span class="hljs-selector-tag">to</span> 爱情买卖. <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Aug</span> 10 16<span class="hljs-selector-pseudo">:57</span><span class="hljs-selector-pseudo">:12</span> 2017<br><span class="hljs-selector-tag">I</span> <span class="hljs-selector-tag">was</span> <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">the</span> 阿凡达! <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Aug</span> 10 16<span class="hljs-selector-pseudo">:57</span><span class="hljs-selector-pseudo">:12</span> 2017<br><span class="hljs-selector-tag">all</span> <span class="hljs-selector-tag">over</span> <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Aug</span> 10 16<span class="hljs-selector-pseudo">:57</span><span class="hljs-selector-pseudo">:12</span> 2017<br><span class="hljs-selector-tag">I</span> <span class="hljs-selector-tag">was</span> <span class="hljs-selector-tag">listening</span> <span class="hljs-selector-tag">to</span> 爱情买卖. <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Aug</span> 10 16<span class="hljs-selector-pseudo">:57</span><span class="hljs-selector-pseudo">:13</span> 2017<br><span class="hljs-selector-tag">I</span> <span class="hljs-selector-tag">was</span> <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">the</span> 阿凡达! <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Aug</span> 10 16<span class="hljs-selector-pseudo">:57</span><span class="hljs-selector-pseudo"><code class="language-hljs css"><span class="hljs-selector-tag">I</span> <span class="hljs-selector-tag">was</span> <span class="hljs-selector-tag">listening</span> <span class="hljs-selector-tag">to</span> 爱情买卖. <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Aug</span> 10 16<span class="hljs-selector-pseudo">:57</span><span class="hljs-selector-pseudo">:12</span> 2017<br><span class="hljs-selector-tag">I</span> <span class="hljs-selector-tag">was</span> <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">the</span> 阿凡达! <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Aug</span> 10 16<span class="hljs-selector-pseudo">:57</span><span class="hljs-selector-pseudo">:12</span> 2017<br><span class="hljs-selector-tag">all</span> <span class="hljs-selector-tag">over</span> <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Aug</span> 10 16<span class="hljs-selector-pseudo">:57</span><span class="hljs-selector-pseudo">:12</span> 2017<br><span class="hljs-selector-tag">I</span> <span class="hljs-selector-tag">was</span> <span class="hljs-selector-tag">listening</span> <span class="hljs-selector-tag">to</span> 爱情买卖. <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Aug</span> 10 16<span class="hljs-selector-pseudo">:57</span><span class="hljs-selector-pseudo">:13</span> 2017<br><span class="hljs-selector-tag">I</span> <span class="hljs-selector-tag">was</span> <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">the</span> 阿凡达! <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Aug</span> 10 16<span class="hljs-selector-pseudo">:57</span><span class="hljs-selector-pseudo">:17</span> 2017<br></code></pre></td></tr></table></figure>
<h2 id="2、使用Threading模块创建线程（构造线程类）">2、使用Threading模块创建线程（构造线程类）</h2>
<p><strong>我们也可以通过直接从 threading.Thread 继承创建一个新的子类，并实例化后调用 start() 方法启动新线程，即它调用了线程的 run() 方法</strong></p>
<p><strong>使用Threading模块创建线程，直接从<code>threading.Thread</code>继承，然后重写<code>init</code>方法和<code>run</code>方法：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br>exitFlag = <span class="hljs-number">0</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">myThread</span> <span class="hljs-params">(threading.Thread)</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, threadID, name, counter)</span>:</span><br>        threading.Thread.__init__(self)<br>        self.threadID = threadID<br>        self.name = name<br>        self.counter = counter<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span><span class="hljs-params">(self)</span>:</span><br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"开始线程："</span> + self.name)<br>        print_time(self.name, self.counter, <span class="hljs-number">5</span>)<br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"退出线程："</span> + self.name)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_time</span><span class="hljs-params">(threadName, delay, counter)</span>:</span><br>    <span class="hljs-keyword">while</span> counter:<br>        <span class="hljs-keyword">if</span> exitFlag:<br>            threadName.exit()<br>        time.sleep(delay)<br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"%s: %s"</span> % (threadName, time.ctime(time.time())))<br>        counter -= <span class="hljs-number">1</span><br><br><span class="hljs-comment"># 创建新线程</span><br>thread1 = myThread(<span class="hljs-number">1</span>, <span class="hljs-string">"Thread-1"</span>, <span class="hljs-number">1</span>)<br>thread2 = myThread(<span class="hljs-number">2</span>, <span class="hljs-string">"Thread-2"</span>, <span class="hljs-number">2</span>)<br><br><span class="hljs-comment"># 开启新线程</span><br>thread1.start()<br>thread2.start()<br><span class="hljs-keyword">print</span> (<span class="hljs-string"><code class="language-hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br>exitFlag = <span class="hljs-number">0</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">myThread</span> <span class="hljs-params">(threading.Thread)</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, threadID, name, counter)</span>:</span><br>        threading.Thread.__init__(self)<br>        self.threadID = threadID<br>        self.name = name<br>        self.counter = counter<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span><span class="hljs-params">(self)</span>:</span><br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"开始线程："</span> + self.name)<br>        print_time(self.name, self.counter, <span class="hljs-number">5</span>)<br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"退出线程："</span> + self.name)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_time</span><span class="hljs-params">(threadName, delay, counter)</span>:</span><br>    <span class="hljs-keyword">while</span> counter:<br>        <span class="hljs-keyword">if</span> exitFlag:<br>            threadName.exit()<br>        time.sleep(delay)<br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"%s: %s"</span> % (threadName, time.ctime(time.time())))<br>        counter -= <span class="hljs-number">1</span><br><br><span class="hljs-comment"># 创建新线程</span><br>thread1 = myThread(<span class="hljs-number">1</span>, <span class="hljs-string">"Thread-1"</span>, <span class="hljs-number">1</span>)<br>thread2 = myThread(<span class="hljs-number">2</span>, <span class="hljs-string">"Thread-2"</span>, <span class="hljs-number">2</span>)<br><br><span class="hljs-comment"># 开启新线程</span><br>thread1.start()<br>thread2.start()<br><span class="hljs-keyword">print</span> (<span class="hljs-string">"退出主线程"</span>)<br></code></pre></td></tr></table></figure>
<h5 id="输出结果-6">输出结果</h5>
<blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre class=" language-hljs python">开始线程：Thread<span class="hljs-number">-1</span><br>开始线程：Thread<span class="hljs-number">-2</span><br>退出主线程<br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">48</span>:<span class="hljs-number">41</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">48</span>:<span class="hljs-number">42</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">48</span>:<span class="hljs-number">42</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">48</span>:<span class="hljs-number">43</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">48</span>:<span class="hljs-number">44</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">48</span>:<span class="hljs-number">44</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">48</span>:<span class="hljs-number">45</span> <span class="hljs-number">2017</span><br>退出线程：Thread<span class="hljs-number">-1</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">48</span>:<span class="hljs-number">46</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">48</span>:<span class="hljs-number">48</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">48</span>:<span class="hljs-number">50</span> <span class="hljs-number">2017</span><br>退出线程：Thread<span class="hljs-number"><code class="language-hljs python">开始线程：Thread<span class="hljs-number">-1</span><br>开始线程：Thread<span class="hljs-number">-2</span><br>退出主线程<br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">48</span>:<span class="hljs-number">41</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">48</span>:<span class="hljs-number">42</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">48</span>:<span class="hljs-number">42</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">48</span>:<span class="hljs-number">43</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">48</span>:<span class="hljs-number">44</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">48</span>:<span class="hljs-number">44</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">48</span>:<span class="hljs-number">45</span> <span class="hljs-number">2017</span><br>退出线程：Thread<span class="hljs-number">-1</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">48</span>:<span class="hljs-number">46</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">48</span>:<span class="hljs-number">48</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">48</span>:<span class="hljs-number">50</span> <span class="hljs-number">2017</span><br>退出线程：Thread<span class="hljs-number">-2</span><br></code></pre></td></tr></table></figure>
</blockquote>
<p><strong>从结果可以看到，为什么我们开启了两个线程之后，主线程立即退出了？因为我们没有使用join方法，对于主线程来说，thread1和thread2是子线程，使用join方法，会让主线程等待子线程执行解说再继续执行。</strong></p>
<h3 id="join-方法">join()方法</h3>
<p><strong>我们修改一下代码：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br>exitFlag = <span class="hljs-number">0</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">myThread</span> <span class="hljs-params">(threading.Thread)</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, threadID, name, counter)</span>:</span><br>        threading.Thread.__init__(self)<br>        self.threadID = threadID<br>        self.name = name<br>        self.counter = counter<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span><span class="hljs-params">(self)</span>:</span><br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"开始线程："</span> + self.name)<br>        print_time(self.name, self.counter, <span class="hljs-number">5</span>)<br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"退出线程："</span> + self.name)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_time</span><span class="hljs-params">(threadName, delay, counter)</span>:</span><br>    <span class="hljs-keyword">while</span> counter:<br>        <span class="hljs-keyword">if</span> exitFlag:<br>            threadName.exit()<br>        time.sleep(delay)<br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"%s: %s"</span> % (threadName, time.ctime(time.time())))<br>        counter -= <span class="hljs-number">1</span><br><br><span class="hljs-comment"># 创建新线程</span><br>thread1 = myThread(<span class="hljs-number">1</span>, <span class="hljs-string">"Thread-1"</span>, <span class="hljs-number">1</span>)<br>thread2 = myThread(<span class="hljs-number">2</span>, <span class="hljs-string">"Thread-2"</span>, <span class="hljs-number">2</span>)<br><br><span class="hljs-comment"># 开启新线程</span><br>thread1.start()<br>thread2.start()<br>thread1.join()<br>thread2.join()<br><span class="hljs-keyword">print</span> (<span class="hljs-string"><code class="language-hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br>exitFlag = <span class="hljs-number">0</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">myThread</span> <span class="hljs-params">(threading.Thread)</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, threadID, name, counter)</span>:</span><br>        threading.Thread.__init__(self)<br>        self.threadID = threadID<br>        self.name = name<br>        self.counter = counter<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span><span class="hljs-params">(self)</span>:</span><br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"开始线程："</span> + self.name)<br>        print_time(self.name, self.counter, <span class="hljs-number">5</span>)<br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"退出线程："</span> + self.name)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_time</span><span class="hljs-params">(threadName, delay, counter)</span>:</span><br>    <span class="hljs-keyword">while</span> counter:<br>        <span class="hljs-keyword">if</span> exitFlag:<br>            threadName.exit()<br>        time.sleep(delay)<br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"%s: %s"</span> % (threadName, time.ctime(time.time())))<br>        counter -= <span class="hljs-number">1</span><br><br><span class="hljs-comment"># 创建新线程</span><br>thread1 = myThread(<span class="hljs-number">1</span>, <span class="hljs-string">"Thread-1"</span>, <span class="hljs-number">1</span>)<br>thread2 = myThread(<span class="hljs-number">2</span>, <span class="hljs-string">"Thread-2"</span>, <span class="hljs-number">2</span>)<br><br><span class="hljs-comment"># 开启新线程</span><br>thread1.start()<br>thread2.start()<br>thread1.join()<br>thread2.join()<br><span class="hljs-keyword">print</span> (<span class="hljs-string">"退出主线程"</span>)<br></code></pre></td></tr></table></figure>
<blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre class=" language-hljs python">开始线程：Thread<span class="hljs-number">-1</span><br>开始线程：Thread<span class="hljs-number">-2</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">52</span>:<span class="hljs-number">07</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">52</span>:<span class="hljs-number">08</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">52</span>:<span class="hljs-number">08</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">52</span>:<span class="hljs-number">09</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">52</span>:<span class="hljs-number">10</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">52</span>:<span class="hljs-number">10</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">52</span>:<span class="hljs-number">11</span> <span class="hljs-number">2017</span><br>退出线程：Thread<span class="hljs-number">-1</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">52</span>:<span class="hljs-number">12</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">52</span>:<span class="hljs-number">14</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">52</span>:<span class="hljs-number">16</span> <span class="hljs-number">2017</span><br>退出线程：Thread<span class="hljs-number"><code class="language-hljs python">开始线程：Thread<span class="hljs-number">-1</span><br>开始线程：Thread<span class="hljs-number">-2</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">52</span>:<span class="hljs-number">07</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">52</span>:<span class="hljs-number">08</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">52</span>:<span class="hljs-number">08</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">52</span>:<span class="hljs-number">09</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">52</span>:<span class="hljs-number">10</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">52</span>:<span class="hljs-number">10</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-1</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">52</span>:<span class="hljs-number">11</span> <span class="hljs-number">2017</span><br>退出线程：Thread<span class="hljs-number">-1</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">52</span>:<span class="hljs-number">12</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">52</span>:<span class="hljs-number">14</span> <span class="hljs-number">2017</span><br>Thread<span class="hljs-number">-2</span>: Thu Aug <span class="hljs-number">10</span> <span class="hljs-number">16</span>:<span class="hljs-number">52</span>:<span class="hljs-number">16</span> <span class="hljs-number">2017</span><br>退出线程：Thread<span class="hljs-number">-2</span><br>退出主线程<br></code></pre></td></tr></table></figure>
</blockquote>
<p><strong>可以看到 退出主线程 在最后才被打印出来。</strong></p>
<h3 id="setDaemon-方法">setDaemon()方法</h3>
<p><strong>有一个方法常常拿来与join方法做比较，那就是setDaemon()方法。我们首先来看一下setDaemon()方法的使用效果：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br>exitFlag = <span class="hljs-number">0</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">myThread</span> <span class="hljs-params">(threading.Thread)</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, threadID, name, counter)</span>:</span><br>        threading.Thread.__init__(self)<br>        self.threadID = threadID<br>        self.name = name<br>        self.counter = counter<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span><span class="hljs-params">(self)</span>:</span><br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"开始线程："</span> + self.name)<br>        print_time(self.name, self.counter, <span class="hljs-number">5</span>)<br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"退出线程："</span> + self.name)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_time</span><span class="hljs-params">(threadName, delay, counter)</span>:</span><br>    <span class="hljs-keyword">while</span> counter:<br>        <span class="hljs-keyword">if</span> exitFlag:<br>            threadName.exit()<br>        time.sleep(delay)<br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"%s: %s"</span> % (threadName, time.ctime(time.time())))<br>        counter -= <span class="hljs-number">1</span><br><br><span class="hljs-comment"># 创建新线程</span><br>thread1 = myThread(<span class="hljs-number">1</span>, <span class="hljs-string">"Thread-1"</span>, <span class="hljs-number">1</span>)<br>thread2 = myThread(<span class="hljs-number">2</span>, <span class="hljs-string">"Thread-2"</span>, <span class="hljs-number">2</span>)<br><br><span class="hljs-comment"># 开启新线程</span><br>thread1.setDaemon(<span class="hljs-literal">True</span>)<br>thread2.setDaemon(<span class="hljs-literal">True</span>)<br>thread1.start()<br>thread2.start()<br><br><span class="hljs-keyword">print</span> (<span class="hljs-string"><code class="language-hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br>exitFlag = <span class="hljs-number">0</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">myThread</span> <span class="hljs-params">(threading.Thread)</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, threadID, name, counter)</span>:</span><br>        threading.Thread.__init__(self)<br>        self.threadID = threadID<br>        self.name = name<br>        self.counter = counter<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span><span class="hljs-params">(self)</span>:</span><br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"开始线程："</span> + self.name)<br>        print_time(self.name, self.counter, <span class="hljs-number">5</span>)<br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"退出线程："</span> + self.name)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_time</span><span class="hljs-params">(threadName, delay, counter)</span>:</span><br>    <span class="hljs-keyword">while</span> counter:<br>        <span class="hljs-keyword">if</span> exitFlag:<br>            threadName.exit()<br>        time.sleep(delay)<br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"%s: %s"</span> % (threadName, time.ctime(time.time())))<br>        counter -= <span class="hljs-number">1</span><br><br><span class="hljs-comment"># 创建新线程</span><br>thread1 = myThread(<span class="hljs-number">1</span>, <span class="hljs-string">"Thread-1"</span>, <span class="hljs-number">1</span>)<br>thread2 = myThread(<span class="hljs-number">2</span>, <span class="hljs-string">"Thread-2"</span>, <span class="hljs-number">2</span>)<br><br><span class="hljs-comment"># 开启新线程</span><br>thread1.setDaemon(<span class="hljs-literal">True</span>)<br>thread2.setDaemon(<span class="hljs-literal">True</span>)<br>thread1.start()<br>thread2.start()<br><br><span class="hljs-keyword">print</span> (<span class="hljs-string">"退出主线程"</span>)<br></code></pre></td></tr></table></figure>
<h5 id="输出结果-7">输出结果</h5>
<blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class=" language-hljs python">开始线程：Thread<span class="hljs-number">-1</span><br>开始线程：Thread<span class="hljs-number"><code class="language-hljs python">开始线程：Thread<span class="hljs-number">-1</span><br>开始线程：Thread<span class="hljs-number">-2</span><br>退出主线程<br></code></pre></td></tr></table></figure>
</blockquote>
<p><strong>可以看到，在主线程结束之后，程序就终止了，也就是说两个子线程也被终止了，这就是setDaemon方法的作用。主线程A中，创建了子线程B，并且在主线程A中调用了B.setDaemon(),这个的意思是，把主线程A设置为守护线程，这时候，要是主线程A执行结束了，就不管子线程B是否完成,一并和主线程A退出.这就是setDaemon方法的含义，这基本和join是相反的。此外，还有个要特别注意的：必须在start() 方法调用之前设置，如果不设置为守护线程，程序会被无限挂起。</strong></p>
<h2 id="3、两个疑问">3、两个疑问</h2>
<p><strong>我们刚才介绍了两种使用多线程的方式，一种是直接调用threading.Thread 创建线程，另一种是从 threading.Thread 继承创建一个新的子类，并实例化后调用 start() 方法启动进程。学到这里，我就抛出了两个疑问，为什么第一种方法中我们可以为不同的线程指定运行的方法，而第二种我们都运行的是同一个方法，那么它内部的实现机制是什么呢？第二个疑问是，第二种方法中，我们没有实例化start()方法，那么run和start这两个方法的联系是什么呢？</strong><br>
<strong>首先，start方法和run方法的关系如下：用start方法来启动线程，真正实现了多线程运行，这时无需等待run方法体代码执行完毕而直接继续执行下面的代码。通过调用Thread类的start()方法来启动一个线程，这时此线程处于就绪（可运行）状态，并没有运行，一旦得到cpu时间片，就开始执行run()方法，这里方法 run()称为线程体，它包含了要执行的这个线程的内容，Run方法运行结束，此线程随即终止。</strong></p>
<p><strong>而run()方法的源码如下，可以看到，如果我们指定了target即线程执行的函数的话，run方法可以转而调用那个函数，如果没有的话，将不执行，而我们在自定义的Thread类里面重写了这个run 方法，所以程序会执行这一段。</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span><span class="hljs-params">(self)</span>:</span><br>    <span class="hljs-string">"""Method representing the thread's activity.</span><br><span class="hljs-string"></span><br><span class="hljs-string">    You may override this method in a subclass. The standard run() method</span><br><span class="hljs-string">    invokes the callable object passed to the object's constructor as the</span><br><span class="hljs-string">    target argument, if any, with sequential and keyword arguments taken</span><br><span class="hljs-string">    from the args and kwargs arguments, respectively.</span><br><span class="hljs-string"></span><br><span class="hljs-string">    """</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">if</span> self._target:<br>            self._target(*self._args, **self._kwargs)<br>    <span class="hljs-keyword">finally</span>:<br>        <span class="hljs-comment"># Avoid a refcycle if the thread is running a function with</span><br>        <span class="hljs-comment"># an argument that has a member that points to the thread.</span><br>        <span class="hljs-keyword"><code class="language-hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span><span class="hljs-params">(self)</span>:</span><br>    <span class="hljs-string">"""Method representing the thread's activity.</span><br><span class="hljs-string"></span><br><span class="hljs-string">    You may override this method in a subclass. The standard run() method</span><br><span class="hljs-string">    invokes the callable object passed to the object's constructor as the</span><br><span class="hljs-string">    target argument, if any, with sequential and keyword arguments taken</span><br><span class="hljs-string">    from the args and kwargs arguments, respectively.</span><br><span class="hljs-string"></span><br><span class="hljs-string">    """</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">if</span> self._target:<br>            self._target(*self._args, **self._kwargs)<br>    <span class="hljs-keyword">finally</span>:<br>        <span class="hljs-comment"># Avoid a refcycle if the thread is running a function with</span><br>        <span class="hljs-comment"># an argument that has a member that points to the thread.</span><br>        <span class="hljs-keyword">del</span> self._target, self._args, self._kwargs<br></code></pre></td></tr></table></figure>
<h2 id="4、按时间为批次执行线程">4、按时间为批次执行线程</h2>
<p><strong>线程有不确定性</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-comment"># coding:utf-8</span><br><br><span class="hljs-keyword">import</span> threading<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">say_hi</span><span class="hljs-params">(count, name)</span>:</span><br>    <span class="hljs-keyword">while</span> count &gt; <span class="hljs-number">0</span>:<br>        print(<span class="hljs-string">'hello'</span>, name)<br>        count -= <span class="hljs-number">1</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span><br>    username = [<span class="hljs-string">'Alan'</span>, <span class="hljs-string">'Bob'</span>, <span class="hljs-string">'Cendy'</span>, <span class="hljs-string">'Kily'</span>,<span class="hljs-string">'Heny'</span>]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>):<br>        thread = threading.Thread(target=say_hi,args=(<span class="hljs-number">50</span>,username[i]))<br>        thread.start()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string"><code class="language-hljs python"><span class="hljs-comment"># coding:utf-8</span><br><br><span class="hljs-keyword">import</span> threading<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">say_hi</span><span class="hljs-params">(count, name)</span>:</span><br>    <span class="hljs-keyword">while</span> count &gt; <span class="hljs-number">0</span>:<br>        print(<span class="hljs-string">'hello'</span>, name)<br>        count -= <span class="hljs-number">1</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span><br>    username = [<span class="hljs-string">'Alan'</span>, <span class="hljs-string">'Bob'</span>, <span class="hljs-string">'Cendy'</span>, <span class="hljs-string">'Kily'</span>,<span class="hljs-string">'Heny'</span>]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>):<br>        thread = threading.Thread(target=say_hi,args=(<span class="hljs-number">50</span>,username[i]))<br>        thread.start()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<br>    main()<br></code></pre></td></tr></table></figure>
<h5 id="输出结果-8">输出结果</h5>
<blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre class=" language-hljs python"><code class="language-hljs python">hello Alan<br>hello Alan<br>hello Alan<br>hello Alan<br>hello hello Bob<br>hello Bob<br>hello Bob<br>hello Bob<br>hello Bob<br>Alanhello Cendy<br>hello Cendyhello Bob<br>hello<br>hello Alanhello Cendy<br></code></pre></td></tr></table></figure>
</blockquote>
<h2 id="5、继承的方法">5、继承的方法</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-comment"># coding:utf-8</span><br><br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">say_hi</span><span class="hljs-params">(count,name)</span>:</span><br>    <span class="hljs-comment"># time.sleep(1)					#延迟几秒</span><br>    <span class="hljs-comment"># print('hello world!')</span><br>    <span class="hljs-keyword">while</span> count &gt; <span class="hljs-number">0</span>:<br>        print(<span class="hljs-string">'hello'</span>, name)<br>        count -= <span class="hljs-number">1</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span><br>    username = [<span class="hljs-string">'Alan'</span>,<span class="hljs-string">'Bob'</span>,<span class="hljs-string">'Cendy'</span>,<span class="hljs-string">'Kily'</span>,<span class="hljs-string">'Heny'</span>]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>):<br>        <span class="hljs-comment"># thread = threading.Thread(target=say_hi,args=(10,username[i]))</span><br>        thread = MyThread(<span class="hljs-number">10</span>,username[i])<br>        thread.start()<br>    <span class="hljs-comment"># for i in range(5):</span><br>    <span class="hljs-comment">#     # 创建线程</span><br>    <span class="hljs-comment">#     thread = threading.Thread(target=say_hi)</span><br>    <span class="hljs-comment">#     # 启动线程</span><br>    <span class="hljs-comment">#     thread.start()</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyThread</span><span class="hljs-params">(threading.Thread)</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, count, name)</span>:</span><br>        super().__init__()<br>        self.count = count<br>        self.name = name<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span><span class="hljs-params">(self)</span>:</span><br>        <span class="hljs-keyword">while</span> self.count &gt; <span class="hljs-number">0</span>:<br>            print(<span class="hljs-string">'hello'</span>, self.name)<br>            self.count -= <span class="hljs-number">1</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run_main</span><span class="hljs-params">()</span>:</span><br>    username = [<span class="hljs-string">'Alan'</span>, <span class="hljs-string">'Bob'</span>, <span class="hljs-string">'Cendy'</span>, <span class="hljs-string">'Kily'</span>, <span class="hljs-string">'Heny'</span>]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>):<br>        <span class="hljs-comment"># thread = threading.Thread(target=say_hi, args=(10, username[i]))</span><br>        thread = MyThread(<span class="hljs-number">10</span>,username[i])<br>        thread.start()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string"><code class="language-hljs python"><span class="hljs-comment"># coding:utf-8</span><br><br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">say_hi</span><span class="hljs-params">(count,name)</span>:</span><br>    <span class="hljs-comment"># time.sleep(1)					#延迟几秒</span><br>    <span class="hljs-comment"># print('hello world!')</span><br>    <span class="hljs-keyword">while</span> count &gt; <span class="hljs-number">0</span>:<br>        print(<span class="hljs-string">'hello'</span>, name)<br>        count -= <span class="hljs-number">1</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span><br>    username = [<span class="hljs-string">'Alan'</span>,<span class="hljs-string">'Bob'</span>,<span class="hljs-string">'Cendy'</span>,<span class="hljs-string">'Kily'</span>,<span class="hljs-string">'Heny'</span>]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>):<br>        <span class="hljs-comment"># thread = threading.Thread(target=say_hi,args=(10,username[i]))</span><br>        thread = MyThread(<span class="hljs-number">10</span>,username[i])<br>        thread.start()<br>    <span class="hljs-comment"># for i in range(5):</span><br>    <span class="hljs-comment">#     # 创建线程</span><br>    <span class="hljs-comment">#     thread = threading.Thread(target=say_hi)</span><br>    <span class="hljs-comment">#     # 启动线程</span><br>    <span class="hljs-comment">#     thread.start()</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyThread</span><span class="hljs-params">(threading.Thread)</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, count, name)</span>:</span><br>        super().__init__()<br>        self.count = count<br>        self.name = name<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span><span class="hljs-params">(self)</span>:</span><br>        <span class="hljs-keyword">while</span> self.count &gt; <span class="hljs-number">0</span>:<br>            print(<span class="hljs-string">'hello'</span>, self.name)<br>            self.count -= <span class="hljs-number">1</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run_main</span><span class="hljs-params">()</span>:</span><br>    username = [<span class="hljs-string">'Alan'</span>, <span class="hljs-string">'Bob'</span>, <span class="hljs-string">'Cendy'</span>, <span class="hljs-string">'Kily'</span>, <span class="hljs-string">'Heny'</span>]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>):<br>        <span class="hljs-comment"># thread = threading.Thread(target=say_hi, args=(10, username[i]))</span><br>        thread = MyThread(<span class="hljs-number">10</span>,username[i])<br>        thread.start()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<br>    run_main()<br></code></pre></td></tr></table></figure>
<h5 id="输出结果-9">输出结果</h5>
<blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre class=" language-hljs python"><code class="language-hljs python">hello Alan<br>hello Alan<br>hello Bob<br>hello Bob<br>hello Cendy<br>hello Cendy<br>hello Kily<br>hello Kily<br>hello Heny<br>hello Heny<br></code></pre></td></tr></table></figure>
</blockquote>
<h1>线程同步</h1>
<p><strong>如果多个线程共同对某个数据修改，则可能出现不可预料的结果，为了保证数据的正确性，需要对多个线程进行同步。</strong></p>
<p><strong>使用Thread对象的Lock和Rlock可以实现简单的线程同步，这两个对象都有acquire方法和release方法，对于那些需要每次只允许一个线程操作的数据，可以将其操作放到acquire和release方法之间。如下：</strong></p>
<p><strong>多线程的优势在于可以同时运行多个任务（至少感觉起来是这样）。但是当线程需要共享数据时，可能存在数据不同步的问题。</strong></p>
<p><strong>考虑这样一种情况：一个列表里所有元素都是0，线程&quot;set&quot;从后向前把所有元素改成1，而线程&quot;print&quot;负责从前往后读取列表并打印。</strong></p>
<p><strong>那么，可能线程&quot;set&quot;开始改的时候，线程&quot;print&quot;便来打印列表了，输出就成了一半0一半1，这就是数据的不同步。为了避免这种情况，引入了锁的概念。</strong></p>
<p><strong>锁有两种状态——锁定和未锁定。每当一个线程比如&quot;set&quot;要访问共享数据时，必须先获得锁定；如果已经有别的线程比如&quot;print&quot;获得锁定了，那么就让线程&quot;set&quot;暂停，也就是同步阻塞；等到线程&quot;print&quot;访问完毕，释放锁以后，再让线程&quot;set&quot;继续。</strong></p>
<p><strong>经过这样的处理，打印列表时要么全部输出0，要么全部输出1，不会再出现一半0一半1的尴尬场面。</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">myThread</span> <span class="hljs-params">(threading.Thread)</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, threadID, name, counter)</span>:</span><br>        threading.Thread.__init__(self)<br>        self.threadID = threadID<br>        self.name = name<br>        self.counter = counter<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span><span class="hljs-params">(self)</span>:</span><br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"开启线程： "</span> + self.name)<br>        <span class="hljs-comment"># 获取锁，用于线程同步</span><br>        threadLock.acquire()<br>        print_time(self.name, self.counter, <span class="hljs-number">3</span>)<br>        <span class="hljs-comment"># 释放锁，开启下一个线程</span><br>        threadLock.release()<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_time</span><span class="hljs-params">(threadName, delay, counter)</span>:</span><br>    <span class="hljs-keyword">while</span> counter:<br>        time.sleep(delay)<br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"%s: %s"</span> % (threadName, time.ctime(time.time())))<br>        counter -= <span class="hljs-number">1</span><br><br>threadLock = threading.Lock()<br>threads = []<br><br><span class="hljs-comment"># 创建新线程</span><br>thread1 = myThread(<span class="hljs-number">1</span>, <span class="hljs-string">"Thread-1"</span>, <span class="hljs-number">1</span>)<br>thread2 = myThread(<span class="hljs-number">2</span>, <span class="hljs-string">"Thread-2"</span>, <span class="hljs-number">2</span>)<br><br><span class="hljs-comment"># 开启新线程</span><br>thread1.start()<br>thread2.start()<br><br><span class="hljs-comment"># 添加线程到线程列表</span><br>threads.append(thread1)<br>threads.append(thread2)<br><br><span class="hljs-comment"># 等待所有线程完成</span><br><span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:<br>    t.join()<br><span class="hljs-keyword">print</span> (<span class="hljs-string"><code class="language-hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">myThread</span> <span class="hljs-params">(threading.Thread)</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, threadID, name, counter)</span>:</span><br>        threading.Thread.__init__(self)<br>        self.threadID = threadID<br>        self.name = name<br>        self.counter = counter<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span><span class="hljs-params">(self)</span>:</span><br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"开启线程： "</span> + self.name)<br>        <span class="hljs-comment"># 获取锁，用于线程同步</span><br>        threadLock.acquire()<br>        print_time(self.name, self.counter, <span class="hljs-number">3</span>)<br>        <span class="hljs-comment"># 释放锁，开启下一个线程</span><br>        threadLock.release()<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_time</span><span class="hljs-params">(threadName, delay, counter)</span>:</span><br>    <span class="hljs-keyword">while</span> counter:<br>        time.sleep(delay)<br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"%s: %s"</span> % (threadName, time.ctime(time.time())))<br>        counter -= <span class="hljs-number">1</span><br><br>threadLock = threading.Lock()<br>threads = []<br><br><span class="hljs-comment"># 创建新线程</span><br>thread1 = myThread(<span class="hljs-number">1</span>, <span class="hljs-string">"Thread-1"</span>, <span class="hljs-number">1</span>)<br>thread2 = myThread(<span class="hljs-number">2</span>, <span class="hljs-string">"Thread-2"</span>, <span class="hljs-number">2</span>)<br><br><span class="hljs-comment"># 开启新线程</span><br>thread1.start()<br>thread2.start()<br><br><span class="hljs-comment"># 添加线程到线程列表</span><br>threads.append(thread1)<br>threads.append(thread2)<br><br><span class="hljs-comment"># 等待所有线程完成</span><br><span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:<br>    t.join()<br><span class="hljs-keyword">print</span> (<span class="hljs-string">"退出主线程"</span>)<br></code></pre></td></tr></table></figure>
<h5 id="输出结果-10">输出结果</h5>
<blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre class=" language-hljs css">开启线程： <span class="hljs-selector-tag">Thread-1</span><br>开启线程： <span class="hljs-selector-tag">Thread-2</span><br><span class="hljs-selector-tag">Thread-1</span>: <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Aug</span> 10 20<span class="hljs-selector-pseudo">:45</span><span class="hljs-selector-pseudo">:59</span> 2017<br><span class="hljs-selector-tag">Thread-1</span>: <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Aug</span> 10 20<span class="hljs-selector-pseudo">:46</span><span class="hljs-selector-pseudo">:00</span> 2017<br><span class="hljs-selector-tag">Thread-1</span>: <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Aug</span> 10 20<span class="hljs-selector-pseudo">:46</span><span class="hljs-selector-pseudo">:01</span> 2017<br><span class="hljs-selector-tag">Thread-2</span>: <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Aug</span> 10 20<span class="hljs-selector-pseudo">:46</span><span class="hljs-selector-pseudo">:03</span> 2017<br><span class="hljs-selector-tag">Thread-2</span>: <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Aug</span> 10 20<span class="hljs-selector-pseudo">:46</span><span class="hljs-selector-pseudo">:05</span> 2017<br><span class="hljs-selector-tag">Thread-2</span>: <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Aug</span> 10 20<span class="hljs-selector-pseudo">:46</span><span class="hljs-selector-pseudo"><code class="language-hljs css">开启线程： <span class="hljs-selector-tag">Thread-1</span><br>开启线程： <span class="hljs-selector-tag">Thread-2</span><br><span class="hljs-selector-tag">Thread-1</span>: <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Aug</span> 10 20<span class="hljs-selector-pseudo">:45</span><span class="hljs-selector-pseudo">:59</span> 2017<br><span class="hljs-selector-tag">Thread-1</span>: <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Aug</span> 10 20<span class="hljs-selector-pseudo">:46</span><span class="hljs-selector-pseudo">:00</span> 2017<br><span class="hljs-selector-tag">Thread-1</span>: <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Aug</span> 10 20<span class="hljs-selector-pseudo">:46</span><span class="hljs-selector-pseudo">:01</span> 2017<br><span class="hljs-selector-tag">Thread-2</span>: <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Aug</span> 10 20<span class="hljs-selector-pseudo">:46</span><span class="hljs-selector-pseudo">:03</span> 2017<br><span class="hljs-selector-tag">Thread-2</span>: <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Aug</span> 10 20<span class="hljs-selector-pseudo">:46</span><span class="hljs-selector-pseudo">:05</span> 2017<br><span class="hljs-selector-tag">Thread-2</span>: <span class="hljs-selector-tag">Thu</span> <span class="hljs-selector-tag">Aug</span> 10 20<span class="hljs-selector-pseudo">:46</span><span class="hljs-selector-pseudo">:07</span> 2017<br>退出主线程<br></code></pre></td></tr></table></figure>
</blockquote>
<h1>线程优先级队列（ Queue）</h1>
<p><strong>Python的Queue模块中提供了同步的、线程安全的队列类，包括FIFO（先入先出)队列Queue，LIFO（后入先出）队列LifoQueue，和优先级队列PriorityQueue。这些队列都实现了锁原语，能够在多线程中直接使用。可以使用队列来实现线程间的同步。</strong></p>
<h4 id="Queue模块中的常用方法">Queue模块中的常用方法:</h4>
<ul>
<li><strong>Queue.qsize() 返回队列的大小</strong></li>
<li><strong>Queue.empty() 如果队列为空，返回True,反之False</strong></li>
<li><strong>Queue.full() 如果队列满了，返回True,反之False</strong></li>
<li><strong>Queue.full 与 maxsize 大小对应</strong></li>
<li><strong>Queue.get([block[, timeout]])获取队列，timeout等待时间</strong></li>
<li><strong>Queue.get_nowait() 相当Queue.get(False)</strong></li>
<li><strong>Queue.put(item) 写入队列，timeout等待时间</strong></li>
<li><strong>Queue.put_nowait(item) 相当Queue.put(item, False)</strong></li>
<li><strong>Queue.task_done() 在完成一项工作之后，Queue.task_done()函数向任务已经完成的队列发送一个信号</strong></li>
<li><strong>Queue.join() 实际上意味着等到队列为空，再执行别的操作</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">import</span> queue<br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br>exitFlag = <span class="hljs-number">0</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">myThread</span> <span class="hljs-params">(threading.Thread)</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, threadID, name, q)</span>:</span><br>        threading.Thread.__init__(self)<br>        self.threadID = threadID<br>        self.name = name<br>        self.q = q<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span><span class="hljs-params">(self)</span>:</span><br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"开启线程："</span> + self.name)<br>        process_data(self.name, self.q)<br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"退出线程："</span> + self.name)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process_data</span><span class="hljs-params">(threadName, q)</span>:</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> exitFlag:<br>        queueLock.acquire()<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> workQueue.empty():<br>            data = q.get()<br>            queueLock.release()<br>            <span class="hljs-keyword">print</span> (<span class="hljs-string">"%s processing %s"</span> % (threadName, data))<br>        <span class="hljs-keyword">else</span>:<br>            queueLock.release()<br>        time.sleep(<span class="hljs-number">1</span>)<br><br>threadList = [<span class="hljs-string">"Thread-1"</span>, <span class="hljs-string">"Thread-2"</span>, <span class="hljs-string">"Thread-3"</span>]<br>nameList = [<span class="hljs-string">"One"</span>, <span class="hljs-string">"Two"</span>, <span class="hljs-string">"Three"</span>, <span class="hljs-string">"Four"</span>, <span class="hljs-string">"Five"</span>]<br>queueLock = threading.Lock()<br>workQueue = queue.Queue(<span class="hljs-number">10</span>)<br>threads = []<br>threadID = <span class="hljs-number">1</span><br><br><span class="hljs-comment"># 创建新线程</span><br><span class="hljs-keyword">for</span> tName <span class="hljs-keyword">in</span> threadList:<br>    thread = myThread(threadID, tName, workQueue)<br>    thread.start()<br>    threads.append(thread)<br>    threadID += <span class="hljs-number">1</span><br><br><span class="hljs-comment"># 填充队列</span><br>queueLock.acquire()<br><span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> nameList:<br>    workQueue.put(word)<br>queueLock.release()<br><br><span class="hljs-comment"># 等待队列清空</span><br><span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> workQueue.empty():<br>    <span class="hljs-keyword">pass</span><br><br><span class="hljs-comment"># 通知线程是时候退出</span><br>exitFlag = <span class="hljs-number">1</span><br><br><span class="hljs-comment"># 等待所有线程完成</span><br><span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:<br>    t.join()<br><span class="hljs-keyword">print</span> (<span class="hljs-string"><code class="language-hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">import</span> queue<br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br>exitFlag = <span class="hljs-number">0</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">myThread</span> <span class="hljs-params">(threading.Thread)</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, threadID, name, q)</span>:</span><br>        threading.Thread.__init__(self)<br>        self.threadID = threadID<br>        self.name = name<br>        self.q = q<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span><span class="hljs-params">(self)</span>:</span><br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"开启线程："</span> + self.name)<br>        process_data(self.name, self.q)<br>        <span class="hljs-keyword">print</span> (<span class="hljs-string">"退出线程："</span> + self.name)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process_data</span><span class="hljs-params">(threadName, q)</span>:</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> exitFlag:<br>        queueLock.acquire()<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> workQueue.empty():<br>            data = q.get()<br>            queueLock.release()<br>            <span class="hljs-keyword">print</span> (<span class="hljs-string">"%s processing %s"</span> % (threadName, data))<br>        <span class="hljs-keyword">else</span>:<br>            queueLock.release()<br>        time.sleep(<span class="hljs-number">1</span>)<br><br>threadList = [<span class="hljs-string">"Thread-1"</span>, <span class="hljs-string">"Thread-2"</span>, <span class="hljs-string">"Thread-3"</span>]<br>nameList = [<span class="hljs-string">"One"</span>, <span class="hljs-string">"Two"</span>, <span class="hljs-string">"Three"</span>, <span class="hljs-string">"Four"</span>, <span class="hljs-string">"Five"</span>]<br>queueLock = threading.Lock()<br>workQueue = queue.Queue(<span class="hljs-number">10</span>)<br>threads = []<br>threadID = <span class="hljs-number">1</span><br><br><span class="hljs-comment"># 创建新线程</span><br><span class="hljs-keyword">for</span> tName <span class="hljs-keyword">in</span> threadList:<br>    thread = myThread(threadID, tName, workQueue)<br>    thread.start()<br>    threads.append(thread)<br>    threadID += <span class="hljs-number">1</span><br><br><span class="hljs-comment"># 填充队列</span><br>queueLock.acquire()<br><span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> nameList:<br>    workQueue.put(word)<br>queueLock.release()<br><br><span class="hljs-comment"># 等待队列清空</span><br><span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> workQueue.empty():<br>    <span class="hljs-keyword">pass</span><br><br><span class="hljs-comment"># 通知线程是时候退出</span><br>exitFlag = <span class="hljs-number">1</span><br><br><span class="hljs-comment"># 等待所有线程完成</span><br><span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:<br>    t.join()<br><span class="hljs-keyword">print</span> (<span class="hljs-string">"退出主线程"</span>)<br></code></pre></td></tr></table></figure>
<p><strong>上面的代码每次执行的结果是不一样的，取决于哪个进程先获得锁，一次运行的输出如下：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre class=" language-hljs python">开启线程：Thread<span class="hljs-number">-1</span><br>开启线程：Thread<span class="hljs-number">-2</span><br>开启线程：Thread<span class="hljs-number">-3</span><br>Thread<span class="hljs-number">-2</span> processing One<br>Thread<span class="hljs-number">-3</span> processing Two<br>Thread<span class="hljs-number">-1</span> processing Three<br>Thread<span class="hljs-number">-3</span> processing Four<br>Thread<span class="hljs-number">-1</span> processing Five<br>退出线程：Thread<span class="hljs-number">-3</span><br>退出线程：Thread<span class="hljs-number">-2</span><br>退出线程：Thread<span class="hljs-number"><code class="language-hljs python">开启线程：Thread<span class="hljs-number">-1</span><br>开启线程：Thread<span class="hljs-number">-2</span><br>开启线程：Thread<span class="hljs-number">-3</span><br>Thread<span class="hljs-number">-2</span> processing One<br>Thread<span class="hljs-number">-3</span> processing Two<br>Thread<span class="hljs-number">-1</span> processing Three<br>Thread<span class="hljs-number">-3</span> processing Four<br>Thread<span class="hljs-number">-1</span> processing Five<br>退出线程：Thread<span class="hljs-number">-3</span><br>退出线程：Thread<span class="hljs-number">-2</span><br>退出线程：Thread<span class="hljs-number">-1</span><br>退出主线程<br></code></pre></td></tr></table></figure>
<h1>总结</h1>
<p><strong>如果你的代码是IO密集型的，线程和多进程可以帮到你。多进程比线程更易用，但是消耗更多的内存。如果你的代码是CPU密集型的，多进程就明显是更好的选择——特别是所使用的机器是多核或多CPU的。对于网络应用，在你需要扩展到多台机器上执行任务，RQ是更好的选择。</strong></p>
<h1>注：关于并发、并行区别与联系</h1>
<ul>
<li><strong>并发是指，程序在运行的过程中存在多于一个的执行上下文。这些执行上下文一般对应着不同的调用栈。</strong></li>
</ul>
<p><strong>在单处理器上，并发程序虽然有多个上下文运行环境，但某一个时刻只有一个任务在运行。</strong></p>
<p><strong>但在多处理器上，因为有了多个执行单元，就可以同时有数个任务在跑。</strong></p>
<ul>
<li><strong>这种物理上同一时刻有多个任务同时运行的方式就是并行。</strong></li>
</ul>
<p><strong>和并发相比，并行更加强调多个任务同时在运行。</strong></p>
<p><strong>而且并行还有一个层次问题，比如是指令间的并行还是任务间的并行。</strong></p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Wu Shao Dong</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://wsdlxgp.top/posts/2b38.html">https://wsdlxgp.top/posts/2b38.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://wsdlxgp.top" target="_blank">Xgp & Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/nfs/">nfs</a><a class="post-meta__tags" href="/tags/deployment/">deployment</a><a class="post-meta__tags" href="/tags/pv/">pv</a><a class="post-meta__tags" href="/tags/pvc/">pvc</a><a class="post-meta__tags" href="/tags/dashboard/">dashboard</a><a class="post-meta__tags" href="/tags/helm/">helm</a><a class="post-meta__tags" href="/tags/StorageClass/">StorageClass</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/a1c5.html"><img class="prev-cover" data-src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq94p.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">小案例</div></div></a></div><div class="next-post pull-right"><a href="/posts/f802.html"><img class="next-cover" data-src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq92p.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Python并发线程介绍</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/posts/e939.html" title="初识python"><img class="relatedPosts_cover" data-src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq46p.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-14</div><div class="relatedPosts_title">初识python</div></div></a></div><div class="relatedPosts_item"><a href="/posts/9a1f.html" title="python变量"><img class="relatedPosts_cover" data-src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq47p.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-14</div><div class="relatedPosts_title">python变量</div></div></a></div><div class="relatedPosts_item"><a href="/posts/h8er.html" title="k8s复习"><img class="relatedPosts_cover" data-src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq45p.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-14</div><div class="relatedPosts_title">k8s复习</div></div></a></div><div class="relatedPosts_item"><a href="/posts/9b8f.html" title="布尔表达式"><img class="relatedPosts_cover" data-src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq49p.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-14</div><div class="relatedPosts_title">布尔表达式</div></div></a></div><div class="relatedPosts_item"><a href="/posts/46cd.html" title="Python 列表"><img class="relatedPosts_cover" data-src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq48p.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-14</div><div class="relatedPosts_title">Python 列表</div></div></a></div><div class="relatedPosts_item"><a href="/posts/8e0b.html" title="Python 字典"><img class="relatedPosts_cover" data-src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq50p.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-14</div><div class="relatedPosts_title">Python 字典</div></div></a></div></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Wu Shao Dong</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><button id="readmode" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" title="缩小字体"><i class="fas fa-minus"></i></button><button class="translate_chn_to_cht" id="translateLink" title="简繁转换">繁</button><button id="darkmode" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>