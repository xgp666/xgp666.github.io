<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Python监控Linux系统（2） | Xgp &amp; Blog</title><meta name="description" content="使用Python监控Linux系统 Linux下有许多使用Python语言编写的监控工具，如inotify-sync, dstat和glances. 此外，如果要根据业务编写简单的监控脚本，很多工程师也会选择Python语言。Python语言是一门简单 易学&#x2F;语法清晰&#x2F;表达能力强的编程语言,非常适合于编写监控程序的场景。使用Python语言编写监控程序具有以下几个优势:  Python语言开发效率"><meta name="keywords" content="nfs,deployment,pv,pvc,Storage Class,dashboard,helm"><meta name="author" content="Wu Shao Dong"><meta name="copyright" content="Wu Shao Dong"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://gitee.com/xgpqq/tuchuang/raw/master/img/Yun.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://hm.baidu.com"/><link rel="dns-prefetch" href="https://hm.baidu.com"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="rPK0WSwqdm"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Python监控Linux系统（2）"><meta name="twitter:description" content="使用Python监控Linux系统 Linux下有许多使用Python语言编写的监控工具，如inotify-sync, dstat和glances. 此外，如果要根据业务编写简单的监控脚本，很多工程师也会选择Python语言。Python语言是一门简单 易学&#x2F;语法清晰&#x2F;表达能力强的编程语言,非常适合于编写监控程序的场景。使用Python语言编写监控程序具有以下几个优势:  Python语言开发效率"><meta name="twitter:image" content="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq71p.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Python监控Linux系统（2）"><meta property="og:url" content="https://wsdlxgp.top/posts/10c9.html"><meta property="og:site_name" content="Xgp &amp; Blog"><meta property="og:description" content="使用Python监控Linux系统 Linux下有许多使用Python语言编写的监控工具，如inotify-sync, dstat和glances. 此外，如果要根据业务编写简单的监控脚本，很多工程师也会选择Python语言。Python语言是一门简单 易学&#x2F;语法清晰&#x2F;表达能力强的编程语言,非常适合于编写监控程序的场景。使用Python语言编写监控程序具有以下几个优势:  Python语言开发效率"><meta property="og:image" content="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq71p.jpg"><meta property="article:published_time" content="2019-09-13T16:26:00.000Z"><meta property="article:modified_time" content="2020-07-11T08:02:23.801Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://wsdlxgp.top/posts/10c9.html"><link rel="prev" title="Python监控Linux系统（1）" href="https://wsdlxgp.top/posts/54c9.html"><link rel="next" title="Python执行外部命令（subprocess，call，Popen）" href="https://wsdlxgp.top/posts/48ac.html"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?cad0cd04042fcca2c687648c42a45fc9";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: {"languages":{"author":"作者: Wu Shao Dong","link":"链接: ","source":"来源: Xgp & Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: true,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="/self/Kimbiedark.css"><link rel="stylesheet" href="/self/hybrid.css"><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Xgp & Blog" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><canvas class="fireworks"></canvas><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://gitee.com/xgpqq/tuchuang/raw/master/img/666.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">132</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">76</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">4</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 我</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 其他</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 视频</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">1.</span> <span class="toc-text">使用Python监控Linux系统</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">2.</span> <span class="toc-text">一、Python编写的监控工具</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1、多功能系统资源统计工具dstat"><span class="toc-number">2.1.</span> <span class="toc-text">1、多功能系统资源统计工具dstat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2、dstat介绍"><span class="toc-number">2.2.</span> <span class="toc-text">2、dstat介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3、安装使用"><span class="toc-number">2.3.</span> <span class="toc-text">3、安装使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4、常用选项如下"><span class="toc-number">2.4.</span> <span class="toc-text">4、常用选项如下: .</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5、-dstat高级用法"><span class="toc-number">2.5.</span> <span class="toc-text">5、 dstat高级用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6、将结果输出到CSV文件"><span class="toc-number">2.6.</span> <span class="toc-text">6、将结果输出到CSV文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#用excel查看信息"><span class="toc-number">2.6.1.</span> <span class="toc-text">用excel查看信息</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">3.</span> <span class="toc-text">二、交互性监控工具glances</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1、glances简介"><span class="toc-number">3.1.</span> <span class="toc-text">1、glances简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2、glances-提供的系统信息"><span class="toc-number">3.2.</span> <span class="toc-text">2、glances 提供的系统信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3、Linux下安装glances"><span class="toc-number">3.3.</span> <span class="toc-text">3、Linux下安装glances</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4、glances的使用"><span class="toc-number">3.4.</span> <span class="toc-text">4、glances的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）glances的默认输出"><span class="toc-number">3.4.1.</span> <span class="toc-text">（1）glances的默认输出</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#glances-工作界面的说明"><span class="toc-number">3.4.1.1.</span> <span class="toc-text">glances 工作界面的说明 :</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（2）glances的可读性"><span class="toc-number">3.4.2.</span> <span class="toc-text">（2）glances的可读性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（3）glances中常见的命令"><span class="toc-number">3.4.3.</span> <span class="toc-text">（3）glances中常见的命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（4）如果我们安装了-Bottle-这个-web-框架，还能够通过-web-浏览器显示和命令行终端相同的监控界面。"><span class="toc-number">3.4.4.</span> <span class="toc-text">（4）如果我们安装了 Bottle 这个 web 框架，还能够通过 web 浏览器显示和命令行终端相同的监控界面。</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#web访问如下图："><span class="toc-number">3.4.4.1.</span> <span class="toc-text">web访问如下图：</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">4.</span> <span class="toc-text">三、Python监控Linux</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1、使用shell脚本监控"><span class="toc-number">4.1.</span> <span class="toc-text">1、使用shell脚本监控</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）安装转换工具"><span class="toc-number">4.1.1.</span> <span class="toc-text">（1）安装转换工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（2）编写shell脚本"><span class="toc-number">4.1.2.</span> <span class="toc-text">（2）编写shell脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（3）转换并执行"><span class="toc-number">4.1.3.</span> <span class="toc-text">（3）转换并执行</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2、使用python脚本监控"><span class="toc-number">4.2.</span> <span class="toc-text">2、使用python脚本监控</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）查看服务启动情况"><span class="toc-number">4.2.1.</span> <span class="toc-text">（1）查看服务启动情况</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#执行结果如下"><span class="toc-number">4.2.1.0.1.</span> <span class="toc-text">执行结果如下:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（2）简易版"><span class="toc-number">4.2.2.</span> <span class="toc-text">（2）简易版</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#执行脚本："><span class="toc-number">4.2.2.1.</span> <span class="toc-text">执行脚本：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（3）直观图"><span class="toc-number">4.2.3.</span> <span class="toc-text">（3）直观图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#执行脚本：-2"><span class="toc-number">4.2.3.1.</span> <span class="toc-text">执行脚本：</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq71p.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Xgp &amp; Blog</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 我</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 其他</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 视频</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Python监控Linux系统（2）</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2019-09-14 00:26:00"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2019-09-14</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-07-11 16:02:23"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-07-11</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/python/">python</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon far fa-file-word" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">4.9k</span><span class="post-meta__separator">|</span><i class="post-meta__icon far fa-clock" aria-hidden="true"></i><span>阅读时长: 18 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1>使用Python监控Linux系统</h1>
<p><strong>Linux下有许多使用Python语言编写的监控工具，如inotify-sync, dstat和glances. 此外，如果要根据业务编写简单的监控脚本，很多工程师也会选择Python语言。Python语言是一门简单 易学/语法清晰/表达能力强的编程语言,非常适合于编写监控程序的场景。使用Python语言编写监控程序具有以下几个优势:</strong></p>
<ul>
<li><strong>Python语言开发效率高。 Python语言有自 己的优势与劣势，使用Python开发监控程序是一个充分发挥Python优势，避免Python劣势的领域。对于监控程序来说，能够利用Python语言开发效率高的优势尽快完成程序的编写工作。同时，监控程序也不要求性能，因此避免了Python语言性能不如C、C++和Java的劣势。</strong></li>
<li><strong>Python语言表达能力强。相信任何-个学习Linux的工程师都使用过shel脚本编写过监控程序。虽然Linux下有很多监控工具,也有很多文本处理程序，但是获取监控与解析结果是完全不同的工具。解析监控结果的程序不理解监控程序输出结果的具体含义。Python语言中有非常丰富的数据结构，可以用各种方式保存监控结果，以便后续处理。</strong></li>
<li><strong>利用第三方库开发监控程序。Python的标准库本身非常强大,被称为”连电池都包含在内”。对于-个问题,如果标准库没有提供相应的工具,那么也会有开源的项目来填补这个空白。监控程序正式这样一种情况， 在Python语言中，具有非常成熟的第三方库帮助开发者简化监控程序的编写工作。</strong></li>
</ul>
<h1>一、Python编写的监控工具</h1>
<p><strong>我们将介绍两个Python语言编写的监控工具，分别是dstat和glances。</strong></p>
<h2 id="1、多功能系统资源统计工具dstat">1、多功能系统资源统计工具dstat</h2>
<p><strong>dstat是一个用Python语言实现的多功能系统资源统计工具，用来取代Linux下的vmstat、iostat、netstat和ifstat等命令。并且，dstat克服了这些命令的限制，增加了额外的功能、以及更多的计数器与更好的灵活性。dstat可以在一个界面上展示非常全面的监控信息，因此，在系统监控、基准测试和故障排除等应用场景下特别有用。</strong></p>
<p><strong>我们可以使用dstat监控所有系统资源的使用情况，并且可以结合不同的场景定制监控的资源。例如，在同一时间段以相同的时间频率比较网络带宽与磁盘的吞吐率。</strong></p>
<p><strong>dstat将以列表的形式显示监控信息，并且用不同的颜色进行输出，以可读性较强的单位展示监控数值。例如，对于字节数值，dstat自动根据数值的大小，以K、M、G等单位进行显示，避免了开发者使用其他命令时因为数值太大造成的困惑和错误。此外，使用dstat还可以非常方便地编写插件用来收集默认情况下没有收集的监控信息。dstat是专门为人们实时查看监控信息设计的，因此，默认将监控结果输出到屏幕终端。我们也可以将监控信息以CSV格式输出到文件，以便后续处理。</strong></p>
<h2 id="2、dstat介绍">2、dstat介绍</h2>
<p><strong>作为一个多功能系统资源统计工具， dstat具有以下特性:</strong></p>
<ul>
<li><strong>结合了 vmstat, iostat, ifstat, netstat 等监控工具的功能，并且提供了更多的监控信息；</strong></li>
<li><strong>实时显示监控数据；</strong></li>
<li><strong>在问题分析和故障排查时，可以监视最重要的计数器，也可以对计数器进行排序；</strong></li>
<li><strong>模块化设计；</strong></li>
<li><strong>使用 Python 语言编写，更方便扩展现有的工作任务；</strong></li>
<li><strong>容易扩展，便于添加自定义的计数器；</strong></li>
<li><strong>包含的许多扩展插件充分说明了增加新的监控项目是很方便的；</strong></li>
<li><strong>可以分组统计块设备/网络设备，并给出、汇总信息；</strong></li>
<li><strong>可以显示每台设备中断信息；</strong></li>
<li><strong>非常准确的时间精度，即便是系统负荷较高也不会延迟显示；</strong></li>
<li><strong>准确显示单位，限制转换误差范围；</strong></li>
<li><strong>用不同的颜色显示不同的单位，增加可读性；</strong></li>
<li><strong>显示中间结果延时小于1秒</strong></li>
<li><strong>支持 csv 格式输出，便于将监控信息导人 Gnumeric 和 Excel 以生成图形。</strong></li>
</ul>
<h2 id="3、安装使用">3、安装使用</h2>
<p><strong>如果操作系统默认没有安装dstat.那么需要我们手动进行安装。如下所示:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python ~]# yum -y install dstat<br></code></pre></td></tr></table></figure>
<p><strong>&lt;1&gt;dstat命令的–version选项，除了显示出tat的版本以外，还会显示操作系统的版本、Python语言的版本、cpu的个数，以及dstat支持的插件列表等详细信息。如下所示：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python ~]# dstat --version<br></code></pre></td></tr></table></figure>
<p><img src="https://gitee.com/xgpqq/tuchuang/raw/master/img/image-20200429141843251.png" alt="image-20200429141843251"></p>
<p><strong>&lt;2&gt;dstat --list获取dstat的插件列表</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">dstat --list<br></code></pre></td></tr></table></figure>
<p><img src="https://gitee.com/xgpqq/tuchuang/raw/master/img/image-20200429141907299.png" alt="image-20200429141907299"></p>
<p><strong>&lt;3&gt;直接在终端输入dstat命令，dstat将以默认参数运行。默认情况下，dstat会收集cpu、磁盘、网络、换页和系统信息，并以一秒钟一次的频率进行输出，直到我们按 ctrl+c 结束。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python ~]# dstat<br></code></pre></td></tr></table></figure>
<p><img src="https://gitee.com/xgpqq/tuchuang/raw/master/img/image-20200429141632842.png" alt="image-20200429141632842"></p>
<h2 id="4、常用选项如下">4、常用选项如下: .</h2>
<blockquote>
<p><strong>直接跟数字，表示#秒收集一次数据，默认为1秒; dstat 5表示5秒更新一次</strong></p>
</blockquote>
<ul>
<li>
<p><strong>-c,–cpu：统计CPU状态，包括system，user，idle，wait，hardware interrupt，software，interrupt等;</strong></p>
</li>
<li>
<p><strong>-d，–disk：统计磁盘读写状态</strong></p>
</li>
<li>
<p><strong>-D total,sda：统计指定磁盘或汇总信息</strong></p>
</li>
<li>
<p><strong>-l，–load：统计系统负载情况，包括1分钟、5分钟、15分钟平均值</strong></p>
</li>
<li>
<p><strong>-m，- -mem：统计系统物理内存使用情况，包括used, buffers， cache，free</strong></p>
</li>
<li>
<p><strong>-s，–swap：统计swap已使用和剩余量</strong></p>
</li>
<li>
<p><strong>-n，–net：统计网络使用情况，包括接收和发送数据</strong></p>
</li>
<li>
<p><strong>-N eth1,total 统计eth1接口汇总流量</strong></p>
</li>
<li>
<p><strong>-r，–io：统计I/0请求，包括读写请求</strong></p>
</li>
<li>
<p><strong>-p，–proc：统计进程信息，包括runnable、uninterruptible、new</strong></p>
</li>
<li>
<p><strong>-y，–sys：统计系统信息，包括中断、上下文切换</strong></p>
</li>
<li>
<p><strong>-t：显示统计时时间，对分析历史数据非常有用</strong></p>
</li>
<li>
<p><strong>–fs：统计文件打开数和inodes数</strong></p>
</li>
</ul>
<p><strong>除了前面介绍的与监控相关的参数以外，dstat还可以像vmstat和iostat- 样使用参数控制报告的时间间隔，或者同时指定时间间隔与报告次数。</strong></p>
<p><strong>例如，下面的命令表示以默认的选项运行dstat,每2秒钟输出1条监控信息，并在输出10条监控信息以后退出dstat。如下所示:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python ~]# dstat 2 10<br>You did not select any stats, using -cdngy by default.<br>Terminal width too small, trimming output.<br>----total-cpu-usage---- -dsk/total- -net/total- ---paging--><br>usr sys idl wai hiq siq| read  writ| recv  send|  in   out ><br>  2   1  96   0   0   0| 270k  233k|   0     0 |  75B 1812B><br>  0   0 100   0   0   0|   0     0 |  60B  510B|   0     0 ><br>  0   0 100   0   0   0|   0     0 |  60B  294B|   0     0 ><br>  0   1 100   0   0   0|   0     0 |  60B  294B|   0     0 ><br>  0   0 100   0   0   0|   0     0 | 182B  294B|   0     0 ><br>  1   0 100   0   0   0|   0     0 |  60B  294B|   0     0 ><br>  0   1  99   0   0   0|   0     0 |  60B  294B|   0     0 ><br>  0   1 100   0   0   0|   0     0 |  60B  294B|   0     0 ><br>  0   0 100   0   0   0|   0     0 |  60B  294B|   0     0 ><br>  1   0 100   0   0   0|   0     0 |  60B  294B|   0     0 ><br>  0   0 100   0   0   0|   0    25k|  60B  298B|   0     0 ><br></code></pre></td></tr></table></figure>
<p><strong>dstat命令中有很多参数可选，你可以通过man dstat命令查看，大多数常用的参数有这些：</strong></p>
<ul>
<li><strong>-l ：显示负载统计量</strong></li>
<li><strong>-m ：显示内存使用率（包括used，buffer，cache，free值）</strong></li>
<li><strong>-r ：显示I/O统计</strong></li>
<li><strong>-s ：显示交换分区使用情况</strong></li>
<li><strong>-t ：将当前时间显示在第一行</strong></li>
<li><strong>–fs ：显示文件系统统计数据（包括文件总数量和inodes值）</strong></li>
<li><strong>–nocolor ：不显示颜色（有时候有用）</strong></li>
<li><strong>–socket ：显示网络统计数据</strong></li>
<li><strong>–tcp ：显示常用的TCP统计</strong></li>
<li><strong>–udp ：显示监听的UDP接口及其当前用量的一些动态数据</strong></li>
</ul>
<p><strong>dstat附带了一些插件很大程度地扩展了它的功能。你可以通过查看/usr/share/dstat目录来查看它们的一些使用方法，常用的有这些：</strong></p>
<ul>
<li><strong>-–disk-util ：显示某一时间磁盘的忙碌状况</strong></li>
<li><strong>-–freespace ：显示当前磁盘空间使用率</strong></li>
<li><strong>-–proc-count ：显示正在运行的程序数量</strong></li>
<li><strong>-–top-bio ：指出块I/O最大的进程</strong></li>
<li><strong>-–top-cpu ：图形化显示CPU占用最大的进程</strong></li>
<li><strong>-–top-io ：显示正常I/O最大的进程</strong></li>
<li><strong>-–top-mem ：显示占用最多内存的进程</strong></li>
</ul>
<h2 id="5、-dstat高级用法">5、 dstat高级用法</h2>
<p><strong>dstat的强大之处不仅仅是因为它聚合了多种工具的监控结果，还因为它能通过附带的插件事项一些更高级功能。</strong></p>
<p><strong>如:找出磁盘重占用资源最高的进程和用户。</strong></p>
<p><strong>dstat -cdlmnpsyt 5 可以得到较全面的系统性能数据。</strong></p>
<p><strong>dstat的–top-(io|bio|cpu|cputime|cputime-avg |mem)通过这几个选项，可以看到具体是那个用户哪个进程占用了相关系统资源, 对系统调优非常有效。如查看当前占用I/O、 cpu、内存等最高的进程信息可以使用dstat --top-mem --top-io --top-cpu选项。以下示例演示了如何找出占用资源最多的进程。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python scripts]# dstat --top-mem --top-io --top-cpu<br>//查看当前占用I/O、CPU、内存等最高的进程信息<br><br>--most-expensive- ----most-expensive---- -most-expensive-<br>  memory process |     i/o process      |  cpu process   <br>gnome-shell 53.0M|bash        420k  119k|vmtoolsd     0.1<br>gnome-shell 53.0M|BT-Task    1026B    0 |                <br>gnome-shell 53.0M|gnome-shell 352B   82k|kworker/0:0  1.0<br>gnome-shell 53.0M|sshd: root@ 230B  196B|                <br>gnome-shell 53.0M|sshd: root@ 155B  196B|                <br>gnome-shell 53.0M|sshd: root@ 155B  196B|                <br>gnome-shell 53.0M|sshd: root@ 155B  196B|                <br>gnome-shell 53.0M|BT-Task    1406B    0 |<br></code></pre></td></tr></table></figure>
<p><em><strong>dstat的插件保存在/usr/share/dstat目录下， 我们可以参考它们的实现，编写自己的插件。</strong></em></p>
<h2 id="6、将结果输出到CSV文件">6、将结果输出到CSV文件</h2>
<p><strong>dstat还可以将监控信息保存到CSV文件中，以便后续进行处理。通过–output选项指定监控数据输出的文件。如下所示:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python ~]# dstat -a --output dstat_output.csv<br>Terminal width too small, trimming output.<br>----total-cpu-usage---- -dsk/total- -net/total- ---paging--><br>usr sys idl wai hiq siq| read  writ| recv  send|  in   out ><br>  2   1  97   0   0   0| 175k  158k|   0     0 |  59B 1973B><br>  0   0 100   0   0   0|   0     0 | 150B  822B|   0     0 ><br>  0   0 100   0   0   0|   0     0 |  60B  298B|   0     0 ><br>  0   0 100   0   0   0|   0     0 |  60B  298B|   0     0 ><br>  0   0 100   0   0   0|   0     0 |  60B  298B|   0     0 ><br>  0   1  99   0   0   0|   0     0 |  60B  298B|   0     0 ><br>  0   0 100   0   0   0|   0     0 | 210B  448B|   0     0 ><br>  1   0  99   0   0   0|   0    49k|  60B  298B|   0     0 ><br>  0   0 100   0   0   0|   0     0 | 210B  396B|   0     0 ><br>  0   0 100   0   0   0|   0     0 |  60B  298B|   0     0 >^C<br></code></pre></td></tr></table></figure>
<h3 id="用excel查看信息">用excel查看信息</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python ~]# sz dstat_output.csv<br>//导出本地文件到windows指定位置<br></code></pre></td></tr></table></figure>
<p><img src="https://gitee.com/xgpqq/tuchuang/raw/master/img/image-20200429160149926.png" alt="image-20200429160149926"></p>
<h1>二、交互性监控工具glances</h1>
<h2 id="1、glances简介">1、glances简介</h2>
<p><strong>glances是一款使用Python语言开发、基于psutil的跨平台系统监控工具。在所有的Linux命令行工具中，它与top命令最相似，都是命令行交互式监控工具。但是，glances实现了比top命令更齐全的监控，提供了更加丰富的功能。</strong></p>
<p><strong>在紧急情况下，工程师需要在尽可能短的时间内查看尽可能多的信息。此时，glances是一个不错的选择。 glances的设计初衷就是在当前窗口中尽可能多地显示系统消息。</strong></p>
<p><strong>glances可以在用户终端上实时显示重要的系统信息，并动态刷新内容。glances每隔3秒钟对其进行刷新，我们也可以使用命令行参数修改刷新的频率。与dstat相同的是，glances可以将捕获到的数据保存到文件中；而不同的是glances提供了API接口以便应用程序从glances中获取数据。</strong></p>
<h2 id="2、glances-提供的系统信息">2、glances 提供的系统信息</h2>
<ul>
<li><strong>CPU使用率；</strong></li>
<li><strong>内存使用情况；</strong></li>
<li><strong>内核统计信息和运行队列信息；</strong></li>
<li><strong>磁盘I/O速度、传输和读/写比率；</strong></li>
<li><strong>文件系统中的可用空间；</strong></li>
<li><strong>磁盘适配器；</strong></li>
<li><strong>网络I/O速度、传输和读/写比率；</strong></li>
<li><strong>页面空间和页面速度；</strong></li>
<li><strong>消耗资源最多的进程；</strong></li>
<li><strong>计算机信息和系统资源。</strong></li>
</ul>
<p><strong>glances 工具可以在用户的终端上实时显示重要的系统信息，并动态地对其进行更新。这个高效的工具可以工作于任何终端屏幕。另外它并不会消耗大量的 CPU 资源，通常低于百分之二。glances 在屏幕上对数据进行显示，并且每隔2秒钟对其进行更新。您也可以自己将这个时间间隔更改为更长或更短的数值。</strong></p>
<p><strong>glances 工具还可以将相同的数据捕获到一个文件，便于以后对报告进行分析和绘制图形。输出文件可以是电子表格的格式 (.csv) 或者 html 格式。</strong></p>
<h2 id="3、Linux下安装glances">3、Linux下安装glances</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><span class="hljs-meta">#</span><span class="bash"><code class="language-hljs shell"><span class="hljs-meta">#</span><span class="bash">需要epel-release </span><br>yum -y install epel-release <br>yum -y install glances<br></code></pre></td></tr></table></figure>
<p><strong>或</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><span class="hljs-meta">#</span><span class="bash"><code class="language-hljs shell"><span class="hljs-meta">#</span><span class="bash">需要python-devel</span><br>yum -y install python-devel -y<br>pip install glances<br></code></pre></td></tr></table></figure>
<h2 id="4、glances的使用">4、glances的使用</h2>
<h3 id="（1）glances的默认输出">（1）glances的默认输出</h3>
<p><strong>glances的使用非常简单，直接输入glances命令便进入了一个类似于top命令的交互式界面。在这个界面中，显示了比top更加全面，更加具有可读性的信息。</strong></p>
<p><strong>为了增加可读性，glances会以不同的颜色表示不同的状态。其中，绿色表示性能良好，元须做任何额外工作；蓝色表示系统性能有一些小问题，用户应当开始关注系统性能；紫色表示性能报警，应当采取措施；红色表示性能问题严重，应当立即处理。</strong></p>
<p><strong>lances是一个交互式的工具．因此，我们也可以输入命令来控制glances的行为。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs shrell"><code class="language-hljs shrell">[root@python ~]# glances<br></code></pre></td></tr></table></figure>
<p><img src="https://gitee.com/xgpqq/tuchuang/raw/master/img/image-20200429151108154.png" alt="image-20200429151108154"></p>
<h4 id="glances-工作界面的说明"><strong>glances 工作界面的说明 :</strong></h4>
<p><strong>在图 1 的上部是 CPU 、Load（负载）、Mem（内存使用）、 Swap（交换分区）的使用情况。在图 1 的中上部是网络接口、Processes（进程）的使用情况。通常包括如下字段：</strong></p>
<ul>
<li><strong>VIRT: 虚拟内存大小</strong></li>
<li><strong>RES: 进程占用的物理内存值</strong></li>
<li><strong>%CPU：该进程占用的 CPU 使用率</strong></li>
<li><strong>%MEM：该进程占用的物理内存和总内存的百分比</strong></li>
<li><strong>PID: 进程 ID 号</strong></li>
<li><strong>USER: 进程所有者的用户名</strong></li>
<li><strong>TIME+: 该进程启动后占用的总的 CPU 时间</strong></li>
<li><strong>IO_R 和 IO_W: 进程的读写 I/O 速率</strong></li>
<li><strong>NAME: 进程名称</strong></li>
<li><strong>NI: 进程优先级</strong></li>
<li><strong>S: 进程状态，其中 S 表示休眠，R 表示正在运行，Z 表示僵死状态。</strong></li>
</ul>
<h3 id="（2）glances的可读性">（2）glances的可读性</h3>
<p><strong>对比可以发现，glances对屏幕的利用率比top明显高很多，信息量很大，有许多top所没有显示的数据。而且，glances的实时变动比top颜值高太多了。</strong></p>
<p><strong>Glances 会用一下几种颜色来代表状态，如下所示：</strong></p>
<ul>
<li><strong>绿色：OK（一切正常）</strong></li>
<li><strong>蓝色：CAREFUL（需要注意）</strong></li>
<li><strong>紫色：WARNING（警告）</strong></li>
<li><strong>红色：CRITICAL（严重）</strong></li>
</ul>
<h3 id="（3）glances中常见的命令">（3）glances中常见的命令</h3>
<ul>
<li><strong>h：显示帮助信息</strong></li>
<li><strong>q：离开程序退出</strong></li>
<li><strong>c：按照 CPU 实时负载对系统进程进行排序</strong></li>
<li><strong>m：按照内存使用状况对系统进程排序</strong></li>
<li><strong>i：按照 I/O 使用状况对系统进程排序</strong></li>
<li><strong>p：按照进程名称排序</strong></li>
<li><strong>d：显示磁盘读写状况</strong></li>
<li><strong>w：删除日志文件</strong></li>
<li><strong>l：显示日志</strong></li>
<li><strong>s：显示传感器信息</strong></li>
<li><strong>f：显示系统信息</strong></li>
<li><strong>1：轮流显示每个 CPU 内核的使用情况（次选项仅仅使用在多核 CPU 系统）</strong></li>
</ul>
<p><strong>glances还支持将采集的数据导入到其他服务中心，包括InfluxDB、 Cassandra. CouchDB、 OpenTSDB、Prometheus. StatsD、 ElasticSearch, RabbitMQ/ActiveMQ、ZeroMQ、 Kafaka和Riemann.</strong></p>
<h3 id="（4）如果我们安装了-Bottle-这个-web-框架，还能够通过-web-浏览器显示和命令行终端相同的监控界面。">（4）如果我们安装了 Bottle 这个 web 框架，还能够通过 web 浏览器显示和命令行终端相同的监控界面。</h3>
<p><strong>glances还支持将采集的数据导人到其他服务中心，包括InfluxDB，Cassandra，CouchDB，OpenTSDB，Prometheus，StatsD，ElasticSearch，RabbitMQ/ActiveMQ，ZeroMQ，Kafka和Riemann。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python ~]# pip install bottle<br>//安装Bottle框架<br>[root@python ~]#  glances -w              ##默认端口是61208，访问地址没有限制<br>Glances Web User Interface started on http://0.0.0.0:61208/<br></code></pre></td></tr></table></figure>
<h4 id="web访问如下图："><a href="127.0.0.1:61208">web访问如下图：</a></h4>
<p><img src="https://gitee.com/xgpqq/tuchuang/raw/master/img/image-20200429185614710.png" alt="image-20200429185614710"></p>
<h1>三、Python监控Linux</h1>
<p><strong>shell查看磁盘的监控信息，如下所示：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python proc]# cat /proc/diskstats <br>   8       0 sda 85935 21845 10913707 101067 3119 81257 743486 15647 0 31410 109079<br>   8       1 sda1 1822 0 12456 397 4 0 4096 74 0 457 462<br>   8       2 sda2 84082 21845 10897907 100659 3115 81257 739390 15573 0 30950 108604<br>  11       0 sr0 0 0 0 0 0 0 0 0 0 0 0<br> 253       0 dm-0 80726 0 10688467 99971 2275 0 82606 10224 0 27927 110196<br> 253       1 dm-1 25123 0 205184 7367 82098 0 656784 616558 0 5167 623924<br></code></pre></td></tr></table></figure>
<h2 id="1、使用shell脚本监控">1、使用shell脚本监控</h2>
<h3 id="（1）安装转换工具">（1）安装转换工具</h3>
<p><strong>dos2unix 和 unix2dos 命令将纯文本文件从 DOS 或 Mac 格式转换为 Unix，反之亦然。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class=" language-hljs plain"><code class="language-hljs plain">[root@python scripts]# yum -y install dos2unix<br>&#x2F;&#x2F;下载dos2unix<br></code></pre></td></tr></table></figure>
<h3 id="（2）编写shell脚本">（2）编写shell脚本</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre class=" language-hljs shell">[root@python scripts]# vim monitor.sh<br><span class="hljs-meta">#</span><span class="bash"><code class="language-hljs shell">[root@python scripts]# vim monitor.sh<br><span class="hljs-meta">#</span><span class="bash">/bin/sh</span><br>cpu_idle=$(top -n2 | grep 'Cpu' | tail -n 1 | awk '&#123;print $8&#125;')<br>cpu_usage=$(printf "%.2f" `echo "scale=2; 100 - $cpu_idle" | bc`)<br>mem_free=$(free -m | awk '/Mem:/&#123;print $4 + $6&#125;')<br>mem_total=$(free -m | awk '/Mem:/&#123;print $2&#125;')<br>mem_used=$(echo "$mem_total - $mem_free" | bc)<br>mem_rate=$(echo "$mem_used * 100 / $mem_total" | bc)<br>disk_usage=$(df -h / | tail -n 1 | awk '&#123;print $5&#125;')<br>disk_used=$(df -h / | tail -n 1 | awk '&#123;print $3&#125;')<br>echo "CPU利用率：$cpu_usage %"<br>echo "内存使用量: $mem_used M"<br>echo "内存利用率：$mem_rate %"<br>echo "磁盘空间使用量：$disk_used"<br>echo "磁盘空间利用率：$disk_usage"<br></code></pre></td></tr></table></figure>
<h3 id="（3）转换并执行">（3）转换并执行</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre class=" language-hljs shell">[root@python scripts]# dos2unix monitor.sh<br>//转换为格式为Unix<br>[root@python scripts]# cat monitor.sh<br><span class="hljs-meta">#</span><span class="bash"><code class="language-hljs shell">[root@python scripts]# dos2unix monitor.sh<br>//转换为格式为Unix<br>[root@python scripts]# cat monitor.sh<br><span class="hljs-meta">#</span><span class="bash">/bin/sh</span><br>cpu_idle=$(top -n2 | grep 'Cpu' | tail -n 1 | awk '&#123;print $8&#125;')<br>cpu_usage=$(printf "%.2f" `echo "scale=2; 100 - $cpu_idle" | bc`)<br>mem_free=$(free -m | awk '/Mem:/&#123;print $4 + $6&#125;')<br>mem_total=$(free -m | awk '/Mem:/&#123;print $2&#125;')<br>mem_used=$(echo "$mem_total - $mem_free" | bc)<br>mem_rate=$(echo "$mem_used * 100 / $mem_total" | bc)<br>disk_usage=$(df -h / | tail -n 1 | awk '&#123;print $5&#125;')<br>disk_used=$(df -h / | tail -n 1 | awk '&#123;print $3&#125;')<br>echo "CPU利用率：$cpu_usage %"<br>echo "内存使用量: $mem_used M"<br>echo "内存利用率：$mem_rate %"<br>echo "磁盘空间使用量：$disk_used"<br>echo "磁盘空间利用率：$disk_usage"<br>[root@python scripts]# sh monitor.sh<br>//执行编写好的脚本<br></code></pre></td></tr></table></figure>
<p><img src="https://gitee.com/xgpqq/tuchuang/raw/master/img/image-20200429165132049.png" alt="image-20200429165132049"></p>
<h2 id="2、使用python脚本监控">2、使用python脚本监控</h2>
<p><strong>编写一个Python脚本，监控磁盘信息，如下所示：</strong></p>
<h3 id="（1）查看服务启动情况">（1）查看服务启动情况</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python scripts]# vim proc_count.py <br><br>import os<br><br>n = 0<br>for item in os.listdir('/proc'):<br>    if item.isdigit():<br>        n = n+1<br>        # print(len(item))<br>print(n)<br></code></pre></td></tr></table></figure>
<h5 id="执行结果如下">执行结果如下:</h5>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python scripts]# python3 proc_count.py <br>175<br></code></pre></td></tr></table></figure>
<h3 id="（2）简易版">（2）简易版</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre class=" language-hljs spreadsheet"><code class="language-hljs spreadsheet">[root@python scripts]# vim monitor_dick.py<br># coding&#x3D;utf-8<br># !&#x2F;usr&#x2F;bin&#x2F;python<br><br>from __future__ import print_function<br>from collections import namedtuple<br><br>disk &#x3D; namedtuple('Disk', 'major_number minor_number device_name'<br>                          ' read_count read_merged_count read_sections'<br>                          ' time_spent_reading write_count write_merged_count'<br>                          ' write_sections time_spent_write io_requests'<br>                          ' time_spent_doing_io weighted_time_spent_dong_io')<br><br><br>def get_disk_info(device):<br>    with open('&#x2F;proc&#x2F;diskstats') as f:<br>        for line in f:<br>            if line.split()[2] &#x3D;&#x3D; device:<br>                return disk(*(line.split()))<br>    raise RuntimeError('设备(&#123;0&#125;)没找到。。。'.format(device))<br><br><br>def main():<br>    disk_info &#x3D; get_disk_info('sda1')<br><br>    print(disk_info)<br><br><br>if __name__ &#x3D;&#x3D; '__main__':<br>    main()<br></code></pre></td></tr></table></figure>
<h4 id="执行脚本：">执行脚本：</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python scripts]# python3 monitor_dick.py<br></code></pre></td></tr></table></figure>
<p><img src="https://gitee.com/xgpqq/tuchuang/raw/master/img/image-20200429173414704.png" alt="image-20200429173414704"></p>
<h3 id="（3）直观图">（3）直观图</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre class=" language-hljs spreadsheet"><code class="language-hljs spreadsheet"># coding&#x3D;utf-8<br># !&#x2F;usr&#x2F;bin&#x2F;python<br><br>from __future__ import print_function<br>from collections import namedtuple<br><br>disk &#x3D; namedtuple('Disk', 'major_number minor_number device_name'<br>                          ' read_count read_merged_count read_sections'<br>                          ' time_spent_reading write_count write_merged_count'<br>                          ' write_sections time_spent_write io_requests'<br>                          ' time_spent_doing_io weighted_time_spent_dong_io')<br><br><br>def get_disk_info(device):<br>    with open('&#x2F;proc&#x2F;diskstats') as f:<br>        for line in f:<br>            if line.split()[2] &#x3D;&#x3D; device:<br>                return disk(*(line.split()))<br>    raise RuntimeError('设备(&#123;0&#125;)没找到。。。'.format(device))<br><br><br>def main(device):<br>    disk_info &#x3D; get_disk_info(device)<br>    print(disk_info)<br>    print("磁盘写入次数:&#123;0&#125;".format(disk_info.write_count))<br>    print("磁盘写入的字节数:&#123;0&#125;".format(float(disk_info.write_sections) * 512))<br>    print("磁盘写入的延时:&#123;0&#125;".format(disk_info.time_spent_write))<br><br><br>if __name__ &#x3D;&#x3D; '__main__':<br>    main('sda1')<br></code></pre></td></tr></table></figure>
<h4 id="执行脚本：-2">执行脚本：</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python scripts]# python3 monitor_dick.py<br></code></pre></td></tr></table></figure>
<p><img src="https://gitee.com/xgpqq/tuchuang/raw/master/img/image-20200429180049979.png" alt="image-20200429180049979"></p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Wu Shao Dong</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://wsdlxgp.top/posts/10c9.html">https://wsdlxgp.top/posts/10c9.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://wsdlxgp.top" target="_blank">Xgp & Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/nfs/">nfs</a><a class="post-meta__tags" href="/tags/deployment/">deployment</a><a class="post-meta__tags" href="/tags/pv/">pv</a><a class="post-meta__tags" href="/tags/pvc/">pvc</a><a class="post-meta__tags" href="/tags/Storage-Class/">Storage Class</a><a class="post-meta__tags" href="/tags/dashboard/">dashboard</a><a class="post-meta__tags" href="/tags/helm/">helm</a></div><div class="post_share"><div class="social-share" data-image="http://xgp-cunchu.test.upcdn.net/k8s/325738.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="http://xgp-cunchu.test.upcdn.net/k8s/3.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="http://xgp-cunchu.test.upcdn.net/k8s/1.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li><li class="reward-item"><img class="post-qr-code__img" src="http://xgp-cunchu.test.upcdn.net/k8s/2.jpg" alt="QQ支付"/><div class="post-qr-code__desc">QQ支付</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/posts/54c9.html"><img class="prev_cover" src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq72p.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Python监控Linux系统（1）</div></div></a></div><div class="next-post pull_right"><a href="/posts/48ac.html"><img class="next_cover" src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq70p.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Python执行外部命令（subprocess，call，Popen）</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/posts/e939.html" title="初识python"><img class="relatedPosts_cover" src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq46p.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-07-11</div><div class="relatedPosts_title">初识python</div></div></a></div><div class="relatedPosts_item"><a href="/posts/6618.html" title="python的正则表达式"><img class="relatedPosts_cover" src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq57p.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-07-11</div><div class="relatedPosts_title">python的正则表达式</div></div></a></div><div class="relatedPosts_item"><a href="/posts/5641.html" title="python文本文件的（读、写、追加）"><img class="relatedPosts_cover" src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq58p.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-07-11</div><div class="relatedPosts_title">python文本文件的（读、写、追加）</div></div></a></div><div class="relatedPosts_item"><a href="/posts/ed47.html" title="python数据可视化"><img class="relatedPosts_cover" src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq59p.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-07-11</div><div class="relatedPosts_title">python数据可视化</div></div></a></div><div class="relatedPosts_item"><a href="/posts/c970.html" title="Python数据可视化之Pygal图表类型"><img class="relatedPosts_cover" src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq60p.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-07-11</div><div class="relatedPosts_title">Python数据可视化之Pygal图表类型</div></div></a></div><div class="relatedPosts_item"><a href="/posts/10c6.html" title="初识Django和宝塔面板"><img class="relatedPosts_cover" src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq61p.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-07-11</div><div class="relatedPosts_title">初识Django和宝塔面板</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="lv-container" data-id="city" data-uid="MTAyMC80OTM0NS8yNTgzNw=="><script>(function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
})(document, 'script');</script></div></div></article></main><footer id="footer" style="background-image: url(https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq71p.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By Wu Shao Dong</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="ypy"><a href="https://console.upyun.com/services/file/" target="_blank" rel="noopener"><img class="icp-icon" src="/img/1591433700(1).png"/><span></span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode far fa-moon" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script><script src="/js/search/local-search.js"></script><script>var endLoading = function () {
  document.body.style.overflow = 'auto';
  document.getElementById('loading-box').classList.add("loaded")
}
window.addEventListener('load',endLoading)</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>