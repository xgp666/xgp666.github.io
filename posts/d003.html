<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>python自动化管理sshy与paramiko | Xgp &amp; Blog</title><meta name="description" content="Python自动化管理sshy介绍 ssh优势：  安全传输文件 登录 批量执行命令  对于一名刚开始接触Linux系统管理的工程师来说，他眼里的系统管理的步骤可能是：使用SSH登录服务器，修改应用相关的配置文件，执行一些Linux命令，重启相应的进程，最后退出服务器。如果还有更多的服务器，那么，就重复上述过程。 上面这一系列步骤是Linux系统管理的基础知识，是系统管理的基本功。但是，在实际工作"><meta name="keywords" content="nfs,deployment,pv,pvc,dashboard,helm,StorageClass"><meta name="author" content="Wu Shao Dong"><meta name="copyright" content="Wu Shao Dong"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://wsdlxgp.top/posts/d003.html"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="python自动化管理sshy与paramiko"><meta property="og:url" content="https://wsdlxgp.top/posts/d003.html"><meta property="og:site_name" content="Xgp &amp; Blog"><meta property="og:description" content="Python自动化管理sshy介绍 ssh优势：  安全传输文件 登录 批量执行命令  对于一名刚开始接触Linux系统管理的工程师来说，他眼里的系统管理的步骤可能是：使用SSH登录服务器，修改应用相关的配置文件，执行一些Linux命令，重启相应的进程，最后退出服务器。如果还有更多的服务器，那么，就重复上述过程。 上面这一系列步骤是Linux系统管理的基础知识，是系统管理的基本功。但是，在实际工作"><meta property="og:image" content="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq76p.jpg"><meta property="article:published_time" content="2019-09-13T16:31:00.000Z"><meta property="article:modified_time" content="2020-06-30T06:54:54.803Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="prev" title="python自动化管理Ansible" href="https://wsdlxgp.top/posts/5017.html"><link rel="next" title="python的网络" href="https://wsdlxgp.top/posts/5943.html"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: false,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true
  }</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Xgp & Blog" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">132</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">76</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">4</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">1.</span> <span class="toc-text">Python自动化管理sshy介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ssh优势："><span class="toc-number">1.0.0.1.</span> <span class="toc-text">ssh优势：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1）效率高："><span class="toc-number">1.0.1.</span> <span class="toc-text">1）效率高：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2）不容易犯错："><span class="toc-number">1.0.2.</span> <span class="toc-text">2）不容易犯错：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3）享受乐趣："><span class="toc-number">1.0.3.</span> <span class="toc-text">3）享受乐趣：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">2.</span> <span class="toc-text">一、使用SSH协议访问远程服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1、SSH协议"><span class="toc-number">2.1.</span> <span class="toc-text">1、SSH协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2、OpenSSH实现"><span class="toc-number">2.2.</span> <span class="toc-text">2、OpenSSH实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#OpenSSH的客户端是一个名为ssh可执行程序，我们可以使用ssh命令连接远程服务器。如下所示"><span class="toc-number">2.2.0.1.</span> <span class="toc-text">OpenSSH的客户端是一个名为ssh可执行程序，我们可以使用ssh命令连接远程服务器。如下所示:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#如果服务器端不是使用默认的22端口，可以通过SSH命令的-p参数指定建立连接的端口号，格式如下所示："><span class="toc-number">2.2.0.2.</span> <span class="toc-text">如果服务器端不是使用默认的22端口，可以通过SSH命令的-p参数指定建立连接的端口号，格式如下所示：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#我们也可以不进入交互式的Shell，直接使用ssh命令在远程服务器中执行Linux命令，如下所示："><span class="toc-number">2.2.0.3.</span> <span class="toc-text">我们也可以不进入交互式的Shell，直接使用ssh命令在远程服务器中执行Linux命令，如下所示：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3、配置ssh的方法："><span class="toc-number">2.3.</span> <span class="toc-text">3、配置ssh的方法：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#查看ssh-config文件"><span class="toc-number">2.3.1.</span> <span class="toc-text">查看ssh_config文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4、使用密钥登录远程服务器"><span class="toc-number">2.4.</span> <span class="toc-text">4、使用密钥登录远程服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#测试登陆一下"><span class="toc-number">2.4.1.</span> <span class="toc-text">测试登陆一下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查看公钥是否一致"><span class="toc-number">2.4.2.</span> <span class="toc-text">查看公钥是否一致</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">3.</span> <span class="toc-text">二、使用ssh-agent管理私钥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用ssh-agent有以下几个好处："><span class="toc-number">3.0.1.</span> <span class="toc-text">使用ssh-agent有以下几个好处：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）先把原先的密钥删除并生成新的密钥"><span class="toc-number">3.0.2.</span> <span class="toc-text">（1）先把原先的密钥删除并生成新的密钥</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#（2）使用ssh-agent保存密钥"><span class="toc-number">3.0.2.1.</span> <span class="toc-text">（2）使用ssh-agent保存密钥</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq76p.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">Xgp &amp; Blog</a></span><span class="pull-right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">python自动化管理sshy与paramiko</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2019-09-14 00:31:00"><i class="far fa-calendar-alt fa-fw"></i> 发表于 2019-09-14</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-06-30 14:54:54"><i class="fas fa-history fa-fw"></i> 更新于 2020-06-30</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/python/">python</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1>Python自动化管理sshy介绍</h1>
<h4 id="ssh优势："><strong>ssh优势：</strong></h4>
<ul>
<li><strong>安全传输文件</strong></li>
<li><strong>登录</strong></li>
<li><strong>批量执行命令</strong></li>
</ul>
<p><strong>对于一名刚开始接触Linux系统管理的工程师来说，他眼里的系统管理的步骤可能是：使用SSH登录服务器，修改应用相关的配置文件，执行一些Linux命令，重启相应的进程，最后退出服务器。如果还有更多的服务器，那么，就重复上述过程。</strong></p>
<p><strong>上面这一系列步骤是Linux系统管理的基础知识，是系统管理的基本功。但是，在实际工作中，一般不会手动对</strong><br>
<strong>服务器进行操作，而是使用程序进行自动化管理。即使服务器的数量很少，也推荐大家编写程序进行自动化。相对于手动管理服务器，自动化管理有许多优点。例如：</strong></p>
<h3 id="1）效率高："><strong>1）效率高：</strong></h3>
<p><strong>自动化操作效率比手动操作效率高。这里的效率高可以从两方面来理解：一方面是程序执行的效率比手动操作的效率高；另一方面是指对工程师来说，使用程序可以提高自身的工作效率，减少不必要的时间浪费。即使只有一台服务器，手动操作虽然可以很快完成，但其操作效率也不能与程序相提并论。如果管理的是服务器集群，显然，人工操作非常不现实，不但效率低下.而且枯操乏味，费时费力。程序的好处是一次编写，多次运行。虽然在编写程序的时候，花费的时间可能比单次手动操作的时间多，但是，只要程序编写完成，就可以多次反复地运行，节省大量时间。</strong></p>
<h3 id="2）不容易犯错："><strong>2）不容易犯错：</strong></h3>
<p><strong>俗话说“人无完人”，如果一直使用人工管理的方式管理服务器集群，那么，出错是不可避免的。工程师会有情绪的变化，也会有身体健康状况等问题，但程序不会。只要程序编写完成，并且考虑到了相应的异常，程序总是能够严格一致地执行管理操作。</strong></p>
<h3 id="3）享受乐趣："><strong>3）享受乐趣：</strong></h3>
<p><strong>从事计算机行业有一个天然的好处，那就是不用进行重复性的工作。有任何重复性的工作，找们都可以通过编写程序消灭掉。消灭重复性的工作，不但节省工作时间，还能够获得更多的乐趣和成就感。以管理服务器集群为例，看到自己编写的程序、指挥成百上千的服务器按照既定的需求执行操作，是不是有种指点江山、挥斥方遒的感觉？</strong></p>
<p><strong>这一章将会讨论如何使用Python批量管理服务器。首先，我们将会介绍批量管理服务器的基础知识，即SSH协议；随后，本章会介绍一个Python编写的批处理工具；然后将会介绍如何在Python程序中对远程服务器进行操作；在本章的最后，我们会介绍一个非常强大的系统管理工具，即Fabric,这一部分是本章的重点和难点。</strong></p>
<h1>一、使用SSH协议访问远程服务器</h1>
<p><strong>SSH ( Secure Shell)是一种由IETF的网络工作小组制定、创建在应用层和传输层基础上的安全协议，为计算机上的Shell提供安全的传输和使用环境。</strong></p>
<h2 id="1、SSH协议">1、SSH协议</h2>
<p><strong>在互联网早期，通信都是明文的，如rsh、 FTP、POP和Telnet。一旦通信报文被截获，内容就泄漏无疑。1995年，芬兰学者Tatu Ylonen设计了SSH协议。将登录信息全部加密，成为互联网安全的一个基本解决方案。这个方案迅速在全世界获得推广，目前已经成为Linux系统的标准配。</strong></p>
<p><strong>SSH只是一种协议，存在多种实现，既有商业实现也有开源实现。目前。在Linux下广泛使用的是OpenSSH，它是一款应用广泛的开源软件。本文即将介绍的paramiko是SSH协议的一种Python实现。</strong></p>
<p><strong>SSH除了提供安全的传输和登录以外，还可以进行批量命令执行，使用非常方便。正是由于SSH简单好用的特点，本章介绍的几个工具，以及稍后即将介绍的Ansible,都依赖SSH进行远程服务器的管理。使用SSH的好处非常明显，既充分利用了现成的机制，又省去了在远程服务器安装代理(Agent)程序。因此，诸多自动化工其都依赖SSH。</strong></p>
<h2 id="2、OpenSSH实现">2、OpenSSH实现</h2>
<p><strong>OpenSSH (OpenBSD Secure Shell)是OpenBSD的一个子项目，是SSH协议的开源实现。在服务端，OpenSSH启动sshd守护进程，该进程默认监听22端口。客户端使用用户名和密码连接服务端，连接成功以后，OpenSSH返回给用户一个Shell，用户可以使用该Shell在远程服务器执行命令。</strong></p>
<p><strong>在Debian系统中，OpenSSH的服务端默认读取/etc/ssh/sshd_config中的配置。在生产环境中，为了防止黑客攻击，一般会修改ssh服务的默认端口号，修改ssh服务默认端口号就是在/etc/ssh/sshd_config中完成的。我们也可以通过该配置文件禁止用户使用密码进行认证，只能使用密钥认证。修改完配置文件以后，执行下面的命令重启OpenSSH的守护进程才能生效：</strong></p>
<p><strong>对于一名刚开始接触Linux系统管理的工程师来说，他眼里的系统管理的步骤可能是：使用SSH登录服务器，修改应用相关的配置文件，执行一些Linux命令，重启相应的进程，最后退出服务器。如果还有更多的服务器，那么，就重复上述过程。</strong></p>
<p><strong>上面这一系列步骤是Linux系统管理的基础知识，是系统管理的基本功。但是，在实际工作中，一般不会手动对</strong><br>
<strong>服务器进行操作，而是使用程序进行自动化管理。即使服务器的数量很少，也推荐大家编写程序进行自动化。相对于手动管理服务器，自动化管理有许多优点。例如：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">/etc/init.d/ssh restart<br></code></pre></td></tr></table></figure>
<h4 id="OpenSSH的客户端是一个名为ssh可执行程序，我们可以使用ssh命令连接远程服务器。如下所示"><strong>OpenSSH的客户端是一个名为ssh可执行程序，我们可以使用ssh命令连接远程服务器。如下所示:</strong></h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python ~]# ssh xgp@localhost <br>The authenticity of host 'localhost (::1)' can't be established.<br>ECDSA key fingerprint is bf:c7:de:84:e1:28:f4:d4:7e:41:49:9f:54:dc:e9:83.<br>Are you sure you want to continue connecting (yes/no)? yes<br>xgp@localhost's password: <br>[xgp@python ~]$<br></code></pre></td></tr></table></figure>
<h4 id="如果服务器端不是使用默认的22端口，可以通过SSH命令的-p参数指定建立连接的端口号，格式如下所示：">如果服务器端不是使用默认的22端口，可以通过SSH命令的-p参数指定建立连接的端口号，格式如下所示：</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">ssh username@remote_host -p 端口号<br></code></pre></td></tr></table></figure>
<h4 id="我们也可以不进入交互式的Shell，直接使用ssh命令在远程服务器中执行Linux命令，如下所示：">我们也可以不进入交互式的Shell，直接使用ssh命令在远程服务器中执行Linux命令，如下所示：</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python ~]# ssh root@192.168.1.80 'date'<br>root@192.168.79.129's password: <br>2020年 05月 15日 星期五 15:55:08 CST<br>s<br>[root@python ~]#<br></code></pre></td></tr></table></figure>
<h2 id="3、配置ssh的方法：">3、配置ssh的方法：</h2>
<ul>
<li><strong>编辑/etc/ssh/ssh_config</strong></li>
<li><strong>编辑~/.ssh/config</strong></li>
</ul>
<p><strong>ssh会读取/etc/ssh/ssh_config文件中的配置。例如，远程服务器使用的不是默认的22端口号，我们只需要在/etc/ssh/ssh_config进行简单的配置，就可以在连接远程服务器时省去指定端口号的参数。除了修/etc/ssh/ssh_config文件以外，更常见的做法是修改用户home目录下的~/.ssh/config文件。</strong></p>
<h3 id="查看ssh-config文件">查看ssh_config文件</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python ~]# find / -name ssh_config          #查看找ssh_config 文件<br>/etc/ssh/ssh_config<br>[root@python ~]# cat /etc/ssh/ssh_config | awk #<br>Usage: awk [POSIX or GNU style options] -f progfile [--] file ...<br>Usage: awk [POSIX or GNU style options] [--] 'program' file ...<br>POSIX options:		GNU long options: (standard)<br>true-f progfile		--file=progfile<br>true-F fs			--field-separator=fs<br>true-v var=val		--assign=var=val<br>Short options:		GNU long options: (extensions)<br>true-b			--characters-as-bytes<br>true-c			--traditional<br>true-C			--copyright<br>true-d[file]		--dump-variables[=file]<br>true-e 'program-text'	--source='program-text'<br>true-E file			--exec=file<br>true-g			--gen-pot<br>true-h			--help<br>true-L [fatal]		--lint[=fatal]<br>true-n			--non-decimal-data<br>true-N			--use-lc-numeric<br>true-O			--optimize<br>true-p[file]		--profile[=file]<br>true-P			--posix<br>true-r			--re-interval<br>true-S			--sandbox<br>true-t			--lint-old<br>true-V			--version<br><br>To report bugs, see node `Bugs' in `gawk.info', which is<br>section `Reporting Problems and Bugs' in the printed version.<br><br>gawk is a pattern scanning and processing language.<br>By default it reads standard input and writes standard output.<br><br>Examples:<br>truegawk '&#123; sum += $1 &#125;; END &#123; print sum &#125;' file<br>truegawk -F: '&#123; print $1 &#125;' /etc/passwd<br></code></pre></td></tr></table></figure>
<p><strong>例如，我们经常要使用某一个用户名、端口号访问某一台远程服务器。为了省去记住服务器ip的负担，很多工程师会编写一个Shell脚本，在脚本中保存用户名、端口号和ip地址。在下次登录时，可以省去输入的烦恼。如下所示：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre class=" language-hljs shell">[root@python ~]# vim /opt/login.sh<br><span class="hljs-meta">#</span><span class="bash"><code class="language-hljs shell">[root@python ~]# vim /opt/login.sh<br><span class="hljs-meta">#</span><span class="bash">!/usr/bin/bash</span><br><br>ssh test@127.0.0.1 -p 22<br><br>[root@python ~]# useradd test<br>[root@python ~]# passwd test<br>更改用户 test 的密码 。<br>新的 密码：<br>无效的密码： 密码少于 8 个字符<br>重新输入新的 密码：<br>passwd：所有的身份验证令牌已经成功更新。<br>[root@python ~]# sh /opt/login.sh <br>The authenticity of host '127.0.0.1 (127.0.0.1)' can't be established.<br>ECDSA key fingerprint is bf:c7:de:84:e1:28:f4:d4:7e:41:49:9f:54:dc:e9:83.<br>Are you sure you want to continue connecting (yes/no)? yes<br>Warning: Permanently added '127.0.0.1' (ECDSA) to the list of known hosts.<br>test@127.0.0.1's password: <br>[test@python ~]$<br></code></pre></td></tr></table></figure>
<p><strong>对于这里的需求，还有更好的解决方案。命令会读取~/.ssh/config文件中配置，因此，我们可以在~/.ssh/config文件中提前配置好访问远程服务器的信息。如下所示：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python ~]# cp /etc/ssh/ssh_config -p  ~/.ssh/config<br>[root@python ~]# vim  ~/.ssh/config <br><br>Host python<br>  ForwardAgent yes<br>  StrictHostKeyChecking no<br>  port 22<br>  User test<br>  Controlpath ~/.ssh/ssh-%r@%h:%p.sock<br><br>Host *<br>  StrictHostKeyChecking no<br>  HostName %h<br>  Port  22<br>  User  test<br>  Controlpath ~/.ssh/ssh-%r@%h:%p.sock<br></code></pre></td></tr></table></figure>
<p><strong>配置完成后，直接在命令行执行ssh host2就可以使用用户名test，以及端口号2092登录到10.166.224.14中。此外，我们还使用通配符的方式定义了ssh默认用户名与端口号。假设我们要使用用户名laoyu、端口号2092访问10.166.226.153，有了前面的配置以后，可以在命令行直接进行登录。如下所示：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python ~]# ssh python<br>Warning: Permanently added 'python,fe80::c64e:c937:2ea8:6676%ens33' (ECDSA) to the list of known hosts.<br>test@python's password: <br>Permission denied, please try again.<br>test@python's password: <br>Last login: Fri May 15 14:34:54 2020 from localhost<br>[test@python ~]$<br></code></pre></td></tr></table></figure>
<p><strong>可以看到，我们只需要在~/.ssh/config文件中进行简单的配置就能够有效提高工作效率。</strong></p>
<h2 id="4、使用密钥登录远程服务器">4、使用密钥登录远程服务器</h2>
<ul>
<li><strong>ssh使用密码</strong></li>
<li><strong>ssh不使用密码，使用密钥</strong></li>
</ul>
<p><strong>在上面的例子中，我们没有指定认证的方式，默认使用密码进行认证。在生产环境中一般不使用密码认证，一方面是因为密码认证没有密钥认证安全；另一方面，密码认证每次登录时都需要输入密码，比较繁琐。使用密钥认证，省去了输入密码的烦恼。因此，在生产环境中，一般会使用密钥进行登录。</strong></p>
<p><strong>密钥登录的原理也很简单，即事先将用户的公钥储存在远程服务器上（~/.ssh/authorized_keys文件)。使用密钥登录时，远程服务器会向用户发送一段随机字符串，SSH使用用户的私钥加密字符串后发送给远程服务器。远程服务器用事先储存的公钥进行解密，如果成功，就证明用户是可信的，直接允许登录Shell，不再要求密码。</strong></p>
<p><strong>OpenSSH除了提供服务端的sshd、客户端的SSH程序以外，还提供了若干与密钥认证相关的工其。其中，ssh-keygen是用来生成密钥对的工具。如下所示：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python ~]# ssh-keygen<br></code></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-src="https://gitee.com/xgpqq/tuchuang/raw/master/img/image-20200515151959697.png" alt="image-20200515151959697"></p>
<p><strong>ssh-keygen执行完以后，用户的~/.ssh目录下会存在一个名为id_ rsa的私钥文件与一个名为id_rsa.pub的公钥文件。</strong></p>
<p><strong>接下来要做的是将公钥保存到远程服务器的~/.ssh/authorized_keys文件中。可以使用下面的命令将公钥保存到远程服务器的authorized_keys文件中：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python ~]#  ssh root@192.168.1.80 'mkdir -p .ssh && cat >>.ssh/authorized_keys' <~/.ssh/id_rsa.pub <br>The authenticity of host '192.168.1.80 (192.168.1.80)' can't be established.<br>ECDSA key fingerprint is SHA256:UbtfIBIs2tGQU1m/SIvSZX72VUQ+r1fH/aIMxVbdobg.<br>ECDSA key fingerprint is MD5:56:10:49:b1:ae:f6:3c:d3:5e:2d:c5:d9:38:2c:45:e7.<br>Are you sure you want to continue connecting (yes/no)? yes<br>Warning: Permanently added '192.168.1.80' (ECDSA) to the list of known hosts.<br>root@192.168.1.80's password: <br>[root@python ~]#<br></code></pre></td></tr></table></figure>
<p><strong>上面的命令是使用Shell脚本的方式将公钥保存到远程服务器，除此之外，OpenSSH专门提供了一个名为ssh-copy-id的工具。我们可以使用该工具将公钥保存到远程服务器中，这种方式比前面Shell脚本的方式更加方便。如下所示:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python ~]# <br>[root@python ~]# ssh-copy-id -i ~/.ssh/id_rsa.pub 192.168.1.80<br>/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed<br>/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys<br>root@192.168.1.80's password: <br><br>Number of key(s) added: 1<br><br>Now try logging into the machine, with:   "ssh '192.168.1.80'"<br>and check to make sure that only the key(s) you wanted were added.<br><br>[root@python ~]# rm -rf  ~/.ssh/config<br>[root@python ~]# ssh 192.168.1.80<br>Last login: Fri May 15 15:16:23 2020 from 192.168.1.80<br>[root@python ~]#<br></code></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-src="https://gitee.com/xgpqq/tuchuang/raw/master/img/image-20200515152149576.png" alt="image-20200515152149576"></p>
<p><strong>配置私钥认证以后，就可以直接使用私钥进行登录。ssh命令会默认读取~/.ssh/id_rsa这个私钥文件。如果私钥文件保存在其他位置，或者是其他名称，可以使用-t参放指定私钥文件的地址。如下所示：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">ssh test@192.168.1.80 -p 22 -i ~/私钥文件所在的位置（含文件名）<br></code></pre></td></tr></table></figure>
<p><strong>使用私钥登录时需要注意，私钥文件与远程服务器中authorized_keys文件的权限都必须为600，否则登录会出错，这也是工程师使用私钥登录时最容易遇到的错误。</strong></p>
<h3 id="测试登陆一下">测试登陆一下</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python ~]# vim ~/.ssh/config <br><br>Host python<br>  ForwardAgent yes<br>  StrictHostKeyChecking no<br>  HostName 192.168.1.80<br>  Port 22<br>  User test<br>  Controlpath ~/.ssh/ssh-%r@%h:%p.sock<br></code></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-src="https://gitee.com/xgpqq/tuchuang/raw/master/img/image-20200515150740257.png" alt="image-20200515150740257"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python ~]# ssh python<br>test@192.168.1.80's password: <br>Last login: Fri May 15 14:49:17 2020 from fe80::c64e:c937:2ea8:6676%ens33<br>[test@python ~]$<br></code></pre></td></tr></table></figure>
<h3 id="查看公钥是否一致">查看公钥是否一致</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python ~]# ssh 192.168.1.80<br>Last login: Fri May 15 15:16:23 2020 from 192.168.1.80<br><br>[root@python ~]# cat ~/.ssh/authorized_keys        #远程的<br>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCWLJAYWCpbRPQX8gDbr2mIyXMw/qEKd46u4QhcaDPY7CeGd/buIGsWsuz+DAcnowk095rIwspGGHOdt54s+aeXGXcsRh7Hpuf0Py20Krim+v2LIUQW8vQSJDj1HiQUSnNQNPT3HAm0aqQp8u2EZ0StLYtf/uYSbg6rSzW08mKwhBQkrP0olWb+hD4ak3LxA05OI/WnanGKqtqjLg+4MbgGK96fY53dKvwrdt9NWiuof3pLgTw9fTvPU6CD+cH4LmRg8IVhthlBRhrXPA7oa8gvupTvpMYdNPPUSBsVR2rBcimrUFwdOpzb6T30C7o566noRd3t3nNxkQ/HrKalo9Bn root@python<br><br>[root@python ~]# exit<br>登出<br>Connection to python closed.<br><br>[root@python ~]# cat ~/.ssh/id_rsa.pub              #本地的<br>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCWLJAYWCpbRPQX8gDbr2mIyXMw/qEKd46u4QhcaDPY7CeGd/buIGsWsuz+DAcnowk095rIwspGGHOdt54s+aeXGXcsRh7Hpuf0Py20Krim+v2LIUQW8vQSJDj1HiQUSnNQNPT3HAm0aqQp8u2EZ0StLYtf/uYSbg6rSzW08mKwhBQkrP0olWb+hD4ak3LxA05OI/WnanGKqtqjLg+4MbgGK96fY53dKvwrdt9NWiuof3pLgTw9fTvPU6CD+cH4LmRg8IVhthlBRhrXPA7oa8gvupTvpMYdNPPUSBsVR2rBcimrUFwdOpzb6T30C7o566noRd3t3nNxkQ/HrKalo9Bn root@python<br></code></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-src="https://gitee.com/xgpqq/tuchuang/raw/master/img/image-20200515152641675.png" alt="image-20200515152641675"></p>
<h1>二、使用ssh-agent管理私钥</h1>
<p><strong>OpenSSH还提供了一个名为ssh-agent的程序，该程序可以简化SSH私钥的管理操作。ssh-agent是个长时间持续运行的守护进程(daemon)，它的唯一目的就是对私钥进行高速缓存。</strong></p>
<h3 id="使用ssh-agent有以下几个好处："><strong>使用ssh-agent有以下几个好处：</strong></h3>
<p><strong>（1）如果我们使用了一个加密的私钥，那么，使用这个私钥时将需要输入密码才能使用私钥文件。如果我们使用加密的私钥并且没有使用ssh-agent，那么将不得不在每次使用这个私钥时都输入密码。如果使用ssh-agent管理私钥，只需要在私钥加入到ssh-agent的那一刻输入密码，在之后的使用中都不用输入私钥的密码；</strong></p>
<p><strong>（2）如果我们有多台远程服务器与多个私钥文件，使用ssh-agent以后，不用在每次登录服务器时都使用-i参数指定使用哪一个私钥文件。ssh-agent将会尝试使用不同的私钥文件建立连接。直至成功；</strong></p>
<p><strong>（3）使用ssh-agent可以实现私钥转发功能。假设现在有三台服务器，分别是A, B, C。其中，A是我们的控制节点，我们可以在A上直接访问B，但是我们无法直接访问C。如果要访问C，就只能先登最B，再从B登录C。对于这种情况，是否需要在B中保存用户的私钥呢？对于这里的情况，我们可以使用agent forwarding。使用agent forwarding以后，不用将私钥保存到B服务器上，只需要在A中保存私钥，在B和C中保存公钥，便可在A中访问B与C这两台服务器。为了使用agent forwarding，我们必须使用ssh-agent管理私钥。</strong></p>
<p><strong>如果在Windows下使用Xshell进行SSH访问，要启动ssh-agent非常简单，只需要在“连接“–&gt;&quot;SSH“中勾选“使用密码处理的Xagent (SSH代理)”即可。</strong></p>
<h3 id="（1）先把原先的密钥删除并生成新的密钥">（1）先把原先的密钥删除并生成新的密钥</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python .ssh]# cd ~/.ssh/<br>[root@python .ssh]# rm -rf id*<br>[root@python .ssh]# ssh-keygen <br>Generating public/private rsa key pair.<br>Enter file in which to save the key (/root/.ssh/id_rsa): <br>Enter passphrase (empty for no passphrase): <br>Enter same passphrase again: <br>Your identification has been saved in /root/.ssh/id_rsa.<br>Your public key has been saved in /root/.ssh/id_rsa.pub.<br>The key fingerprint is:<br>dc:57:da:10:e5:1a:8b:15:e3:98:61:d4:02:9f:56:8f root@python<br>The key's randomart image is:<br>+--[ RSA 2048]----+<br>|        .o+.=..  |<br>|         o.B.B   |<br>|          *.E +  |<br>|       . o o O   |<br>|        S o = .  |<br>|           .     |<br>|                 |<br>|                 |<br>|                 |<br>+-----------------+<br>[root@python .ssh]# ssh-copy-id -i id_rsa.pub 192.168.1.80<br>/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed<br>/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys<br>root@192.168.1.80's password: <br><br>Number of key(s) added: 1<br><br>Now try logging into the machine, with:   "ssh '192.168.1.80'"<br>and check to make sure that only the key(s) you wanted were added.<br><br>[root@python .ssh]# ssh 192.168.1.80<br>Enter passphrase for key '/root/.ssh/id_rsa': <br>Last login: Fri May 15 15:28:54 2020 from fe80::c64e:c937:2ea8:6676%ens33<br>[root@python ~]# exit<br>登出<br>Connection to 192.168.1.80 closed.<br></code></pre></td></tr></table></figure>
<p><em><strong>现在登陆需要私钥</strong></em></p>
<h4 id="（2）使用ssh-agent保存密钥">（2）使用ssh-agent保存密钥</h4>
<p><strong>在Linux下，直接执行ssh-agent命令启动ssh-agent即可。启动以后，使用ssh-add命令将私钥添加到ssh-agent中。如下所示：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python ~]# ssh-agent bash<br>[root@python ~]# ssh-add ~/.ssh/id_rsa<br>Enter passphrase for /root/.ssh/id_rsa: <br>Identity added: /root/.ssh/id_rsa (/root/.ssh/id_rsa)<br>[root@python ~]#<br></code></pre></td></tr></table></figure>
<p><strong>私钥添加完成后，可以执行ssh_add -L命令查看哪些私钥已经被添加到ssh-agent中。如下所示：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python ~]# ssh-add -L<br>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDsP4VSOhnnCfidbg7e0OAQFcW5wAgPHld9S8KDTWv3X0/LNilYM3RkXQZ10XQ8Mw34i9rXa3SfqaHk6QYHXjNEUv6PEA/rKWY3kLXH9VUVHry4iwt9kVg9PowfccKLXPi8iWpqS7tk5ZEAnxihBtQattMTC44iz9X6hJDEn1r3r3YplJJGilIR+NaYJrM3ltxUBVuoJ82MfHOomhirc37ihLEwNbqRBMPYC4u1SoXDkagFsh0+HcuE0436yEByFxFw87jPmrjl7bgFsPahQsydrXySXOVdCzQJ8WuzJa1RvKr0xmgCjhZKExUYnMGAN9M79UBAyzZf2vUrwvvpPqWd /root/.ssh/id_rsa<br></code></pre></td></tr></table></figure>
<p><strong>启动ssh-agent以后，当我们尝试与远程服务器建立连接时，ssh客户端将会尝试使用存储在ssh-agent中的私钥与远程服务器进行认证。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">[root@python ~]# ssh 192.168.1.80<br>Last login: Fri May 15 15:38:28 2020 from 192.168.1.80<br>[root@python ~]# exit<br>登出<br>Connection to 192.168.1.80 closed.<br></code></pre></td></tr></table></figure>
<p><em><strong>现在因为本地保持了私钥，所以不需要输入私钥了</strong></em></p>
<p><img src= "/img/loading.gif" data-src="https://gitee.com/xgpqq/tuchuang/raw/master/img/image-20200515154547748.png" alt="image-20200515154547748"></p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Wu Shao Dong</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://wsdlxgp.top/posts/d003.html">https://wsdlxgp.top/posts/d003.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://wsdlxgp.top" target="_blank">Xgp & Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/nfs/">nfs</a><a class="post-meta__tags" href="/tags/deployment/">deployment</a><a class="post-meta__tags" href="/tags/pv/">pv</a><a class="post-meta__tags" href="/tags/pvc/">pvc</a><a class="post-meta__tags" href="/tags/dashboard/">dashboard</a><a class="post-meta__tags" href="/tags/helm/">helm</a><a class="post-meta__tags" href="/tags/StorageClass/">StorageClass</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/5017.html"><img class="prev-cover" data-src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq77p.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">python自动化管理Ansible</div></div></a></div><div class="next-post pull-right"><a href="/posts/5943.html"><img class="next-cover" data-src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq75p.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">python的网络</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/posts/e939.html" title="初识python"><img class="relatedPosts_cover" data-src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq46p.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-14</div><div class="relatedPosts_title">初识python</div></div></a></div><div class="relatedPosts_item"><a href="/posts/9a1f.html" title="python变量"><img class="relatedPosts_cover" data-src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq47p.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-14</div><div class="relatedPosts_title">python变量</div></div></a></div><div class="relatedPosts_item"><a href="/posts/h8er.html" title="k8s复习"><img class="relatedPosts_cover" data-src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq45p.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-14</div><div class="relatedPosts_title">k8s复习</div></div></a></div><div class="relatedPosts_item"><a href="/posts/46cd.html" title="Python 列表"><img class="relatedPosts_cover" data-src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq48p.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-14</div><div class="relatedPosts_title">Python 列表</div></div></a></div><div class="relatedPosts_item"><a href="/posts/9b8f.html" title="布尔表达式"><img class="relatedPosts_cover" data-src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq49p.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-14</div><div class="relatedPosts_title">布尔表达式</div></div></a></div><div class="relatedPosts_item"><a href="/posts/8e0b.html" title="Python 字典"><img class="relatedPosts_cover" data-src="https://gitee.com/xgpqq/tuchuang/raw/master/img/qweq50p.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-14</div><div class="relatedPosts_title">Python 字典</div></div></a></div></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Wu Shao Dong</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><button id="readmode" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" title="缩小字体"><i class="fas fa-minus"></i></button><button class="translate_chn_to_cht" id="translateLink" title="简繁转换">繁</button><button id="darkmode" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>